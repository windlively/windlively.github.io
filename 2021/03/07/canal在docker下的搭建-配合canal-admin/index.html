

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/assert/favorite.ico">
  <link rel="icon" type="image/png" href="/assert/favorite.ico">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Bai JunHan">
  <meta name="keywords" content="">
  <title>canalåœ¨dockerä¸‹çš„æ­å»º(é…åˆcanal-admin) - Windlively</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      
        
          
          
          
        
        <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/themes/prism-solarizedlight.min.css" />
      
      
        <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/line-numbers/prism-line-numbers.min.css" />
      
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->

  
<link rel="stylesheet" href="/assert/css/styles.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.6","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":"â¡"},"copy_btn":true,"image_zoom":{"enable":true},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <header style="height: 50vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Windlively</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="canalåœ¨dockerä¸‹çš„æ­å»º(é…åˆcanal-admin)">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      Bai JunHan
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-03-07 17:44" pubdate>
        2021å¹´3æœˆ7æ—¥ ä¸‹åˆ
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      4.2k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      68
       åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">canalåœ¨dockerä¸‹çš„æ­å»º(é…åˆcanal-admin)</h1>
            
              <p class="note note-info">
                
                  æœ¬æ–‡æœ€åæ›´æ–°äºï¼š10 ä¸ªæœˆå‰
                
              </p>
            
            <div class="markdown-body">
              <h2 id="MySQLé…ç½®"><a href="#MySQLé…ç½®" class="headerlink" title="MySQLé…ç½®"></a>MySQLé…ç½®</h2><ul>
<li><p>å¯¹äºè‡ªå»º MySQL , éœ€è¦å…ˆå¼€å¯ Binlog å†™å…¥åŠŸèƒ½ï¼Œé…ç½® binlog-format ä¸º ROW æ¨¡å¼ï¼Œmy.cnf ä¸­é…ç½®å¦‚ä¸‹</p>
  <div class="code-wrapper"><pre class="line-numbers language-none"><code class="language-none">[mysqld]
log-bin&#x3D;mysql-bin # å¼€å¯ binlog
binlog-format&#x3D;ROW # é€‰æ‹© ROW æ¨¡å¼
server_id&#x3D;1 # é…ç½® MySQL replaction éœ€è¦å®šä¹‰ï¼Œä¸è¦å’Œ canal çš„ slaveId é‡å¤
</code></pre></div>

<ul>
<li>æ³¨æ„ï¼šé’ˆå¯¹é˜¿é‡Œäº‘ RDS for MySQL , é»˜è®¤æ‰“å¼€äº† binlog , å¹¶ä¸”è´¦å·é»˜è®¤å…·æœ‰ binlog dump æƒé™ , ä¸éœ€è¦ä»»ä½•æƒé™æˆ–è€… binlog è®¾ç½®,å¯ä»¥ç›´æ¥è·³è¿‡è¿™ä¸€æ­¥</li>
</ul>
</li>
<li><p>æˆæƒ canal é“¾æ¥ MySQL è´¦å·å…·æœ‰ä½œä¸º MySQL slave çš„æƒé™, å¦‚æœå·²æœ‰è´¦æˆ·å¯ç›´æ¥ grant</p>
  <div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">CREATE USER canal IDENTIFIED BY &#39;canal&#39;;
GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &#39;canal&#39;@&#39;%&#39;;
-- GRANT ALL PRIVILEGES ON *.* TO &#39;canal&#39;@&#39;%&#39; ;
FLUSH PRIVILEGES;</code></pre></div>

<p>  PSï¼šæˆ‘æœ¬åœ°ä½¿ç”¨çš„MySQL 8.0ï¼Œå®æµ‹ä¸ç”¨ä¿®æ”¹æ­¤é…ç½®ä¹Ÿå¯æ­£å¸¸ä½¿ç”¨</p>
</li>
</ul>
<h2 id="canalå®¹å™¨çš„åˆ›å»ºä¸å¯åŠ¨"><a href="#canalå®¹å™¨çš„åˆ›å»ºä¸å¯åŠ¨" class="headerlink" title="canalå®¹å™¨çš„åˆ›å»ºä¸å¯åŠ¨"></a>canalå®¹å™¨çš„åˆ›å»ºä¸å¯åŠ¨</h2><ol>
<li><p>æ‹‰å–æ‰€éœ€è¦çš„é•œåƒ</p>
 <div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># canal-admin
ğŸ“ âœ  ~ docker pull canal&#x2F;canal-admin
# canal-server
ğŸ“ âœ  ~ docker pull canal&#x2F;canal-server</code></pre></div>
</li>
<li><p>ä¸‹è½½canal-adminçš„è¿è¡Œè„šæœ¬</p>
 <div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">wget https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;alibaba&#x2F;canal&#x2F;master&#x2F;docker&#x2F;run_admin.sh</code></pre></div>
</li>
<li><p>å¯åŠ¨å¹¶è¿è¡Œcanal-admin</p>
 <div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># ä»¥8089ç«¯å£å¯åŠ¨canal-admin
sh run_admin.sh -e server.port&#x3D;8089 \
         -e canal.adminUser&#x3D;admin \
         -e canal.adminPasswd&#x3D;admin

# æŒ‡å®šå¤–éƒ¨çš„mysqlä½œä¸ºadminçš„åº“
sh run_admin.sh \
    -e server.port&#x3D;8089 \
    -e spring.datasource.address&#x3D;host.docker.internal \
    -e spring.datasource.database&#x3D;xxx \
    -e spring.datasource.username&#x3D;root \
    -e spring.datasource.password&#x3D;xxx</code></pre></div>
</li>
<li><p>æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®<a target="_blank" rel="noopener" href="http://localhost:8089/">http://localhost:8089</a>ï¼Œé»˜è®¤è´¦å·å¯†ç ä¸ºadmin/123456ï¼Œé¦–é¡µå¦‚å›¾æ‰€ç¤º</p>
<p> <img src="https://oscimg.oschina.net/oscnet/up-9fe870724e9ad4581f18e9a4be241c1fcaf.png" srcset="/img/loading.gif"></p>
</li>
<li><p>ä¸‹è½½canal-serverçš„è¿è¡Œè„šæœ¬</p>
 <div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">wget https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;alibaba&#x2F;canal&#x2F;master&#x2F;docker&#x2F;run.sh</code></pre></div>
</li>
<li><p>adminç®¡ç†æ¨¡å¼å¯åŠ¨å¹¶è¿è¡Œcanal-serverï¼Œæœ¬æ¡ˆä¾‹ä»¥å•æœºæ¨¡å¼ä¸ºä¾‹ï¼Œé›†ç¾¤æ¨¡å¼éœ€æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªé›†ç¾¤ï¼Œå¹¶ä¸”æä¾›zookeeperåœ°å€ï¼Œç„¶åå¯åŠ¨å‚æ•°åŠ ä¸Šé›†ç¾¤åç§°å³å¯ï¼Œé…ç½®ä¸å•æœºæ¨¡å¼ä¸€æ ·ï¼Œåªä¸è¿‡ä¸€ä¸ªé›†ç¾¤å…±ç”¨ä¸€ä¸ªserveré…ç½®</p>
 <div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># ä»¥å•æœºæ¨¡å¼å¯åŠ¨
run.sh -e canal.admin.manager&#x3D;127.0.0.1:8089 \
         -e canal.admin.port&#x3D;11110 \
         -e canal.admin.user&#x3D;admin \
         -e canal.admin.passwd&#x3D;4ACFE3202A5FF5CF467898FC58AAB1D615029441

# é›†ç¾¤æ¨¡å¼å¯åŠ¨ï¼Œè‡ªåŠ¨åŠ å…¥testé›†ç¾¤
# å¦‚æœä½¿ç”¨é›†ç¾¤æ¨¡å¼ï¼Œéœ€è¦åœ¨canal-adminç®¡ç†é¡µé¢åˆ›å»ºé›†ç¾¤ï¼ŒåŒä¸€ä¸ªé›†ç¾¤ä½¿ç”¨ç›¸åŒçš„é…ç½®æ–‡ä»¶
run.sh -e canal.admin.manager&#x3D;127.0.0.1:8089 \
         -e canal.admin.port&#x3D;11110 \
         -e canal.admin.user&#x3D;admin \
         -e canal.admin.passwd&#x3D;4ACFE3202A5FF5CF467898FC58AAB1D615029441 
         -e canal.admin.register.cluster&#x3D;test</code></pre></div>

<p> PSï¼šåœ¨dockerå®¹å™¨ä¸­ï¼Œè‹¥éä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œ127.0.0.1å¹¶éä¸ºä¸»æœºçš„åœ°å€ï¼ŒMacç‰ˆå¯ä½¿ç”¨<strong>host.docker.internal</strong>è®¿é—®åˆ°ä¸»æœºï¼ŒLinuxæš‚ä¸æ”¯æŒï¼Œéœ€è¦æ‰‹åŠ¨åœ¨å®¹å™¨ä¸­æŸ¥è¯¢åˆ°ä¸»æœºçš„ipï¼Œæ›¿æ¢æ‰ä¸Šé¢çš„127.0.0.1</p>
</li>
<li><p>å¯åŠ¨æˆåŠŸåï¼Œåˆ·æ–°adminé¡µé¢çš„serveråˆ—è¡¨ï¼Œä¼šå‡ºç°åˆšåˆšå¯åŠ¨çš„canal-serverï¼š</p>
<p> <img src="https://oscimg.oschina.net/oscnet/up-4aadd69d740610d80bfaf9c01b2047db717.png" srcset="/img/loading.gif"></p>
<p> è‡³æ­¤ï¼Œcanalçš„åˆ›å»ºä¸å¯åŠ¨å·²ç»å®Œæˆï¼Œåœ¨ç®¡ç†é¡µé¢è¿›è¡Œé…ç½®æ“ä½œå³å¯</p>
</li>
</ol>
<h2 id="canalæ ¸å¿ƒé…ç½®ä»‹ç»"><a href="#canalæ ¸å¿ƒé…ç½®ä»‹ç»" class="headerlink" title="canalæ ¸å¿ƒé…ç½®ä»‹ç»"></a>canalæ ¸å¿ƒé…ç½®ä»‹ç»</h2><p>canalçš„é…ç½®åˆ†ä¸ºserveré…ç½®å’Œinstanceé…ç½®ï¼Œä¸€ä¸ªserverå¯åŒ…å«å¤šä¸ªinstanceï¼Œéƒ¨åˆ†é…ç½®</p>
<h3 id="serveré…ç½®"><a href="#serveré…ç½®" class="headerlink" title="serveré…ç½®"></a>serveré…ç½®</h3><div class="code-wrapper"><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"># æœåŠ¡æ¨¡å¼ï¼Œæ”¯æŒtcp, kafka, rocketMQ, rabbitMQ
canal.serverMode &#x3D; kafka

### kafkaé…ç½®
# è¯¥å€¼ä¸ºfalseæ—¶ï¼Œå‘é€çš„æ¶ˆæ¯ä¸ºäºŒè¿›åˆ¶å‹ç¼©æ ¼å¼ï¼Œéœ€è¦å®¢æˆ·ç«¯ä½¿ç”¨protobufå·¥å…·è§£æï¼Œä¸ºtrueæ—¶ï¼Œå‘é€jsonæ–‡æœ¬
canal.mq.flatMessage &#x3D; true
# kafkaæœåŠ¡å™¨åœ°å€
kafka.bootstrap.servers &#x3D; host.docker.internal:9092</code></pre></div>

<h3 id="instanceé…ç½®"><a href="#instanceé…ç½®" class="headerlink" title="instanceé…ç½®"></a>instanceé…ç½®</h3><div class="code-wrapper"><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"># ç›‘å¬çš„æ•°æ®åº“åœ°å€
canal.instance.master.address&#x3D;host.docker.internal:3306
# æ•°æ®åº“çš„ç”¨æˆ·å
canal.instance.dbUsername&#x3D;root
# æ•°æ®åº“å¯†ç 
canal.instance.dbPassword&#x3D;123456
# è¡¨åè¿‡æ»¤ï¼Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œ($&#123;åº“å&#125;.$&#123;è¡¨å&#125;)
canal.instance.filter.regex&#x3D;.+\\..+

# kafka topicåç§°ï¼Œæ‰€æœ‰çš„æ¶ˆæ¯éƒ½å°†æ”¾å…¥æ­¤topic
# canal.mq.topic&#x3D;example
# æ ¹æ®åº“åå¯è¡¨ååŠ¨æ€topic
canal.mq.dynamicTopic&#x3D;.+\\..+
# å‘é€åˆ†åŒº
canal.mq.partition&#x3D;0
# åˆ†åŒºæ•°é‡
#canal.mq.partitionsNum&#x3D;3
# æ ¹æ®åº“åå’Œè¡¨åè®¡ç®—å‡ºå‘é€åˆ†åŒº(Hash)ï¼Œå¯æ§åˆ¶åŒä¸€ä¸ªåº“&#x2F;è¡¨æœ‰åº
#canal.mq.partitionHash&#x3D;test.table:id^name,.*\\..*

### åŠ¨æ€topicå’Œpartitionçš„è¯¦ç»†è¯´æ˜
# canal.mq.dynamicTopic è¡¨è¾¾å¼è¯´æ˜
# canal 1.1.3ç‰ˆæœ¬ä¹‹å, æ”¯æŒé…ç½®æ ¼å¼ï¼šschema æˆ– schema.tableï¼Œå¤šä¸ªé…ç½®ä¹‹é—´ä½¿ç”¨é€—å·æˆ–åˆ†å·åˆ†éš”

# ä¾‹å­1ï¼štest\\.test æŒ‡å®šåŒ¹é…çš„å•è¡¨ï¼Œå‘é€åˆ°ä»¥test_testä¸ºåå­—çš„topicä¸Š
# ä¾‹å­2ï¼š.*\\..* åŒ¹é…æ‰€æœ‰è¡¨ï¼Œåˆ™æ¯ä¸ªè¡¨éƒ½ä¼šå‘é€åˆ°å„è‡ªè¡¨åçš„topicä¸Š
# ä¾‹å­3ï¼štest æŒ‡å®šåŒ¹é…å¯¹åº”çš„åº“ï¼Œä¸€ä¸ªåº“çš„æ‰€æœ‰è¡¨éƒ½ä¼šå‘é€åˆ°åº“åçš„topicä¸Š
# ä¾‹å­4ï¼štest\\..* æŒ‡å®šåŒ¹é…çš„è¡¨è¾¾å¼ï¼Œé’ˆå¯¹åŒ¹é…çš„è¡¨ä¼šå‘é€åˆ°å„è‡ªè¡¨åçš„topicä¸Š
# ä¾‹å­5ï¼štest,test1\\.test1ï¼ŒæŒ‡å®šå¤šä¸ªè¡¨è¾¾å¼ï¼Œä¼šå°†teståº“çš„è¡¨éƒ½å‘é€åˆ°testçš„topicä¸Šï¼Œtest1\\.test1çš„è¡¨å‘é€åˆ°å¯¹åº”çš„test1_test1 topicä¸Šï¼Œå…¶ä½™çš„è¡¨å‘é€åˆ°é»˜è®¤çš„canal.mq.topicå€¼
# ä¸ºæ»¡è¶³æ›´å¤§çš„çµæ´»æ€§ï¼Œå…è®¸å¯¹åŒ¹é…æ¡ä»¶çš„è§„åˆ™æŒ‡å®šå‘é€çš„topicåå­—ï¼Œé…ç½®æ ¼å¼ï¼štopicName:schema æˆ– topicName:schema.table

# ä¾‹å­1: test:test\\.test æŒ‡å®šåŒ¹é…çš„å•è¡¨ï¼Œå‘é€åˆ°ä»¥testä¸ºåå­—çš„topicä¸Š
# ä¾‹å­2: test:.*\\..* åŒ¹é…æ‰€æœ‰è¡¨ï¼Œå› ä¸ºæœ‰æŒ‡å®štopicï¼Œåˆ™æ¯ä¸ªè¡¨éƒ½ä¼šå‘é€åˆ°testçš„topicä¸‹
# ä¾‹å­3: test:test æŒ‡å®šåŒ¹é…å¯¹åº”çš„åº“ï¼Œä¸€ä¸ªåº“çš„æ‰€æœ‰è¡¨éƒ½ä¼šå‘é€åˆ°testçš„topicä¸‹
# ä¾‹å­4ï¼štestA:test\\..* æŒ‡å®šåŒ¹é…çš„è¡¨è¾¾å¼ï¼Œé’ˆå¯¹åŒ¹é…çš„è¡¨ä¼šå‘é€åˆ°testAçš„topicä¸‹
# ä¾‹å­5ï¼štest0:test,test1:test1\\.test1ï¼ŒæŒ‡å®šå¤šä¸ªè¡¨è¾¾å¼ï¼Œä¼šå°†teståº“çš„è¡¨éƒ½å‘é€åˆ°test0çš„topicä¸‹ï¼Œtest1\\.test1çš„è¡¨å‘é€åˆ°å¯¹åº”çš„test1çš„topicä¸‹ï¼Œå…¶ä½™çš„è¡¨å‘é€åˆ°é»˜è®¤çš„canal.mq.topicå€¼
# å¤§å®¶å¯ä»¥ç»“åˆè‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚ï¼Œè®¾ç½®åŒ¹é…è§„åˆ™ï¼Œå»ºè®®MQå¼€å¯è‡ªåŠ¨åˆ›å»ºtopicçš„èƒ½åŠ›

# canal.mq.partitionHash è¡¨è¾¾å¼è¯´æ˜
# canal 1.1.3ç‰ˆæœ¬ä¹‹å, æ”¯æŒé…ç½®æ ¼å¼ï¼šschema.table:pk1^pk2ï¼Œå¤šä¸ªé…ç½®ä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”

# ä¾‹å­1ï¼štest\\.test:pk1^pk2 æŒ‡å®šåŒ¹é…çš„å•è¡¨ï¼Œå¯¹åº”çš„hashå­—æ®µä¸ºpk1 + pk2
# ä¾‹å­2ï¼š.*\\..*:id æ­£åˆ™åŒ¹é…ï¼ŒæŒ‡å®šæ‰€æœ‰æ­£åˆ™åŒ¹é…çš„è¡¨å¯¹åº”çš„hashå­—æ®µä¸ºid
# ä¾‹å­3ï¼š.*\\..*:$pk$ æ­£åˆ™åŒ¹é…ï¼ŒæŒ‡å®šæ‰€æœ‰æ­£åˆ™åŒ¹é…çš„è¡¨å¯¹åº”çš„hashå­—æ®µä¸ºè¡¨ä¸»é”®(è‡ªåŠ¨æŸ¥æ‰¾)
# ä¾‹å­4: åŒ¹é…è§„åˆ™å•¥éƒ½ä¸å†™ï¼Œåˆ™é»˜è®¤å‘åˆ°0è¿™ä¸ªpartitionä¸Š
# ä¾‹å­5ï¼š.*\\..* ï¼Œä¸æŒ‡å®špkä¿¡æ¯çš„æ­£åˆ™åŒ¹é…ï¼Œå°†æ‰€æœ‰æ­£åˆ™åŒ¹é…çš„è¡¨,å¯¹åº”çš„hashå­—æ®µä¸ºè¡¨å
# æŒ‰è¡¨hash: ä¸€å¼ è¡¨çš„æ‰€æœ‰æ•°æ®å¯ä»¥å‘åˆ°åŒä¸€ä¸ªåˆ†åŒºï¼Œä¸åŒè¡¨ä¹‹é—´ä¼šåšæ•£åˆ— (ä¼šæœ‰çƒ­ç‚¹è¡¨åˆ†åŒºè¿‡å¤§é—®é¢˜)
# ä¾‹å­6: test\\.test:id,.\\..* , é’ˆå¯¹testçš„è¡¨æŒ‰ç…§idæ•£åˆ—,å…¶ä½™çš„è¡¨æŒ‰ç…§tableæ•£åˆ—
# æ³¨æ„ï¼šå¤§å®¶å¯ä»¥ç»“åˆè‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚ï¼Œè®¾ç½®åŒ¹é…è§„åˆ™ï¼Œå¤šæ¡åŒ¹é…è§„åˆ™ä¹‹é—´æ˜¯æŒ‰ç…§é¡ºåºè¿›è¡ŒåŒ¹é…(å‘½ä¸­ä¸€æ¡è§„åˆ™å°±è¿”å›)</code></pre></div>

<h3 id="å…¶ä½™é…ç½®å¯å‚è€ƒå®˜ç½‘wikiæ–‡æ¡£ï¼šalibaba-canal"><a href="#å…¶ä½™é…ç½®å¯å‚è€ƒå®˜ç½‘wikiæ–‡æ¡£ï¼šalibaba-canal" class="headerlink" title="å…¶ä½™é…ç½®å¯å‚è€ƒå®˜ç½‘wikiæ–‡æ¡£ï¼šalibaba/canal"></a>å…¶ä½™é…ç½®å¯å‚è€ƒå®˜ç½‘wikiæ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://github.com/alibaba/canal/wiki/QuickStart">alibaba/canal</a></h3><h2 id="æµ‹è¯•ç›‘å¬"><a href="#æµ‹è¯•ç›‘å¬" class="headerlink" title="æµ‹è¯•ç›‘å¬"></a>æµ‹è¯•ç›‘å¬</h2><p>ä½¿ç”¨kafkaå®¢æˆ·ç«¯æµ‹è¯•ï¼Œç”±äºæˆ‘ä½¿ç”¨çš„åŠ¨æ€topicï¼Œæ‰€ä»¥topicåç§°ä¸ºï¼š{åº“å}_{è¡¨å}</p>
<div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ğŸ“ âœ  kafka_2.12-2.2.2 .&#x2F;bin&#x2F;kafka-console-consumer.sh --bootstrap-server 127.0.0.1:9092 --topic test_article</code></pre></div>

<p>æ‰‹åŠ¨ä¿®æ”¹ä¸€æ¡è¯¥è¡¨çš„æ•°æ®ï¼Œå³å¯æ”¶åˆ°canalå‘é€çš„æ•°æ®åº“å˜æ›´æ¶ˆæ¯ï¼š</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-efdcbe72ea74b2357c99b31786999aaf840.png" srcset="/img/loading.gif"></p>
<h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><p>æ€»ä½“çš„æ­å»ºè¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œadminæ¨¡å—ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¯è§†åŒ–çš„ç®¡ç†ç•Œé¢ï¼Œç®€å•æ˜“ç”¨ï¼Œå•ç‹¬ä½¿ç”¨canal-serveræ¨¡å—ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯ä¿®æ”¹é…ç½®èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚</p>
<p>æ­¤å¤–ï¼Œåœ¨æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯é‡åˆ°äº†ä¸€äº›é—®é¢˜çš„ï¼Œä»¥ä¸‹ä»‹ç»å‡ ä¸ªè¸©å‘ç‚¹ï¼š</p>
<ul>
<li>canalç›‘å¬æ—¶ï¼Œæœ‰äº›åº“åå’Œè¡¨åæ˜¯ç©ºçš„ï¼Œå¯¼è‡´åœ¨åŠ¨æ€topicæƒ…å†µä¸‹ï¼Œkafkaæç¤ºæ— æ•ˆçš„topicåç§°ï¼Œæˆ‘ä»¬åœ¨é…ç½®ä¸­å°†ç©ºåº“åå’Œè¡¨åçš„æ¶ˆæ¯è¿‡æ»¤æ‰å°±å¥½ï¼Œå°†é»˜è®¤çš„<code>.*\\..*</code>æ”¹ä¸º<code>.+\\..+</code></li>
<li>æˆ‘çš„kafkaæ˜¯åœ¨æœ¬åœ°ä¸»æœºçš„ï¼Œéœ€è¦å¢åŠ kafkaé…ç½®<code>advertised.listeners=PLAINTEXT://host.docker.internal:9092</code> ï¼Œå®¹å™¨ä¸­çš„åº”ç”¨æ‰èƒ½æ­£å¸¸è®¿é—®kafkaæœåŠ¡ç«¯</li>
<li>åˆšå¼€å§‹åœ¨å¯åŠ¨canal-serveræ—¶ï¼Œæ€»æ˜¯è¿æ¥adminæœåŠ¡å¤±è´¥ï¼Œé¡µé¢ä¸Šæ‰€æœ‰æ¥å£ä¹Ÿæ— å“åº”ï¼Œä½†æ˜¯dockeræ˜¾ç¤ºadminå®¹å™¨è¿˜åœ¨è¿è¡Œï¼Œè¿›å…¥canal-adminå®¹å™¨åæŸ¥çœ‹æ—¥å¿—æ— æŠ¥é”™ï¼Œä½†æ˜¯åå°çš„javaè¿›ç¨‹å·²ç»æ²¡æœ‰äº†ï¼Œå›°æ‰°äº†æŒºä¹…ï¼Œåæ¥å‘ç°æˆ‘çš„dockerå†…å­˜é…ç½®åªæœ‰2Gï¼Œæ¨æµ‹æ˜¯å†…å­˜ä¸è¶³åœæ‰äº†ï¼Œäºæ˜¯å°†dockerå†…å­˜é…ç½®æ”¹ä¸º8Gï¼Œé—®é¢˜è§£å†³</li>
</ul>
<p><strong>æœ¬æ–¹æ¡ˆä»…é™äºæœ¬åœ°å­¦ä¹ ä¸æµ‹è¯•ï¼Œç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨HAæ¨¡å¼éƒ¨ç½²ï¼Œè¯¦è§ï¼š<a target="_blank" rel="noopener" href="https://github.com/alibaba/canal/wiki/AdminGuide#ha%E6%A8%A1%E5%BC%8F%E9%85%8D%E7%BD%AE">https://github.com/alibaba/canal/wiki/AdminGuide#haæ¨¡å¼é…ç½®</a></strong></p>
<h2 id="é™„å½•-GitHubç»å¸¸æ— æ³•ä¸‹è½½æ–‡ä»¶ï¼Œæä¾›ä¸€äº›ç”¨åˆ°çš„è„šæœ¬"><a href="#é™„å½•-GitHubç»å¸¸æ— æ³•ä¸‹è½½æ–‡ä»¶ï¼Œæä¾›ä¸€äº›ç”¨åˆ°çš„è„šæœ¬" class="headerlink" title="é™„å½•(GitHubç»å¸¸æ— æ³•ä¸‹è½½æ–‡ä»¶ï¼Œæä¾›ä¸€äº›ç”¨åˆ°çš„è„šæœ¬)"></a>é™„å½•(GitHubç»å¸¸æ— æ³•ä¸‹è½½æ–‡ä»¶ï¼Œæä¾›ä¸€äº›ç”¨åˆ°çš„è„šæœ¬)</h2><ul>
<li><p><strong>GitHubåœ°å€ï¼š</strong><a target="_blank" rel="noopener" href="https://github.com/alibaba/canal">https://github.com/alibaba/canal</a></p>
</li>
<li><p><strong>run_admin.sh</strong></p>
  <div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">#!&#x2F;bin&#x2F;bash

function usage() &#123;
    echo &quot;Usage:&quot;
    echo &quot;  run_admin.sh [CONFIG]&quot;
    echo &quot;example :&quot;
    echo &quot;  run_admin.sh -e server.port&#x3D;8089 \\&quot;
    echo &quot;         -e canal.adminUser&#x3D;admin \\&quot;
    echo &quot;         -e canal.adminPasswd&#x3D;admin&quot;
    exit
&#125;

function check_port() &#123;
    local port&#x3D;$1
    local TL&#x3D;$(which telnet)
    if [ -f $TL ]; then
        data&#x3D;&#96;echo quit | telnet 127.0.0.1 $port| grep -ic connected&#96;
        echo $data
        return
    fi

    local NC&#x3D;$(which nc)
    if [ -f $NC ]; then
        data&#x3D;&#96;nc -z -w 1 127.0.0.1 $port | grep -ic succeeded&#96;
        echo $data
        return
    fi
    echo &quot;0&quot;
    return
&#125;

function getMyIp() &#123;
    case &quot;&#96;uname&#96;&quot; in
        Darwin)
         myip&#x3D;&#96;echo &quot;show State:&#x2F;Network&#x2F;Global&#x2F;IPv4&quot; | scutil | grep PrimaryInterface | awk &#39;&#123;print $3&#125;&#39; | xargs ifconfig | grep inet | grep -v inet6 | awk &#39;&#123;print $2&#125;&#39;&#96;
         ;;
        *)
         myip&#x3D;&#96;ip route get 1 | awk &#39;&#123;print $NF;exit&#125;&#39;&#96;
         ;;
  esac
  echo $myip
&#125;

CONFIG&#x3D;$&#123;@:1&#125;
#VOLUMNS&#x3D;&quot;-v $DATA:&#x2F;home&#x2F;admin&#x2F;canal-admin&#x2F;logs&quot;
PORTLIST&#x3D;&quot;8089&quot;
PORTS&#x3D;&quot;&quot;
for PORT in $PORTLIST ; do
    #exist&#x3D;&#96;check_port $PORT&#96;
    exist&#x3D;&quot;0&quot;
    if [ &quot;$exist&quot; &#x3D;&#x3D; &quot;0&quot; ]; then
        PORTS&#x3D;&quot;$PORTS -p $PORT:$PORT&quot;
    else
        echo &quot;port $PORT is used , pls check&quot;
        exit 1
    fi
done

NET_MODE&#x3D;&quot;&quot;
case &quot;&#96;uname&#96;&quot; in
    Darwin)
        bin_abs_path&#x3D;&#96;cd $(dirname $0); pwd&#96;
        ;;
    Linux)
        bin_abs_path&#x3D;$(readlink -f $(dirname $0))
        NET_MODE&#x3D;&quot;--net&#x3D;host&quot;
        PORTS&#x3D;&quot;&quot;
        ;;
    *)
        NET_MODE&#x3D;&quot;--net&#x3D;host&quot;
        PORTS&#x3D;&quot;&quot;
        bin_abs_path&#x3D;&#96;cd $(dirname $0); pwd&#96;
        ;;
esac
BASE&#x3D;$&#123;bin_abs_path&#125;
DATA&#x3D;&quot;$BASE&#x2F;data&quot;
mkdir -p $DATA

if [ $# -eq 0 ]; then
    usage
elif [ &quot;$1&quot; &#x3D;&#x3D; &quot;-h&quot; ] ; then
    usage
elif [ &quot;$1&quot; &#x3D;&#x3D; &quot;help&quot; ] ; then
    usage
fi

MEMORY&#x3D;&quot;-m 1024m&quot;
LOCALHOST&#x3D;&#96;getMyIp&#96;
cmd&#x3D;&quot;docker run -d -it -h $LOCALHOST $CONFIG --name&#x3D;canal-admin $VOLUMNS $NET_MODE $PORTS $MEMORY canal&#x2F;canal-admin&quot;
echo $cmd
eval $cmd</code></pre></div>
</li>
<li><p><strong>run.sh</strong></p>
  <div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">#!&#x2F;bin&#x2F;bash

function usage() &#123;
    echo &quot;Usage:&quot;
    echo &quot;  run.sh [CONFIG]&quot;
    echo &quot;example 1 :&quot;
    echo &quot;  run.sh -e canal.instance.master.address&#x3D;127.0.0.1:3306 \\&quot;
    echo &quot;         -e canal.instance.dbUsername&#x3D;canal \\&quot;
    echo &quot;         -e canal.instance.dbPassword&#x3D;canal \\&quot;
    echo &quot;         -e canal.instance.connectionCharset&#x3D;UTF-8 \\&quot;
    echo &quot;         -e canal.instance.tsdb.enable&#x3D;true \\&quot;
    echo &quot;         -e canal.instance.gtidon&#x3D;false \\&quot;
    echo &quot;         -e canal.instance.filter.regex&#x3D;.*\\\\\\..* &quot;
    echo &quot;example 2 :&quot;
    echo &quot;  run.sh -e canal.admin.manager&#x3D;127.0.0.1:8089 \\&quot;
    echo &quot;         -e canal.admin.port&#x3D;11110 \\&quot;
    echo &quot;         -e canal.admin.user&#x3D;admin \\&quot;
    echo &quot;         -e canal.admin.passwd&#x3D;4ACFE3202A5FF5CF467898FC58AAB1D615029441&quot;
    exit
&#125;

function check_port() &#123;
    local port&#x3D;$1
    local TL&#x3D;$(which telnet)
    if [ -f $TL ]; then
        data&#x3D;&#96;echo quit | telnet 127.0.0.1 $port| grep -ic connected&#96;
        echo $data
        return
    fi

    local NC&#x3D;$(which nc)
    if [ -f $NC ]; then
        data&#x3D;&#96;nc -z -w 1 127.0.0.1 $port | grep -ic succeeded&#96;
        echo $data
        return
    fi
    echo &quot;0&quot;
    return
&#125;

function getMyIp() &#123;
    case &quot;&#96;uname&#96;&quot; in
        Darwin)
         myip&#x3D;&#96;echo &quot;show State:&#x2F;Network&#x2F;Global&#x2F;IPv4&quot; | scutil | grep PrimaryInterface | awk &#39;&#123;print $3&#125;&#39; | xargs ifconfig | grep inet | grep -v inet6 | awk &#39;&#123;print $2&#125;&#39;&#96;
         ;;
        *)
         myip&#x3D;&#96;ip route get 1 | awk &#39;&#123;print $NF;exit&#125;&#39;&#96;
         ;;
  esac
  echo $myip
&#125;

CONFIG&#x3D;$&#123;@:1&#125;
#VOLUMNS&#x3D;&quot;-v $DATA:&#x2F;home&#x2F;admin&#x2F;canal-server&#x2F;logs&quot;
PORTLIST&#x3D;&quot;11110 11111 11112 9100&quot;
PORTS&#x3D;&quot;&quot;
for PORT in $PORTLIST ; do
    #exist&#x3D;&#96;check_port $PORT&#96;
    exist&#x3D;&quot;0&quot;
    if [ &quot;$exist&quot; &#x3D;&#x3D; &quot;0&quot; ]; then
        PORTS&#x3D;&quot;$PORTS -p $PORT:$PORT&quot;
    else
        echo &quot;port $PORT is used , pls check&quot;
        exit 1
    fi
done

NET_MODE&#x3D;&quot;&quot;
case &quot;&#96;uname&#96;&quot; in
    Darwin)
        bin_abs_path&#x3D;&#96;cd $(dirname $0); pwd&#96;
        ;;
    Linux)
        bin_abs_path&#x3D;$(readlink -f $(dirname $0))
        NET_MODE&#x3D;&quot;--net&#x3D;host&quot;
        PORTS&#x3D;&quot;&quot;
        ;;
    *)
        bin_abs_path&#x3D;&#96;cd $(dirname $0); pwd&#96;
        NET_MODE&#x3D;&quot;--net&#x3D;host&quot;
        PORTS&#x3D;&quot;&quot;
        ;;
esac
BASE&#x3D;$&#123;bin_abs_path&#125;
DATA&#x3D;&quot;$BASE&#x2F;data&quot;
mkdir -p $DATA

if [ $# -eq 0 ]; then
    usage
elif [ &quot;$1&quot; &#x3D;&#x3D; &quot;-h&quot; ] ; then
    usage
elif [ &quot;$1&quot; &#x3D;&#x3D; &quot;help&quot; ] ; then
    usage
fi

MEMORY&#x3D;&quot;-m 4096m&quot;
LOCALHOST&#x3D;&#96;getMyIp&#96;
cmd&#x3D;&quot;docker run -d -it -h $LOCALHOST $CONFIG --name&#x3D;canal-server $VOLUMNS $NET_MODE $PORTS $MEMORY canal&#x2F;canal-server&quot;
echo $cmd
eval $cmd</code></pre></div>
</li>
<li><p><strong>serveré…ç½®æ–‡ä»¶æ¨¡æ¿(canal.properties)</strong></p>
  <div class="code-wrapper"><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties">#################################################
######### 		common argument		#############
#################################################
# tcp bind ip
canal.ip &#x3D;
# register ip to zookeeper
canal.register.ip &#x3D;
canal.port &#x3D; 11111
canal.metrics.pull.port &#x3D; 11112
# canal instance user&#x2F;passwd
# canal.user &#x3D; canal
# canal.passwd &#x3D; E3619321C1A937C46A0D8BD1DAC39F93B27D4458

# canal admin config
#canal.admin.manager &#x3D; 127.0.0.1:8089
canal.admin.port &#x3D; 11110
canal.admin.user &#x3D; admin
canal.admin.passwd &#x3D; 4ACFE3202A5FF5CF467898FC58AAB1D615029441

canal.zkServers &#x3D;
# flush data to zk
canal.zookeeper.flush.period &#x3D; 1000
canal.withoutNetty &#x3D; false
# tcp, kafka, rocketMQ, rabbitMQ
canal.serverMode &#x3D; tcp
# flush meta cursor&#x2F;parse position to file
canal.file.data.dir &#x3D; $&#123;canal.conf.dir&#125;
canal.file.flush.period &#x3D; 1000
## memory store RingBuffer size, should be Math.pow(2,n)
canal.instance.memory.buffer.size &#x3D; 16384
## memory store RingBuffer used memory unit size , default 1kb
canal.instance.memory.buffer.memunit &#x3D; 1024 
## meory store gets mode used MEMSIZE or ITEMSIZE
canal.instance.memory.batch.mode &#x3D; MEMSIZE
canal.instance.memory.rawEntry &#x3D; true

## detecing config
canal.instance.detecting.enable &#x3D; false
#canal.instance.detecting.sql &#x3D; insert into retl.xdual values(1,now()) on duplicate key update x&#x3D;now()
canal.instance.detecting.sql &#x3D; select 1
canal.instance.detecting.interval.time &#x3D; 3
canal.instance.detecting.retry.threshold &#x3D; 3
canal.instance.detecting.heartbeatHaEnable &#x3D; false

# support maximum transaction size, more than the size of the transaction will be cut into multiple transactions delivery
canal.instance.transaction.size &#x3D;  1024
# mysql fallback connected to new master should fallback times
canal.instance.fallbackIntervalInSeconds &#x3D; 60

# network config
canal.instance.network.receiveBufferSize &#x3D; 16384
canal.instance.network.sendBufferSize &#x3D; 16384
canal.instance.network.soTimeout &#x3D; 30

# binlog filter config
canal.instance.filter.druid.ddl &#x3D; true
canal.instance.filter.query.dcl &#x3D; false
canal.instance.filter.query.dml &#x3D; false
canal.instance.filter.query.ddl &#x3D; false
canal.instance.filter.table.error &#x3D; false
canal.instance.filter.rows &#x3D; false
canal.instance.filter.transaction.entry &#x3D; false

# binlog format&#x2F;image check
canal.instance.binlog.format &#x3D; ROW,STATEMENT,MIXED 
canal.instance.binlog.image &#x3D; FULL,MINIMAL,NOBLOB

# binlog ddl isolation
canal.instance.get.ddl.isolation &#x3D; false

# parallel parser config
canal.instance.parser.parallel &#x3D; true
## concurrent thread number, default 60% available processors, suggest not to exceed Runtime.getRuntime().availableProcessors()
#canal.instance.parser.parallelThreadSize &#x3D; 16
## disruptor ringbuffer size, must be power of 2
canal.instance.parser.parallelBufferSize &#x3D; 256

# table meta tsdb info
canal.instance.tsdb.enable &#x3D; true
canal.instance.tsdb.dir &#x3D; $&#123;canal.file.data.dir:..&#x2F;conf&#125;&#x2F;$&#123;canal.instance.destination:&#125;
canal.instance.tsdb.url &#x3D; jdbc:h2:$&#123;canal.instance.tsdb.dir&#125;&#x2F;h2;CACHE_SIZE&#x3D;1000;MODE&#x3D;MYSQL;
canal.instance.tsdb.dbUsername &#x3D; canal
canal.instance.tsdb.dbPassword &#x3D; canal
# dump snapshot interval, default 24 hour
canal.instance.tsdb.snapshot.interval &#x3D; 24
# purge snapshot expire , default 360 hour(15 days)
canal.instance.tsdb.snapshot.expire &#x3D; 360

#################################################
######### 		destinations		#############
#################################################
canal.destinations &#x3D; 
# conf root dir
canal.conf.dir &#x3D; ..&#x2F;conf
# auto scan instance dir add&#x2F;remove and start&#x2F;stop instance
canal.auto.scan &#x3D; true
canal.auto.scan.interval &#x3D; 5

canal.instance.tsdb.spring.xml &#x3D; classpath:spring&#x2F;tsdb&#x2F;h2-tsdb.xml
#canal.instance.tsdb.spring.xml &#x3D; classpath:spring&#x2F;tsdb&#x2F;mysql-tsdb.xml

canal.instance.global.mode &#x3D; manager
canal.instance.global.lazy &#x3D; false
canal.instance.global.manager.address &#x3D; $&#123;canal.admin.manager&#125;
#canal.instance.global.spring.xml &#x3D; classpath:spring&#x2F;memory-instance.xml
canal.instance.global.spring.xml &#x3D; classpath:spring&#x2F;file-instance.xml
#canal.instance.global.spring.xml &#x3D; classpath:spring&#x2F;default-instance.xml

##################################################
######### 	      MQ Properties      #############
##################################################
# aliyun ak&#x2F;sk , support rds&#x2F;mq
canal.aliyun.accessKey &#x3D;
canal.aliyun.secretKey &#x3D;
canal.aliyun.uid&#x3D;

canal.mq.flatMessage &#x3D; true
canal.mq.canalBatchSize &#x3D; 50
canal.mq.canalGetTimeout &#x3D; 100
# Set this value to &quot;cloud&quot;, if you want open message trace feature in aliyun.
canal.mq.accessChannel &#x3D; local

canal.mq.database.hash &#x3D; true
canal.mq.send.thread.size &#x3D; 30
canal.mq.build.thread.size &#x3D; 8

##################################################
######### 		     Kafka 		     #############
##################################################
kafka.bootstrap.servers &#x3D; 127.0.0.1:6667
kafka.acks &#x3D; all
kafka.compression.type &#x3D; none
kafka.batch.size &#x3D; 16384
kafka.linger.ms &#x3D; 1
kafka.max.request.size &#x3D; 1048576
kafka.buffer.memory &#x3D; 33554432
kafka.max.in.flight.requests.per.connection &#x3D; 1
kafka.retries &#x3D; 0

kafka.kerberos.enable &#x3D; false
kafka.kerberos.krb5.file &#x3D; &quot;..&#x2F;conf&#x2F;kerberos&#x2F;krb5.conf&quot;
kafka.kerberos.jaas.file &#x3D; &quot;..&#x2F;conf&#x2F;kerberos&#x2F;jaas.conf&quot;

##################################################
######### 		    RocketMQ	     #############
##################################################
rocketmq.producer.group &#x3D; test
rocketmq.enable.message.trace &#x3D; false
rocketmq.customized.trace.topic &#x3D;
rocketmq.namespace &#x3D;
rocketmq.namesrv.addr &#x3D; 127.0.0.1:9876
rocketmq.retry.times.when.send.failed &#x3D; 0
rocketmq.vip.channel.enabled &#x3D; false

##################################################
######### 		    RabbitMQ	     #############
##################################################
rabbitmq.host &#x3D;
rabbitmq.virtual.host &#x3D;
rabbitmq.exchange &#x3D;
rabbitmq.username &#x3D;
rabbitmq.password &#x3D;</code></pre></div>
</li>
<li><p><strong>instanceæ¨¡æ¿é…ç½®(instance.propertios)</strong></p>
  <div class="code-wrapper"><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties">#################################################
## mysql serverId , v1.0.26+ will autoGen
# canal.instance.mysql.slaveId&#x3D;0

# enable gtid use true&#x2F;false
canal.instance.gtidon&#x3D;false

# position info
canal.instance.master.address&#x3D;127.0.0.1:3306
canal.instance.master.journal.name&#x3D;
canal.instance.master.position&#x3D;
canal.instance.master.timestamp&#x3D;
canal.instance.master.gtid&#x3D;

# rds oss binlog
canal.instance.rds.accesskey&#x3D;
canal.instance.rds.secretkey&#x3D;
canal.instance.rds.instanceId&#x3D;

# table meta tsdb info
canal.instance.tsdb.enable&#x3D;true
#canal.instance.tsdb.url&#x3D;jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;canal_tsdb
#canal.instance.tsdb.dbUsername&#x3D;canal
#canal.instance.tsdb.dbPassword&#x3D;canal

#canal.instance.standby.address &#x3D;
#canal.instance.standby.journal.name &#x3D;
#canal.instance.standby.position &#x3D;
#canal.instance.standby.timestamp &#x3D;
#canal.instance.standby.gtid&#x3D;

# username&#x2F;password
canal.instance.dbUsername&#x3D;canal
canal.instance.dbPassword&#x3D;canal
canal.instance.connectionCharset &#x3D; UTF-8
# enable druid Decrypt database password
canal.instance.enableDruid&#x3D;false
#canal.instance.pwdPublicKey&#x3D;MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBALK4BUxdDltRRE5&#x2F;zXpVEVPUgunvscYFtEip3pmLlhrWpacX7y7GCMo2&#x2F;JM6LeHmiiNdH1FWgGCpUfircSwlWKUCAwEAAQ&#x3D;&#x3D;

# table regex
canal.instance.filter.regex&#x3D;.*\\..*
# table black regex
canal.instance.filter.black.regex&#x3D;
# table field filter(format: schema1.tableName1:field1&#x2F;field2,schema2.tableName2:field1&#x2F;field2)
#canal.instance.filter.field&#x3D;test1.t_product:id&#x2F;subject&#x2F;keywords,test2.t_company:id&#x2F;name&#x2F;contact&#x2F;ch
# table field black filter(format: schema1.tableName1:field1&#x2F;field2,schema2.tableName2:field1&#x2F;field2)
#canal.instance.filter.black.field&#x3D;test1.t_product:subject&#x2F;product_image,test2.t_company:id&#x2F;name&#x2F;contact&#x2F;ch

# mq config
canal.mq.topic&#x3D;example
# dynamic topic route by schema or table regex
#canal.mq.dynamicTopic&#x3D;mytest1.user,mytest2\\..*,.*\\..*
canal.mq.partition&#x3D;0
# hash partition config
#canal.mq.partitionsNum&#x3D;3
#canal.mq.partitionHash&#x3D;test.table:id^name,.*\\..*
#################################################</code></pre></div>
</li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/docker/">docker</a>
                    
                      <a class="hover-with-bg" href="/tags/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/">åç«¯å¼€å‘</a>
                    
                      <a class="hover-with-bg" href="/tags/MySQL/">MySQL</a>
                    
                      <a class="hover-with-bg" href="/tags/canal/">canal</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/03/25/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E2%80%94%E2%80%94%E6%A0%B9%E6%8D%AE%E8%A1%A8%E5%85%B3%E7%B3%BB%E6%9E%84%E5%BB%BASQL%E8%AF%AD%E5%8F%A5/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">æ•°æ®ç»“æ„ä¸ç®—æ³•çš„å®é™…åº”ç”¨â€”â€”æ ¹æ®è¡¨å…³ç³»æ„å»ºSQLè¯­å¥</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/01/07/jar%E5%8C%85%E6%89%A7%E8%A1%8C%E6%97%B6%E8%AE%BF%E9%97%AE%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E9%80%A0%E6%88%90%E7%9A%84FileSystemNotFoundException%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/">
                        <span class="hidden-mobile">jaråŒ…æ‰§è¡Œæ—¶è®¿é—®èµ„æºæ–‡ä»¶é€ æˆçš„FileSystemNotFoundExceptioné—®é¢˜</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div id="vcomments"></div>
  <script type="text/javascript">
    Fluid.utils.waitElementVisible('vcomments', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', function () {
        new Valine({
          el: "#vcomments",
          app_id: "QkswS3xEGrTbK0dmA0NX2KTV-gzGzoHsz",
          app_key: "uiXDBJGFOOhknLymw8GW28MN",
          placeholder: "è¯´ç‚¹ä»€ä¹ˆ",
          path: window.location.pathname,
          avatar: "retro",
          meta: ["nick","mail","link"],
          pageSize: "10",
          lang: "zh-CN",
          highlight: false,
          recordIP: false,
          serverURLs: "",
        });
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the
    <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments powered by Valine.</a>
  </noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     Powered&nbsp;By&nbsp;<a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span style="font-weight: bolder">Hexo</span></a> <i class="iconfont icon-love"></i>&nbsp;Theme:  <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span style="font-weight: bolder">Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":200})
    NProgress.start()
    document.addEventListener('DOMContentLoaded', function() {
      window.NProgress && window.NProgress.inc();
    })
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  
    
      <script  src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-core.min.js" ></script>
      <script  src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/autoloader/prism-autoloader.min.js" ></script>
      
        <script  src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/line-numbers/prism-line-numbers.min.js" ></script>
      
    
  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>



</body>
</html>
