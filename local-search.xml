<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•çš„å®é™…åº”ç”¨â€”â€”æ ¹æ®è¡¨å…³ç³»æ„å»ºSQLè¯­å¥</title>
    <link href="/2021/03/25/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E2%80%94%E2%80%94%E6%A0%B9%E6%8D%AE%E8%A1%A8%E5%85%B3%E7%B3%BB%E6%9E%84%E5%BB%BASQL%E8%AF%AD%E5%8F%A5/"/>
    <url>/2021/03/25/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E2%80%94%E2%80%94%E6%A0%B9%E6%8D%AE%E8%A1%A8%E5%85%B3%E7%B3%BB%E6%9E%84%E5%BB%BASQL%E8%AF%AD%E5%8F%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="æ•°æ®ç»“æ„ä¸ç®—æ³•çš„å®é™…åº”ç”¨â€”â€”æ ¹æ®è¡¨å…³ç³»æ„å»ºSQLè¯­å¥"><a href="#æ•°æ®ç»“æ„ä¸ç®—æ³•çš„å®é™…åº”ç”¨â€”â€”æ ¹æ®è¡¨å…³ç³»æ„å»ºSQLè¯­å¥" class="headerlink" title="æ•°æ®ç»“æ„ä¸ç®—æ³•çš„å®é™…åº”ç”¨â€”â€”æ ¹æ®è¡¨å…³ç³»æ„å»ºSQLè¯­å¥"></a>æ•°æ®ç»“æ„ä¸ç®—æ³•çš„å®é™…åº”ç”¨â€”â€”æ ¹æ®è¡¨å…³ç³»æ„å»ºSQLè¯­å¥</h1><h2 id="èƒŒæ™¯éœ€æ±‚"><a href="#èƒŒæ™¯éœ€æ±‚" class="headerlink" title="èƒŒæ™¯éœ€æ±‚"></a>èƒŒæ™¯éœ€æ±‚</h2><p>æœ€è¿‘åœ¨é¡¹ç›®ä¸­æœ‰ä¸€ä¸ªåœºæ™¯ï¼Œæ ¹æ®å‰ç«¯å¯è§†åŒ–æ¨¡å¼ä¼ å…¥çš„å‚æ•°æ„å»ºä¸€ç»„SQLè¯­å¥ï¼Œåº”ç”¨åœ¨Spark Streamingåº”ç”¨çš„æ•°æ®åŒæ­¥ä¸­ã€‚è¿™å…¶å®æ˜¯ä¸€ä¸ªå·²æœ‰çš„åŠŸèƒ½ï¼Œä½†æ˜¯å‘ç°åŸå…ˆçš„ä»£ç å®ç°å‘ç°æœ‰è¾ƒä¸¥é‡çš„é—®é¢˜ï¼Œå¯¼è‡´è¯¥åŠŸèƒ½åœ¨æœ‰å…³è”æŸ¥è¯¢æ—¶ä¸å¯ç”¨ï¼Œæˆ‘ç»è¿‡è°ƒç ”ä¹‹åå†³å®šé‡æ–°å®ç°ã€‚</p><p>è¿™äº›SQLç”±æ™®é€šçš„Lookup SQLå’ŒSpark SQLç»„æˆï¼ŒLookup SQLç”¨äºæŸ¥è¯¢å…³è”æ•°æ®ï¼ŒSparkSQLåˆ™ç”¨äºè¾“å‡ºç»“æœï¼Œæ ¸å¿ƒé—®é¢˜åœ¨äºå¦‚ä½•åˆç†ç»„ç»‡è¿™äº›è¡¨çš„å…³è”å…³ç³»ã€‚</p><p>PSï¼šå®ç°ä»£ç ä¸ºScalaè¯­è¨€ã€‚</p><h2 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h2><p>å…¶ä¸­å‰ç«¯ä¼ å…¥çš„å‚æ•°ä¸º</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">case class UpdateTask(                      @BeanProperty id: Option[Long],                      @BeanProperty taskName: Option[String],                      @BeanProperty taskDesc: Option[String],                      @BeanProperty sourceInstance: Option[String],                      @BeanProperty targetInstance: Option[Long],                      @BeanProperty eventInstance: Option[Long],                      @BeanProperty sourceTree: Option[Seq[Long]],                      @BeanProperty selectSourceTree: Option[Seq[Long]],                      @BeanProperty targetTree: Option[Long],                      @BeanProperty eventTable: Option[Long],                      @BeanProperty tableRelation: Option[Seq[TableRelation]],                      @BeanProperty filterCondition: Option[String],                      @BeanProperty targetCalculateTableName: Option[String],                      @BeanProperty targetCalculate: Option[Seq[TargetCalculate]],                      @BeanProperty sourceTableField: Option[Seq[TableColumnInfo]],                      @BeanProperty sqlType: Option[Int],                      @BeanProperty classicSql: Option[String],                      @BeanProperty sinkConfig: Option[String],                      @BeanProperty targetPrimaryKey: Option[Seq[String]]                     ) extends SimpleBaseEntity</code></pre><p>æ‰€éœ€è¦ç”¨çš„å‚æ•°ä¸º</p><ul><li><p><code>eventTable</code> : è§¦å‘è¡¨</p></li><li><p><code>tableRelation</code> : è¡¨å…³è”å…³ç³»åˆ—è¡¨ï¼Œå…¶ä¸­<code>TableRelation</code> çš„ç»“æ„ä¸º</p>  <pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">case class TableRelation(@BeanProperty leftTableSelect: Long,                         @BeanProperty rightTableSelect: Long,                         @BeanProperty leftColumnSelect: String,                         @BeanProperty rightColumnSelect: String)</code></pre></li><li><p><code>targetCalculate</code> : è¾“å‡ºç»“æœçš„è®¡ç®—è¡¨è¾¾å¼ï¼Œå…¶ä¸­ <code>TargetCalculate</code> çš„ç»“æ„ä¸º</p>  <pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">case class TargetCalculate(@BeanProperty columnName: String,                           @BeanProperty config: String)</code></pre></li><li><p><code>selectSourceTree</code> : æ‰€ç”¨åˆ°çš„æºè¡¨</p></li></ul><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>å½“æ²¡æœ‰å…³è”å…³ç³»çš„æ—¶å€™ï¼Œæ¯”è¾ƒç®€å•ï¼Œä¸åœ¨æ­¤è®¨è®ºã€‚å½“æœ‰å¤šä¸ªå…³è”å…³ç³»æ—¶ï¼Œåº”è¯¥å…ˆæŸ¥è¯¢å‡ºè¢«å…³è”çš„è¡¨æ•°æ®ï¼Œå†æŸ¥è¯¢ä¸‹ä¸€çº§çš„è¡¨ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå®é™…åœºæ™¯ä¸‹å¯èƒ½ä¸€èˆ¬åªæœ‰ä¸€ä¸¤ä¸ªè¡¨å…³è”ï¼Œä½†æ˜¯æ¯•ç«Ÿè¿˜æ˜¯éœ€è¦è€ƒè™‘æç«¯æƒ…å†µï¼ŒåŸå…ˆçš„å®ç°åªè€ƒè™‘äº†ç®€å•çš„å…³è”ï¼Œå¤æ‚ä¸€ç‚¹çš„å…³è”åˆ™æ— æ³•å¤„ç†ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´æ€è€ƒåï¼Œå†³å®šåŸºäºæ ‘è¿™ç§æ•°æ®ç»“æ„å»å®ç°æ­¤åŠŸèƒ½ã€‚</p><p>å‡è®¾ä¼ å…¥äº†å¦‚ä¸‹ä¸€äº›è¡¨å…³ç³»ï¼Œå¹¶ä¸”Aè¡¨ä¸ºæºè¡¨ï¼ˆè§¦å‘è¡¨ï¼‰ï¼š</p><pre class="line-numbers language-none"><code class="language-none">A &lt;-&gt; BA &lt;-&gt; CA &lt;-&gt; DB &lt;-&gt; EB &lt;-&gt; FE &lt;-&gt; GC &lt;-&gt; HC &lt;-&gt; I</code></pre><p>åˆ™ç»è¿‡å¤„ç†åï¼Œå¯ä»¥ç”Ÿæˆå¦‚ä¸‹ä¸€ä¸ªæ ‘</p><pre class="line-numbers language-none"><code class="language-none">             --&gt; E &lt;--&gt; G    --&gt; B &lt;--|    |        --&gt; F    |A &lt;----&gt; D    |    |        --&gt; H    --&gt; C &lt;--|             --&gt; I</code></pre><p>åœ¨æ­¤éœ€è¦è¯´æ˜ï¼Œä¸éœ€è¦è€ƒè™‘å·¦å³é¡ºåºé—®é¢˜ï¼Œä¾‹å¦‚ A &lt;-&gt; B ç­‰ä»·äº B &lt;-&gt; Aï¼Œåœ¨åé¢å¯¹æ­¤é—®é¢˜ä¼šæœ‰è¯´æ˜ã€‚</p><p>å½“ä¼ å…¥äº†å¤šä¸ªç›¸åŒçš„è¡¨å…³è”å…³ç³»æ—¶ï¼Œéœ€è¦åšä¸€ä¸ªèšåˆï¼Œå› ä¸ºå‰ç«¯çš„å‚æ•°ä¸­ï¼Œæ¯ä¸€ä¸ªå…³è”å…³ç³»åªåŒ…å«ä¸€ç»„å…³è”å­—æ®µï¼Œæ‰€ä»¥å½“æœ‰å¤šä¸ªå…³è”å­—æ®µæ—¶ï¼Œå°±ä¼ å…¥äº†å¤šä¸ªç›¸åŒçš„å…³è”å…³ç³»ï¼Œä½†æ˜¯å…³è”å­—æ®µä¸åŒã€‚</p><p>å¾—åˆ°è¿™ä¸ªæ ‘å½¢å…³ç³»åï¼Œä¹ŸåŒæ—¶å¾—åˆ°äº†è¡¨ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªå‰æï¼Œ æ¯ä¸ªè¡¨åªèƒ½ä¾èµ–ä¸€ä¸ªè¡¨ï¼Œå‡è®¾å¦‚ä¸‹å…³ç³»ï¼š</p><pre class="line-numbers language-none"><code class="language-none">             --&gt; E &lt;--&gt; G    --&gt; B &lt;--|    |        --&gt; F    |A &lt;----&gt; D    |    |        --&gt; H    --&gt; G &lt;--|             --&gt; I</code></pre><p>æ­¤æ—¶ï¼ŒGè¡¨æ—¢å¯ä»¥ç”±Aå¾—åˆ°ï¼Œåˆå¯ä»¥ç”±Eå¾—åˆ°ï¼Œå‡è®¾ä»Aè¡¨å¾—åˆ°Gè¡¨ï¼Œé‚£ä¹ˆä»Gè¡¨åˆå¯ä»¥å¾—åˆ°Eè¡¨â€¦â€¦äº§ç”Ÿäº†æ­§ä¹‰ï¼Œå¹¶ç”±æ­¤äº§ç”Ÿä¸€ä¸ªäº†æœ‰ç¯å›¾ã€‚ä½†æ˜¯æˆ‘ä»¬éœ€æ±‚ä¸­ç›®å‰æ²¡æœ‰è¿™ç§å…³è”å…³ç³»ï¼ˆå› ä¸ºå‰ç«¯é…ç½®é¡µé¢ä¸­ï¼Œæ²¡æœ‰æ ‡è¯†å…³è”çš„æ–¹å‘æ€§ï¼Œå³ç›®å‰å¯è§†åŒ–æ¨¡å¼ä¼ å…¥çš„å…³è”å…³ç³»éƒ½æ˜¯åŒå‘ï¼Œå¯¹äºä¸€ç»„å…³ç³»ï¼Œæ—¢å¯ä»¥ä»Aå¾—åˆ°Bï¼Œä¹Ÿå¯ä»¥ä»Bå¾—åˆ°Aï¼Œä¹Ÿå°±æ˜¯å‰é¢çš„ï¼šA &lt;-&gt; B ç­‰ä»·äº B &lt;-&gt; Aï¼‰ï¼Œæ‰€ä»¥ä¸è€ƒè™‘è¿™ç§æƒ…å†µï¼Œå‡ºç°æ—¶ç»™äºˆæŠ¥é”™ï¼Œæç¤ºä¾èµ–å…³ç³»äº§ç”Ÿäº†ç¯ã€‚å¦‚æœæœ‰æ–¹å‘æ€§çš„è¯ï¼Œæˆ‘ä»¬ç”Ÿæˆæ ‘çš„ç®—æ³•ä¼šæ›´ç®€å•ä¸€äº›ï¼Œç›´æ¥DFSå³å¯ï¼Œä½†æ˜¯å¯¹äºé‡å¤å‡ºç°çš„è¡¨ï¼Œéœ€è¦åšé¢å¤–å¤„ç†ï¼Œä¾‹å¦‚ç»™é‡å¤è¡¨èµ·åˆ«åï¼Œä¿è¯ç»“æœé›†ä¸ä¼šå‡ºç°é‡åå­—æ®µï¼Œå¦åˆ™Sparkåœ¨å¤„ç†è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿå¼‚å¸¸ã€‚</p><p>åœ¨å¾—åˆ°è¿™ä¸ªä¾èµ–å…³ç³»åï¼Œåé¢çš„äº‹æƒ…å°±å¥½åŠäº†ï¼Œæˆ‘ä»¬ä»æ ¹èŠ‚ç‚¹å¼€å§‹å±‚åºéå†ï¼ˆä¹Ÿå³ä¸ºBFSå¹¿åº¦ä¼˜å…ˆéå†ï¼‰ï¼Œé€å±‚æ„å»ºSQLè¯­å¥ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨æ ‘çš„å…ˆåºéå†ï¼ˆDFSæ·±åº¦ä¼˜å…ˆï¼‰ï¼Œåªè¦ä¿è¯å­èŠ‚ç‚¹åœ¨çˆ¶èŠ‚ç‚¹åé¢éå†å³å¯ï¼Œä¿è¯åé¢çš„SQLè¯­å¥ç”¨åˆ°çš„å…³è”å‚æ•°åœ¨å‰é¢çš„SQLä¸­å·²ç»æŸ¥è¯¢åˆ°ã€‚</p><p>åœ¨ç”ŸæˆSQLçš„è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†é¿å…ä¸åŒåº“è¡¨æœ‰ç›¸åŒçš„è¡¨åæˆ–å­—æ®µåï¼Œé™¤äº†æœ€åä¸€å¥è¾“å‡ºç»“æœçš„Spark SQLï¼Œå‰é¢çš„SQLæŸ¥è¯¢å­—æ®µå‡éœ€è¦èµ·ä¸€ä¸ªåˆ«åï¼Œåœ¨æ­¤æ²¿ç”¨ä¹‹å‰æ—§ä»£ç çš„æ–¹æ¡ˆï¼šä½¿ç”¨ <code>&#123;å­—æ®µå&#125; AS &#123;åº“å&#125;__&#123;è¡¨å&#125;__&#123;å­—æ®µå&#125;</code> çš„å½¢å¼ä¿è¯å­—æ®µåä¸ä¼šé‡å¤</p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><h3 id="æ•°æ®ç»“æ„ç±»å®šä¹‰"><a href="#æ•°æ®ç»“æ„ç±»å®šä¹‰" class="headerlink" title="æ•°æ®ç»“æ„ç±»å®šä¹‰"></a>æ•°æ®ç»“æ„ç±»å®šä¹‰</h3><p>æœ‰äº†æ€è·¯ä¹‹åï¼Œä¾¿å¼€å§‹ç€æ‰‹å®ç°æ­¤åŠŸèƒ½ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªæ ‘èŠ‚ç‚¹çš„caseç±»ï¼š</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">case class TableRelationTreeNode(value: Long, &#x2F;&#x2F; å½“å‰èŠ‚ç‚¹çš„è¡¨id                                 parentRelation: LinkRelation, &#x2F;&#x2F; å’Œçˆ¶èŠ‚ç‚¹çš„å…³è”å…³ç³»                                 childs: ListBuffer[TableRelationTreeNode]  &#x2F;&#x2F; å­èŠ‚ç‚¹                                 )</code></pre><p><code>LinkRelation</code> æè¿°äº†ä¸¤ä¸ªè¡¨ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œæ˜¯å¯¹å‰ç«¯ä¼ å…¥çš„<code>TableRelation</code>èšåˆåçš„ç»“æœï¼š</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">case class LinkRelation(leftTable: Long, &#x2F;&#x2F; å·¦è¡¨id                        rightTable: Long, &#x2F;&#x2F; å³è¡¨id                        linkFields: Seq[(String, String)] &#x2F;&#x2F; å…³è”å­—æ®µ, å…ƒç»„çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«ä¸ºå·¦è¡¨å­—æ®µã€å³è¡¨å­—æ®µ                        )</code></pre><h3 id="å…³è”å…³ç³»æ ‘çš„æ„å»º"><a href="#å…³è”å…³ç³»æ ‘çš„æ„å»º" class="headerlink" title="å…³è”å…³ç³»æ ‘çš„æ„å»º"></a>å…³è”å…³ç³»æ ‘çš„æ„å»º</h3><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">&#x2F;** * @param parentNode      çˆ¶èŠ‚ç‚¹ * @param remainRelations å‰©ä½™å…³è”å…³ç³» *&#x2F;def buildRelationTree(parentNode: TableRelationTreeNode, remainRelations: ListBuffer[LinkRelation]): Any &#x3D; &#123;  if (remainRelations.isEmpty) return  val parentTableId &#x3D; parentNode.value;  &#x2F;&#x2F; æ‰¾å‡ºå…³è”å…³ç³»ä¸­åŒ…å«çˆ¶èŠ‚ç‚¹çš„è¡¨id  val childRelation &#x3D; remainRelations.filter(e &#x3D;&gt; e.leftTable &#x3D;&#x3D; parentTableId || e.rightTable &#x3D;&#x3D; parentTableId)  if (childRelation.isEmpty) return  &#x2F;&#x2F; å°†å…³è”å…³ç³»ä¸­çˆ¶èŠ‚ç‚¹çš„å…³è”ä¿¡æ¯ç½®äºå·¦ä¾§ï¼Œæ–¹ä¾¿åç»­æ“ä½œ  childRelation    .map(e &#x3D;&gt; if (e.leftTable &#x3D;&#x3D; parentTableId) e else LinkRelation(e.rightTable, e.leftTable, e.linkFields.map(e &#x3D;&gt; (e._2, e._1))))    .foreach&#123;e &#x3D;&gt; parentNode.childs +&#x3D; TableRelationTreeNode(e.rightTable, e, new ListBuffer())&#125;&#x2F;&#x2F; ç§»é™¤å·²ç»ä½¿ç”¨è¿‡çš„å…³è”å…³ç³»  remainRelations --&#x3D; childRelation  parentNode.childs foreach &#123;buildRelationTree(_, remainRelations)&#125;&#125;</code></pre><h3 id="SQLè¯­å¥ç”Ÿæˆçš„æ ¸å¿ƒä»£ç "><a href="#SQLè¯­å¥ç”Ÿæˆçš„æ ¸å¿ƒä»£ç " class="headerlink" title="SQLè¯­å¥ç”Ÿæˆçš„æ ¸å¿ƒä»£ç "></a>SQLè¯­å¥ç”Ÿæˆçš„æ ¸å¿ƒä»£ç </h3><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">def buildTransSQL(task: UpdateTask): Seq[String] &#x3D; &#123;&#x2F;&#x2F; å­˜å‚¨æ‰€æœ‰ç”¨åˆ°çš„è¡¨ï¼ˆnamespaceä¸ºè¡¨çš„ä¿¡æ¯ï¼‰    val namespacesRef &#x3D; mutable.HashMap[Long, Namespace]()    task.selectSourceTree.get.foreach(i &#x3D;&gt; namespacesRef +&#x3D; (kv &#x3D; (i, Await.result(namespaceDal.findById(i), minTimeOut).get)))    val targetTableId &#x3D; task.targetTree.get&#x2F;&#x2F; ç›®æ ‡è¡¨    val targetNamespace &#x3D; Await.result(namespaceDal.findById(targetTableId), minTimeOut).head    namespacesRef.put(targetTableId, targetNamespace)    val eventTableId &#x3D; task.eventTable.get&#x2F;&#x2F; äº‹ä»¶è¡¨ï¼ˆæº&#x2F;è§¦å‘è¡¨ï¼‰    val eventNamespace &#x3D; namespacesRef(eventTableId)&#x2F;&#x2F; æ²¡æœ‰è®¡ç®—é€»è¾‘ï¼Œå½“åšé•œåƒåŒæ­¥ï¼Œç›´æ¥SELECT * ...    if (task.targetCalculate.isEmpty)      return Seq.newBuilder.+&#x3D;(s&quot;spark_sql&#x3D; select * from $&#123;eventNamespace.nsTable&#125;;&quot;).result()    val transSqlList &#x3D; new ListBuffer[String]    &#x2F;&#x2F; å…ˆå°†è§¦å‘è¡¨çš„æ‰€æœ‰å­—æ®µæŸ¥è¯¢å‡ºæ¥    transSqlList +&#x3D; s&quot;spark_sql&#x3D; select $&#123;      sourceDataDal.getSourceDataTableField(eventTableId).filter(_ !&#x3D; &quot;ums_active_&quot;).map(e &#x3D;&gt; &#123;        s&quot;$e AS $&#123;eventNamespace.nsDatabase&#125;__$&#123;eventNamespace.nsTable&#125;__$e&quot;      &#125;).mkString(&quot;, &quot;)    &#125; from $&#123;eventNamespace.nsTable&#125;&quot;    if (task.getTableRelation.nonEmpty) &#123;      val remainLinks &#x3D; new ListBuffer[LinkRelation]()      &#x2F;&#x2F; èšåˆé‡å¤çš„è¡¨å…³è”å…³ç³»      task.getTableRelation.getOrElse(Seq.empty)        .map(e &#x3D;&gt; &#123;          if (e.leftTableSelect &gt; e.rightTableSelect) &#123;            TableRelation(              leftTableSelect &#x3D; e.rightTableSelect,              rightTableSelect &#x3D; e.leftTableSelect,              leftColumnSelect &#x3D; e.rightColumnSelect,              rightColumnSelect &#x3D; e.leftColumnSelect            )          &#125; else e        &#125;)        .groupBy(e &#x3D;&gt; s&quot;$&#123;e.leftTableSelect&#125;-$&#123;e.rightTableSelect&#125;&quot;)        .map(e &#x3D;&gt; &#123;          LinkRelation(            leftTable &#x3D; e._2.head.leftTableSelect,            rightTable &#x3D; e._2.head.rightTableSelect,            linkFields &#x3D; e._2.map(e &#x3D;&gt; (e.leftColumnSelect, e.rightColumnSelect))          )        &#125;) foreach &#123;        remainLinks +&#x3D; _      &#125;&#x2F;&#x2F; æ ¹ç»“ç‚¹      val rootTreeNode &#x3D; TableRelationTreeNode(        eventTableId,        null,        new ListBuffer[TableRelationTreeNode]      )      &#x2F;&#x2F; æ„å»ºå…³ç³»æ ‘      buildRelationTree(rootTreeNode, remainLinks)      &#x2F;&#x2F; å¦‚æœæœ‰å‰©ä½™çš„å…³ç³»æœªè¢«ä½¿ç”¨ï¼Œåˆ™è¯´æ˜æœ‰æ— æ³•è¿æ¥åˆ°æ ¹èŠ‚ç‚¹çš„å…³ç³»ï¼ŒæŠ›å‡ºå¼‚å¸¸      if (remainLinks.nonEmpty) &#123;        throw new IllegalArgumentException(s&quot;æ¸¸ç¦»çš„å…³è”å…³ç³»ï¼š$&#123;          remainLinks.map(e &#x3D;&gt; &#123;            val leftNs &#x3D; namespacesRef(e.leftTable)            val rightNs &#x3D; namespacesRef(e.rightTable)            s&quot;$&#123;leftNs.nsDatabase&#125;.$&#123;leftNs.nsTable&#125; &lt;-&gt; $&#123;rightNs.nsDatabase&#125;.$&#123;rightNs.nsTable&#125;&quot;          &#125;).toString        &#125;\næ— æ³•ä¸æ ¹èŠ‚ç‚¹($&#123;eventNamespace.nsDatabase&#125;.$&#123;eventNamespace.nsTable&#125;)å»ºç«‹å…³ç³»&quot;)      &#125;      val queue &#x3D; new mutable.Queue[TableRelationTreeNode]      queue.enqueue(rootTreeNode)      &#x2F;&#x2F; å¹¿åº¦ä¼˜å…ˆéå†ï¼Œé€å±‚æ„å»ºSQLè¯­å¥ï¼Œä¿è¯ä¾èµ–é¡ºåº      while (queue.nonEmpty) &#123;        val len &#x3D; queue.size        for (i &lt;- 0 until len) &#123;          val node &#x3D; queue.dequeue          if (node.value !&#x3D; eventTableId) &#123;            val relation &#x3D; node.parentRelation            &#x2F;&#x2F; å½“å‰èŠ‚ç‚¹è¡¨            val curNs &#x3D; namespacesRef(node.value)            &#x2F;&#x2F; çˆ¶èŠ‚ç‚¹è¡¨            val parNs &#x3D; namespacesRef(relation.leftTable)            val curTableName &#x3D; s&quot;$&#123;curNs.nsDatabase&#125;.$&#123;curNs.nsTable&#125;&quot;            val fields &#x3D; sourceDataDal.getSourceDataTableField(node.value)            val fieldAliasPrefix &#x3D; s&quot;$&#123;curNs.nsDatabase&#125;__$&#123;curNs.nsTable&#125;__&quot;            &#x2F;&#x2F; æ„å»ºlookup SQL            transSqlList +&#x3D; s&quot;pushdown_sql left join with $&#123;curNs.nsSys&#125;.$&#123;curNs.nsInstance&#125;.$&#123;curNs.nsDatabase&#125;&#x3D;select $&#123;              fields.map(f &#x3D;&gt; s&quot;$f as $fieldAliasPrefix$f&quot;).mkString(&quot;, &quot;)            &#125; from $curTableName where ($&#123;              relation.linkFields.map(_._2.replaceAll(&quot;.*\\.&quot;, &quot;&quot;)).mkString(&quot;,&quot;)            &#125;) in ($&#123;relation.linkFields.map(_._1.replace(&quot;.&quot;,&quot;__&quot;)).map(e &#x3D;&gt; &quot;$&#123;&quot; + e + &quot;&#125;&quot;).mkString(&quot;,&quot;)&#125;)&quot;;          &#125;          node.childs foreach &#123; queue.enqueue(_) &#125;        &#125;      &#125;    &#125;    &#x2F;&#x2F; è¾“å‡ºæœ€ç»ˆç»“æœé›†çš„SparkSQL    transSqlList +&#x3D; s&quot;spark_sql&#x3D; select $&#123;      task.targetCalculate.get.map &#123; e &#x3D;&gt;        s&quot;$&#123;e.config.replaceAll(&quot;(\\w+)\\.(\\w+)\\.(\\w+)&quot;, &quot;$1__$2__$3&quot;)&#125; as $&#123;e.columnName&#125;&quot;      &#125;.mkString(&quot;, &quot;)    &#125; from $&#123;eventNamespace.nsTable&#125; where $&#123;if (task.filterCondition.getOrElse(&quot;&quot;) &#x3D;&#x3D; &quot;&quot;) &quot;1&#x3D;1&quot; else task.filterCondition.get&#125;&quot;    transSqlList.toSeq  &#125;</code></pre><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>æˆ‘æ–°å»ºäº†å‡ å¼ æµ‹è¯•è¡¨ï¼Œå¹¶ä½¿ç”¨å°ç¨‹åºå‘åº“ä¸­éšæœºç”Ÿæˆäº†ä¸€äº›æ•°æ®ï¼Œç„¶ååˆæ–°å»ºäº†ä¸€ä¸ªç›®æ ‡è¡¨ï¼Œä»¥æ­¤æ¥æµ‹è¯•è¯¥åŠŸèƒ½ï¼Œè¿‡ç¨‹å¦‚ä¸‹</p><h3 id="å‰ç«¯é…ç½®"><a href="#å‰ç«¯é…ç½®" class="headerlink" title="å‰ç«¯é…ç½®"></a>å‰ç«¯é…ç½®</h3><p>å…³è”å…³ç³»</p><p><img src="https://oscimg.oschina.net/oscnet/up-ad374c7f0532171add44d6e2141ace62855.png"></p><p>è®¡ç®—é€»è¾‘</p><p><img src="https://oscimg.oschina.net/oscnet/up-2767f6831520f8f011fed2511a43ca13c44.png"></p><p>æŠ½è±¡å‡ºçš„å…³è”å…³ç³»åº”ä¸ºï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">                                         ------&gt; customer_transaction                                         |customer &lt;---&gt; customer_account_info &lt;----                                         |                                         ------&gt; customer_seller_relation  &lt;-----&gt; seller_info</code></pre><h3 id="åå°ç”Ÿæˆçš„SQLï¼š"><a href="#åå°ç”Ÿæˆçš„SQLï¼š" class="headerlink" title="åå°ç”Ÿæˆçš„SQLï¼š"></a>åå°ç”Ÿæˆçš„SQLï¼š</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">spark_sql &#x3D;select  address AS adp_mock_spr_mirror__customer__address,  company AS adp_mock_spr_mirror__customer__company,  gender AS adp_mock_spr_mirror__customer__gender,  id AS adp_mock_spr_mirror__customer__id,  id_card AS adp_mock_spr_mirror__customer__id_card,  mobile AS adp_mock_spr_mirror__customer__mobile,  real_name AS adp_mock_spr_mirror__customer__real_name,  ums_id_ AS adp_mock_spr_mirror__customer__ums_id_,  ums_op_ AS adp_mock_spr_mirror__customer__ums_op_,  ums_ts_ AS adp_mock_spr_mirror__customer__ums_ts_from  customer;pushdown_sql  left join with tidb.spr_ods_department.adp_mock_spr_mirror &#x3D;select  account_bank as adp_mock_spr_mirror__customer_account_info__account_bank,  account_level as adp_mock_spr_mirror__customer_account_info__account_level,  account_no as adp_mock_spr_mirror__customer_account_info__account_no,  customer_id as adp_mock_spr_mirror__customer_account_info__customer_id,  entry_time as adp_mock_spr_mirror__customer_account_info__entry_time,  id as adp_mock_spr_mirror__customer_account_info__id,  loc_seller as adp_mock_spr_mirror__customer_account_info__loc_seller,  risk_level as adp_mock_spr_mirror__customer_account_info__risk_level,  risk_test_date as adp_mock_spr_mirror__customer_account_info__risk_test_date,  ums_active_ as adp_mock_spr_mirror__customer_account_info__ums_active_,  ums_id_ as adp_mock_spr_mirror__customer_account_info__ums_id_,  ums_op_ as adp_mock_spr_mirror__customer_account_info__ums_op_,  ums_ts_ as adp_mock_spr_mirror__customer_account_info__ums_ts_from  adp_mock_spr_mirror.customer_account_infowhere  (id) in ($ &#123; adp_mock_spr_mirror__customer__id &#125;);pushdown_sql  left join with tidb.spr_ods_department.adp_mock_spr_mirror &#x3D;select  customer_id as adp_mock_spr_mirror__customer_seller_relation__customer_id,  id as adp_mock_spr_mirror__customer_seller_relation__id,  relation_type as adp_mock_spr_mirror__customer_seller_relation__relation_type,  seller_id as adp_mock_spr_mirror__customer_seller_relation__seller_id,  ums_active_ as adp_mock_spr_mirror__customer_seller_relation__ums_active_,  ums_id_ as adp_mock_spr_mirror__customer_seller_relation__ums_id_,  ums_op_ as adp_mock_spr_mirror__customer_seller_relation__ums_op_,  ums_ts_ as adp_mock_spr_mirror__customer_seller_relation__ums_ts_,  wechat_relation as adp_mock_spr_mirror__customer_seller_relation__wechat_relationfrom  adp_mock_spr_mirror.customer_seller_relationwhere  (customer_id) in (    $ &#123; adp_mock_spr_mirror__customer_account_info__id &#125;  );  pushdown_sql  left join with tidb.spr_ods_department.adp_mock_spr_mirror &#x3D;select  balance as adp_mock_spr_mirror__customer_transaction__balance,  borrow_loan as adp_mock_spr_mirror__customer_transaction__borrow_loan,  comment as adp_mock_spr_mirror__customer_transaction__comment,  customer_account_id as adp_mock_spr_mirror__customer_transaction__customer_account_id,  customer_id as adp_mock_spr_mirror__customer_transaction__customer_id,  deal_abstract_code as adp_mock_spr_mirror__customer_transaction__deal_abstract_code,  deal_account_type_code as adp_mock_spr_mirror__customer_transaction__deal_account_type_code,  deal_code as adp_mock_spr_mirror__customer_transaction__deal_code,  deal_partner_account as adp_mock_spr_mirror__customer_transaction__deal_partner_account,  deal_partner_name as adp_mock_spr_mirror__customer_transaction__deal_partner_name,  deal_partner_ogr_name as adp_mock_spr_mirror__customer_transaction__deal_partner_ogr_name,  deal_partner_org_num as adp_mock_spr_mirror__customer_transaction__deal_partner_org_num,  id as adp_mock_spr_mirror__customer_transaction__id,  subject as adp_mock_spr_mirror__customer_transaction__subject,  transaction_amount as adp_mock_spr_mirror__customer_transaction__transaction_amount,  transaction_time as adp_mock_spr_mirror__customer_transaction__transaction_time,  ums_active_ as adp_mock_spr_mirror__customer_transaction__ums_active_,  ums_id_ as adp_mock_spr_mirror__customer_transaction__ums_id_,  ums_op_ as adp_mock_spr_mirror__customer_transaction__ums_op_,  ums_ts_ as adp_mock_spr_mirror__customer_transaction__ums_ts_from  adp_mock_spr_mirror.customer_transactionwhere  (customer_id, customer_account_id) in (    $ &#123; adp_mock_spr_mirror__customer_account_info__id &#125;,    $ &#123; adp_mock_spr_mirror__customer_account_info__account_no &#125;  );pushdown_sql  left join with tidb.spr_ods_department.adp_mock_spr_mirror &#x3D;select  current_bank as adp_mock_spr_mirror__seller_info__current_bank,  department_id as adp_mock_spr_mirror__seller_info__department_id,  email as adp_mock_spr_mirror__seller_info__email,  entry_time as adp_mock_spr_mirror__seller_info__entry_time,  id as adp_mock_spr_mirror__seller_info__id,  id_card as adp_mock_spr_mirror__seller_info__id_card,  leader_id as adp_mock_spr_mirror__seller_info__leader_id,  mobile as adp_mock_spr_mirror__seller_info__mobile,  name as adp_mock_spr_mirror__seller_info__name,  position as adp_mock_spr_mirror__seller_info__position,  tenant_id as adp_mock_spr_mirror__seller_info__tenant_id,  ums_active_ as adp_mock_spr_mirror__seller_info__ums_active_,  ums_id_ as adp_mock_spr_mirror__seller_info__ums_id_,  ums_op_ as adp_mock_spr_mirror__seller_info__ums_op_,  ums_ts_ as adp_mock_spr_mirror__seller_info__ums_ts_from  adp_mock_spr_mirror.seller_infowhere  (id) in (    $ &#123; adp_mock_spr_mirror__customer_seller_relation__seller_id &#125;  );spark_sql &#x3D;select  adp_mock_spr_mirror__customer_account_info__id as id,  adp_mock_spr_mirror__customer__real_name as name,  IF(adp_mock_spr_mirror__customer__gender &#x3D; 0, &quot;0&quot;, &quot;1&quot;) as sex,  adp_mock_spr_mirror__seller_info__department_id as age,  adp_mock_spr_mirror__customer__mobile as phone,  adp_mock_spr_mirror__seller_info__entry_time as born,  adp_mock_spr_mirror__customer__address as address,  IF(    adp_mock_spr_mirror__customer_transaction__borrow_loan &#x3D; 1,    &quot;1&quot;,    &quot;0&quot;  ) as married,  NOW() as create_time,  NOW() as update_time,  &#39;P&#39; as zodiacfrom  customerwhere  1 &#x3D; 1;</code></pre><h3 id="åŒæ­¥ç»“æœ"><a href="#åŒæ­¥ç»“æœ" class="headerlink" title="åŒæ­¥ç»“æœ"></a>åŒæ­¥ç»“æœ</h3><p><img src="https://oscimg.oschina.net/oscnet/up-0b722f692e6727e053b48e3a97e6eac2c9d.png"></p><p>ä»Sparkåå°æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®å·²ç»æ­£å¸¸æ’å…¥ç›®æ ‡è¡¨ã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ä»¥ä¸Šæ˜¯æ ‘å’ŒBFSåœ¨å®é™…å¼€å‘åœºæ™¯ä¸­çš„ä¸€ä¸ªåº”ç”¨ï¼Œä»£ç å®ç°å…¶å®è¾ƒä¸ºç®€å•ï¼Œé‡ç‚¹æ˜¯å®ç°çš„æ€è·¯ï¼Œå½“ç„¶è§£å†³é—®é¢˜çš„æ–¹æ³•å¹¶ä¸æ˜¯å”¯ä¸€çš„ï¼Œåœ¨æ­¤é—®é¢˜ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨æ„å»ºæ ‘çš„è¿‡ç¨‹ä¸­ç›´æ¥æ„å»ºSQLè¯­å¥ï¼Œçœå»åç»­çš„BFSè¿‡ç¨‹ï¼Œä½†æ˜¯æˆ‘è€ƒè™‘åˆ°åç»­å¯èƒ½å¢åŠ çš„éœ€æ±‚ï¼Œè¿˜æ˜¯å°†æ­¤å¤„æ‹†æˆäº†ä¸¤æ­¥ï¼Œæ–¹ä¾¿åç»­åœ¨æ‰©å±•ï¼Œæ ¹æ®å®é™…åœºæ™¯é€‰æ‹©æ–¹æ¡ˆå³å¯ã€‚å¦å¤–ï¼Œè®¡ç®—é€»è¾‘ä¸­ç¼ºå°‘å­—æ®µå¼ºæ ¡éªŒï¼Œå½“ç”¨æˆ·è¾“å…¥é”™è¯¯å­—æ®µæ—¶åœ¨è¿è¡ŒæœŸé—´æ‰èƒ½å¯Ÿè§‰åˆ°ï¼Œè€ƒè™‘åæœŸå†å¢åŠ æ­¤åŠŸèƒ½ã€‚</p><p>æœ‰ä¸å¯¹çš„åœ°æ–¹æ¬¢è¿æŒ‡æ­£ï¼Œå¸Œæœ›æœ¬æ–‡å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®ç»“æ„ä¸ç®—æ³•</tag>
      
      <tag>Spark SQL</tag>
      
      <tag>BFS</tag>
      
      <tag>scala</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>canalåœ¨dockerä¸‹çš„æ­å»º(é…åˆcanal-admin)</title>
    <link href="/2021/03/07/canal%E5%9C%A8docker%E4%B8%8B%E7%9A%84%E6%90%AD%E5%BB%BA-%E9%85%8D%E5%90%88canal-admin/"/>
    <url>/2021/03/07/canal%E5%9C%A8docker%E4%B8%8B%E7%9A%84%E6%90%AD%E5%BB%BA-%E9%85%8D%E5%90%88canal-admin/</url>
    
    <content type="html"><![CDATA[<h2 id="MySQLé…ç½®"><a href="#MySQLé…ç½®" class="headerlink" title="MySQLé…ç½®"></a>MySQLé…ç½®</h2><ul><li><p>å¯¹äºè‡ªå»º MySQL , éœ€è¦å…ˆå¼€å¯ Binlog å†™å…¥åŠŸèƒ½ï¼Œé…ç½® binlog-format ä¸º ROW æ¨¡å¼ï¼Œmy.cnf ä¸­é…ç½®å¦‚ä¸‹</p>  <pre class="line-numbers language-none"><code class="language-none">[mysqld]log-bin&#x3D;mysql-bin # å¼€å¯ binlogbinlog-format&#x3D;ROW # é€‰æ‹© ROW æ¨¡å¼server_id&#x3D;1 # é…ç½® MySQL replaction éœ€è¦å®šä¹‰ï¼Œä¸è¦å’Œ canal çš„ slaveId é‡å¤</code></pre><ul><li>æ³¨æ„ï¼šé’ˆå¯¹é˜¿é‡Œäº‘ RDS for MySQL , é»˜è®¤æ‰“å¼€äº† binlog , å¹¶ä¸”è´¦å·é»˜è®¤å…·æœ‰ binlog dump æƒé™ , ä¸éœ€è¦ä»»ä½•æƒé™æˆ–è€… binlog è®¾ç½®,å¯ä»¥ç›´æ¥è·³è¿‡è¿™ä¸€æ­¥</li></ul></li><li><p>æˆæƒ canal é“¾æ¥ MySQL è´¦å·å…·æœ‰ä½œä¸º MySQL slave çš„æƒé™, å¦‚æœå·²æœ‰è´¦æˆ·å¯ç›´æ¥ grant</p>  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">CREATE USER canal IDENTIFIED BY &#39;canal&#39;;GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &#39;canal&#39;@&#39;%&#39;;-- GRANT ALL PRIVILEGES ON *.* TO &#39;canal&#39;@&#39;%&#39; ;FLUSH PRIVILEGES;</code></pre><p>  PSï¼šæˆ‘æœ¬åœ°ä½¿ç”¨çš„MySQL 8.0ï¼Œå®æµ‹ä¸ç”¨ä¿®æ”¹æ­¤é…ç½®ä¹Ÿå¯æ­£å¸¸ä½¿ç”¨</p></li></ul><h2 id="canalå®¹å™¨çš„åˆ›å»ºä¸å¯åŠ¨"><a href="#canalå®¹å™¨çš„åˆ›å»ºä¸å¯åŠ¨" class="headerlink" title="canalå®¹å™¨çš„åˆ›å»ºä¸å¯åŠ¨"></a>canalå®¹å™¨çš„åˆ›å»ºä¸å¯åŠ¨</h2><ol><li><p>æ‹‰å–æ‰€éœ€è¦çš„é•œåƒ</p> <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># canal-adminğŸ“ âœ  ~ docker pull canal&#x2F;canal-admin# canal-serverğŸ“ âœ  ~ docker pull canal&#x2F;canal-server</code></pre></li><li><p>ä¸‹è½½canal-adminçš„è¿è¡Œè„šæœ¬</p> <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">wget https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;alibaba&#x2F;canal&#x2F;master&#x2F;docker&#x2F;run_admin.sh</code></pre></li><li><p>å¯åŠ¨å¹¶è¿è¡Œcanal-admin</p> <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># ä»¥8089ç«¯å£å¯åŠ¨canal-adminsh run_admin.sh -e server.port&#x3D;8089 \         -e canal.adminUser&#x3D;admin \         -e canal.adminPasswd&#x3D;admin# æŒ‡å®šå¤–éƒ¨çš„mysqlä½œä¸ºadminçš„åº“sh run_admin.sh \    -e server.port&#x3D;8089 \    -e spring.datasource.address&#x3D;host.docker.internal \    -e spring.datasource.database&#x3D;xxx \    -e spring.datasource.username&#x3D;root \    -e spring.datasource.password&#x3D;xxx</code></pre></li><li><p>æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®<a href="http://localhost:8089/">http://localhost:8089</a>ï¼Œé»˜è®¤è´¦å·å¯†ç ä¸ºadmin/123456ï¼Œé¦–é¡µå¦‚å›¾æ‰€ç¤º</p><p> <img src="https://oscimg.oschina.net/oscnet/up-9fe870724e9ad4581f18e9a4be241c1fcaf.png"></p></li><li><p>ä¸‹è½½canal-serverçš„è¿è¡Œè„šæœ¬</p> <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">wget https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;alibaba&#x2F;canal&#x2F;master&#x2F;docker&#x2F;run.sh</code></pre></li><li><p>adminç®¡ç†æ¨¡å¼å¯åŠ¨å¹¶è¿è¡Œcanal-serverï¼Œæœ¬æ¡ˆä¾‹ä»¥å•æœºæ¨¡å¼ä¸ºä¾‹ï¼Œé›†ç¾¤æ¨¡å¼éœ€æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªé›†ç¾¤ï¼Œå¹¶ä¸”æä¾›zookeeperåœ°å€ï¼Œç„¶åå¯åŠ¨å‚æ•°åŠ ä¸Šé›†ç¾¤åç§°å³å¯ï¼Œé…ç½®ä¸å•æœºæ¨¡å¼ä¸€æ ·ï¼Œåªä¸è¿‡ä¸€ä¸ªé›†ç¾¤å…±ç”¨ä¸€ä¸ªserveré…ç½®</p> <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># ä»¥å•æœºæ¨¡å¼å¯åŠ¨run.sh -e canal.admin.manager&#x3D;127.0.0.1:8089 \         -e canal.admin.port&#x3D;11110 \         -e canal.admin.user&#x3D;admin \         -e canal.admin.passwd&#x3D;4ACFE3202A5FF5CF467898FC58AAB1D615029441# é›†ç¾¤æ¨¡å¼å¯åŠ¨ï¼Œè‡ªåŠ¨åŠ å…¥testé›†ç¾¤# å¦‚æœä½¿ç”¨é›†ç¾¤æ¨¡å¼ï¼Œéœ€è¦åœ¨canal-adminç®¡ç†é¡µé¢åˆ›å»ºé›†ç¾¤ï¼ŒåŒä¸€ä¸ªé›†ç¾¤ä½¿ç”¨ç›¸åŒçš„é…ç½®æ–‡ä»¶run.sh -e canal.admin.manager&#x3D;127.0.0.1:8089 \         -e canal.admin.port&#x3D;11110 \         -e canal.admin.user&#x3D;admin \         -e canal.admin.passwd&#x3D;4ACFE3202A5FF5CF467898FC58AAB1D615029441          -e canal.admin.register.cluster&#x3D;test</code></pre><p> PSï¼šåœ¨dockerå®¹å™¨ä¸­ï¼Œè‹¥éä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œ127.0.0.1å¹¶éä¸ºä¸»æœºçš„åœ°å€ï¼ŒMacç‰ˆå¯ä½¿ç”¨<strong>host.docker.internal</strong>è®¿é—®åˆ°ä¸»æœºï¼ŒLinuxæš‚ä¸æ”¯æŒï¼Œéœ€è¦æ‰‹åŠ¨åœ¨å®¹å™¨ä¸­æŸ¥è¯¢åˆ°ä¸»æœºçš„ipï¼Œæ›¿æ¢æ‰ä¸Šé¢çš„127.0.0.1</p></li><li><p>å¯åŠ¨æˆåŠŸåï¼Œåˆ·æ–°adminé¡µé¢çš„serveråˆ—è¡¨ï¼Œä¼šå‡ºç°åˆšåˆšå¯åŠ¨çš„canal-serverï¼š</p><p> <img src="https://oscimg.oschina.net/oscnet/up-4aadd69d740610d80bfaf9c01b2047db717.png"></p><p> è‡³æ­¤ï¼Œcanalçš„åˆ›å»ºä¸å¯åŠ¨å·²ç»å®Œæˆï¼Œåœ¨ç®¡ç†é¡µé¢è¿›è¡Œé…ç½®æ“ä½œå³å¯</p></li></ol><h2 id="canalæ ¸å¿ƒé…ç½®ä»‹ç»"><a href="#canalæ ¸å¿ƒé…ç½®ä»‹ç»" class="headerlink" title="canalæ ¸å¿ƒé…ç½®ä»‹ç»"></a>canalæ ¸å¿ƒé…ç½®ä»‹ç»</h2><p>canalçš„é…ç½®åˆ†ä¸ºserveré…ç½®å’Œinstanceé…ç½®ï¼Œä¸€ä¸ªserverå¯åŒ…å«å¤šä¸ªinstanceï¼Œéƒ¨åˆ†é…ç½®</p><h3 id="serveré…ç½®"><a href="#serveré…ç½®" class="headerlink" title="serveré…ç½®"></a>serveré…ç½®</h3><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"># æœåŠ¡æ¨¡å¼ï¼Œæ”¯æŒtcp, kafka, rocketMQ, rabbitMQcanal.serverMode &#x3D; kafka### kafkaé…ç½®# è¯¥å€¼ä¸ºfalseæ—¶ï¼Œå‘é€çš„æ¶ˆæ¯ä¸ºäºŒè¿›åˆ¶å‹ç¼©æ ¼å¼ï¼Œéœ€è¦å®¢æˆ·ç«¯ä½¿ç”¨protobufå·¥å…·è§£æï¼Œä¸ºtrueæ—¶ï¼Œå‘é€jsonæ–‡æœ¬canal.mq.flatMessage &#x3D; true# kafkaæœåŠ¡å™¨åœ°å€kafka.bootstrap.servers &#x3D; host.docker.internal:9092</code></pre><h3 id="instanceé…ç½®"><a href="#instanceé…ç½®" class="headerlink" title="instanceé…ç½®"></a>instanceé…ç½®</h3><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"># ç›‘å¬çš„æ•°æ®åº“åœ°å€canal.instance.master.address&#x3D;host.docker.internal:3306# æ•°æ®åº“çš„ç”¨æˆ·åcanal.instance.dbUsername&#x3D;root# æ•°æ®åº“å¯†ç canal.instance.dbPassword&#x3D;123456# è¡¨åè¿‡æ»¤ï¼Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œ($&#123;åº“å&#125;.$&#123;è¡¨å&#125;)canal.instance.filter.regex&#x3D;.+\\..+# kafka topicåç§°ï¼Œæ‰€æœ‰çš„æ¶ˆæ¯éƒ½å°†æ”¾å…¥æ­¤topic# canal.mq.topic&#x3D;example# æ ¹æ®åº“åå¯è¡¨ååŠ¨æ€topiccanal.mq.dynamicTopic&#x3D;.+\\..+# å‘é€åˆ†åŒºcanal.mq.partition&#x3D;0# åˆ†åŒºæ•°é‡#canal.mq.partitionsNum&#x3D;3# æ ¹æ®åº“åå’Œè¡¨åè®¡ç®—å‡ºå‘é€åˆ†åŒº(Hash)ï¼Œå¯æ§åˆ¶åŒä¸€ä¸ªåº“&#x2F;è¡¨æœ‰åº#canal.mq.partitionHash&#x3D;test.table:id^name,.*\\..*### åŠ¨æ€topicå’Œpartitionçš„è¯¦ç»†è¯´æ˜# canal.mq.dynamicTopic è¡¨è¾¾å¼è¯´æ˜# canal 1.1.3ç‰ˆæœ¬ä¹‹å, æ”¯æŒé…ç½®æ ¼å¼ï¼šschema æˆ– schema.tableï¼Œå¤šä¸ªé…ç½®ä¹‹é—´ä½¿ç”¨é€—å·æˆ–åˆ†å·åˆ†éš”# ä¾‹å­1ï¼štest\\.test æŒ‡å®šåŒ¹é…çš„å•è¡¨ï¼Œå‘é€åˆ°ä»¥test_testä¸ºåå­—çš„topicä¸Š# ä¾‹å­2ï¼š.*\\..* åŒ¹é…æ‰€æœ‰è¡¨ï¼Œåˆ™æ¯ä¸ªè¡¨éƒ½ä¼šå‘é€åˆ°å„è‡ªè¡¨åçš„topicä¸Š# ä¾‹å­3ï¼štest æŒ‡å®šåŒ¹é…å¯¹åº”çš„åº“ï¼Œä¸€ä¸ªåº“çš„æ‰€æœ‰è¡¨éƒ½ä¼šå‘é€åˆ°åº“åçš„topicä¸Š# ä¾‹å­4ï¼štest\\..* æŒ‡å®šåŒ¹é…çš„è¡¨è¾¾å¼ï¼Œé’ˆå¯¹åŒ¹é…çš„è¡¨ä¼šå‘é€åˆ°å„è‡ªè¡¨åçš„topicä¸Š# ä¾‹å­5ï¼štest,test1\\.test1ï¼ŒæŒ‡å®šå¤šä¸ªè¡¨è¾¾å¼ï¼Œä¼šå°†teståº“çš„è¡¨éƒ½å‘é€åˆ°testçš„topicä¸Šï¼Œtest1\\.test1çš„è¡¨å‘é€åˆ°å¯¹åº”çš„test1_test1 topicä¸Šï¼Œå…¶ä½™çš„è¡¨å‘é€åˆ°é»˜è®¤çš„canal.mq.topicå€¼# ä¸ºæ»¡è¶³æ›´å¤§çš„çµæ´»æ€§ï¼Œå…è®¸å¯¹åŒ¹é…æ¡ä»¶çš„è§„åˆ™æŒ‡å®šå‘é€çš„topicåå­—ï¼Œé…ç½®æ ¼å¼ï¼štopicName:schema æˆ– topicName:schema.table# ä¾‹å­1: test:test\\.test æŒ‡å®šåŒ¹é…çš„å•è¡¨ï¼Œå‘é€åˆ°ä»¥testä¸ºåå­—çš„topicä¸Š# ä¾‹å­2: test:.*\\..* åŒ¹é…æ‰€æœ‰è¡¨ï¼Œå› ä¸ºæœ‰æŒ‡å®štopicï¼Œåˆ™æ¯ä¸ªè¡¨éƒ½ä¼šå‘é€åˆ°testçš„topicä¸‹# ä¾‹å­3: test:test æŒ‡å®šåŒ¹é…å¯¹åº”çš„åº“ï¼Œä¸€ä¸ªåº“çš„æ‰€æœ‰è¡¨éƒ½ä¼šå‘é€åˆ°testçš„topicä¸‹# ä¾‹å­4ï¼štestA:test\\..* æŒ‡å®šåŒ¹é…çš„è¡¨è¾¾å¼ï¼Œé’ˆå¯¹åŒ¹é…çš„è¡¨ä¼šå‘é€åˆ°testAçš„topicä¸‹# ä¾‹å­5ï¼štest0:test,test1:test1\\.test1ï¼ŒæŒ‡å®šå¤šä¸ªè¡¨è¾¾å¼ï¼Œä¼šå°†teståº“çš„è¡¨éƒ½å‘é€åˆ°test0çš„topicä¸‹ï¼Œtest1\\.test1çš„è¡¨å‘é€åˆ°å¯¹åº”çš„test1çš„topicä¸‹ï¼Œå…¶ä½™çš„è¡¨å‘é€åˆ°é»˜è®¤çš„canal.mq.topicå€¼# å¤§å®¶å¯ä»¥ç»“åˆè‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚ï¼Œè®¾ç½®åŒ¹é…è§„åˆ™ï¼Œå»ºè®®MQå¼€å¯è‡ªåŠ¨åˆ›å»ºtopicçš„èƒ½åŠ›# canal.mq.partitionHash è¡¨è¾¾å¼è¯´æ˜# canal 1.1.3ç‰ˆæœ¬ä¹‹å, æ”¯æŒé…ç½®æ ¼å¼ï¼šschema.table:pk1^pk2ï¼Œå¤šä¸ªé…ç½®ä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”# ä¾‹å­1ï¼štest\\.test:pk1^pk2 æŒ‡å®šåŒ¹é…çš„å•è¡¨ï¼Œå¯¹åº”çš„hashå­—æ®µä¸ºpk1 + pk2# ä¾‹å­2ï¼š.*\\..*:id æ­£åˆ™åŒ¹é…ï¼ŒæŒ‡å®šæ‰€æœ‰æ­£åˆ™åŒ¹é…çš„è¡¨å¯¹åº”çš„hashå­—æ®µä¸ºid# ä¾‹å­3ï¼š.*\\..*:$pk$ æ­£åˆ™åŒ¹é…ï¼ŒæŒ‡å®šæ‰€æœ‰æ­£åˆ™åŒ¹é…çš„è¡¨å¯¹åº”çš„hashå­—æ®µä¸ºè¡¨ä¸»é”®(è‡ªåŠ¨æŸ¥æ‰¾)# ä¾‹å­4: åŒ¹é…è§„åˆ™å•¥éƒ½ä¸å†™ï¼Œåˆ™é»˜è®¤å‘åˆ°0è¿™ä¸ªpartitionä¸Š# ä¾‹å­5ï¼š.*\\..* ï¼Œä¸æŒ‡å®špkä¿¡æ¯çš„æ­£åˆ™åŒ¹é…ï¼Œå°†æ‰€æœ‰æ­£åˆ™åŒ¹é…çš„è¡¨,å¯¹åº”çš„hashå­—æ®µä¸ºè¡¨å# æŒ‰è¡¨hash: ä¸€å¼ è¡¨çš„æ‰€æœ‰æ•°æ®å¯ä»¥å‘åˆ°åŒä¸€ä¸ªåˆ†åŒºï¼Œä¸åŒè¡¨ä¹‹é—´ä¼šåšæ•£åˆ— (ä¼šæœ‰çƒ­ç‚¹è¡¨åˆ†åŒºè¿‡å¤§é—®é¢˜)# ä¾‹å­6: test\\.test:id,.\\..* , é’ˆå¯¹testçš„è¡¨æŒ‰ç…§idæ•£åˆ—,å…¶ä½™çš„è¡¨æŒ‰ç…§tableæ•£åˆ—# æ³¨æ„ï¼šå¤§å®¶å¯ä»¥ç»“åˆè‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚ï¼Œè®¾ç½®åŒ¹é…è§„åˆ™ï¼Œå¤šæ¡åŒ¹é…è§„åˆ™ä¹‹é—´æ˜¯æŒ‰ç…§é¡ºåºè¿›è¡ŒåŒ¹é…(å‘½ä¸­ä¸€æ¡è§„åˆ™å°±è¿”å›)</code></pre><h3 id="å…¶ä½™é…ç½®å¯å‚è€ƒå®˜ç½‘wikiæ–‡æ¡£ï¼šalibaba-canal"><a href="#å…¶ä½™é…ç½®å¯å‚è€ƒå®˜ç½‘wikiæ–‡æ¡£ï¼šalibaba-canal" class="headerlink" title="å…¶ä½™é…ç½®å¯å‚è€ƒå®˜ç½‘wikiæ–‡æ¡£ï¼šalibaba/canal"></a>å…¶ä½™é…ç½®å¯å‚è€ƒå®˜ç½‘wikiæ–‡æ¡£ï¼š<a href="https://github.com/alibaba/canal/wiki/QuickStart">alibaba/canal</a></h3><h2 id="æµ‹è¯•ç›‘å¬"><a href="#æµ‹è¯•ç›‘å¬" class="headerlink" title="æµ‹è¯•ç›‘å¬"></a>æµ‹è¯•ç›‘å¬</h2><p>ä½¿ç”¨kafkaå®¢æˆ·ç«¯æµ‹è¯•ï¼Œç”±äºæˆ‘ä½¿ç”¨çš„åŠ¨æ€topicï¼Œæ‰€ä»¥topicåç§°ä¸ºï¼š{åº“å}_{è¡¨å}</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ğŸ“ âœ  kafka_2.12-2.2.2 .&#x2F;bin&#x2F;kafka-console-consumer.sh --bootstrap-server 127.0.0.1:9092 --topic test_article</code></pre><p>æ‰‹åŠ¨ä¿®æ”¹ä¸€æ¡è¯¥è¡¨çš„æ•°æ®ï¼Œå³å¯æ”¶åˆ°canalå‘é€çš„æ•°æ®åº“å˜æ›´æ¶ˆæ¯ï¼š</p><p><img src="https://oscimg.oschina.net/oscnet/up-efdcbe72ea74b2357c99b31786999aaf840.png"></p><h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><p>æ€»ä½“çš„æ­å»ºè¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œadminæ¨¡å—ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¯è§†åŒ–çš„ç®¡ç†ç•Œé¢ï¼Œç®€å•æ˜“ç”¨ï¼Œå•ç‹¬ä½¿ç”¨canal-serveræ¨¡å—ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯ä¿®æ”¹é…ç½®èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚</p><p>æ­¤å¤–ï¼Œåœ¨æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯é‡åˆ°äº†ä¸€äº›é—®é¢˜çš„ï¼Œä»¥ä¸‹ä»‹ç»å‡ ä¸ªè¸©å‘ç‚¹ï¼š</p><ul><li>canalç›‘å¬æ—¶ï¼Œæœ‰äº›åº“åå’Œè¡¨åæ˜¯ç©ºçš„ï¼Œå¯¼è‡´åœ¨åŠ¨æ€topicæƒ…å†µä¸‹ï¼Œkafkaæç¤ºæ— æ•ˆçš„topicåç§°ï¼Œæˆ‘ä»¬åœ¨é…ç½®ä¸­å°†ç©ºåº“åå’Œè¡¨åçš„æ¶ˆæ¯è¿‡æ»¤æ‰å°±å¥½ï¼Œå°†é»˜è®¤çš„<code>.*\\..*</code>æ”¹ä¸º<code>.+\\..+</code></li><li>æˆ‘çš„kafkaæ˜¯åœ¨æœ¬åœ°ä¸»æœºçš„ï¼Œéœ€è¦å¢åŠ kafkaé…ç½®<code>advertised.listeners=PLAINTEXT://host.docker.internal:9092</code> ï¼Œå®¹å™¨ä¸­çš„åº”ç”¨æ‰èƒ½æ­£å¸¸è®¿é—®kafkaæœåŠ¡ç«¯</li><li>åˆšå¼€å§‹åœ¨å¯åŠ¨canal-serveræ—¶ï¼Œæ€»æ˜¯è¿æ¥adminæœåŠ¡å¤±è´¥ï¼Œé¡µé¢ä¸Šæ‰€æœ‰æ¥å£ä¹Ÿæ— å“åº”ï¼Œä½†æ˜¯dockeræ˜¾ç¤ºadminå®¹å™¨è¿˜åœ¨è¿è¡Œï¼Œè¿›å…¥canal-adminå®¹å™¨åæŸ¥çœ‹æ—¥å¿—æ— æŠ¥é”™ï¼Œä½†æ˜¯åå°çš„javaè¿›ç¨‹å·²ç»æ²¡æœ‰äº†ï¼Œå›°æ‰°äº†æŒºä¹…ï¼Œåæ¥å‘ç°æˆ‘çš„dockerå†…å­˜é…ç½®åªæœ‰2Gï¼Œæ¨æµ‹æ˜¯å†…å­˜ä¸è¶³åœæ‰äº†ï¼Œäºæ˜¯å°†dockerå†…å­˜é…ç½®æ”¹ä¸º8Gï¼Œé—®é¢˜è§£å†³</li></ul><p><strong>æœ¬æ–¹æ¡ˆä»…é™äºæœ¬åœ°å­¦ä¹ ä¸æµ‹è¯•ï¼Œç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨HAæ¨¡å¼éƒ¨ç½²ï¼Œè¯¦è§ï¼š<a href="https://github.com/alibaba/canal/wiki/AdminGuide#ha%E6%A8%A1%E5%BC%8F%E9%85%8D%E7%BD%AE">https://github.com/alibaba/canal/wiki/AdminGuide#haæ¨¡å¼é…ç½®</a></strong></p><h2 id="é™„å½•-GitHubç»å¸¸æ— æ³•ä¸‹è½½æ–‡ä»¶ï¼Œæä¾›ä¸€äº›ç”¨åˆ°çš„è„šæœ¬"><a href="#é™„å½•-GitHubç»å¸¸æ— æ³•ä¸‹è½½æ–‡ä»¶ï¼Œæä¾›ä¸€äº›ç”¨åˆ°çš„è„šæœ¬" class="headerlink" title="é™„å½•(GitHubç»å¸¸æ— æ³•ä¸‹è½½æ–‡ä»¶ï¼Œæä¾›ä¸€äº›ç”¨åˆ°çš„è„šæœ¬)"></a>é™„å½•(GitHubç»å¸¸æ— æ³•ä¸‹è½½æ–‡ä»¶ï¼Œæä¾›ä¸€äº›ç”¨åˆ°çš„è„šæœ¬)</h2><ul><li><p><strong>GitHubåœ°å€ï¼š</strong><a href="https://github.com/alibaba/canal">https://github.com/alibaba/canal</a></p></li><li><p><strong>run_admin.sh</strong></p>  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">#!&#x2F;bin&#x2F;bashfunction usage() &#123;    echo &quot;Usage:&quot;    echo &quot;  run_admin.sh [CONFIG]&quot;    echo &quot;example :&quot;    echo &quot;  run_admin.sh -e server.port&#x3D;8089 \\&quot;    echo &quot;         -e canal.adminUser&#x3D;admin \\&quot;    echo &quot;         -e canal.adminPasswd&#x3D;admin&quot;    exit&#125;function check_port() &#123;    local port&#x3D;$1    local TL&#x3D;$(which telnet)    if [ -f $TL ]; then        data&#x3D;&#96;echo quit | telnet 127.0.0.1 $port| grep -ic connected&#96;        echo $data        return    fi    local NC&#x3D;$(which nc)    if [ -f $NC ]; then        data&#x3D;&#96;nc -z -w 1 127.0.0.1 $port | grep -ic succeeded&#96;        echo $data        return    fi    echo &quot;0&quot;    return&#125;function getMyIp() &#123;    case &quot;&#96;uname&#96;&quot; in        Darwin)         myip&#x3D;&#96;echo &quot;show State:&#x2F;Network&#x2F;Global&#x2F;IPv4&quot; | scutil | grep PrimaryInterface | awk &#39;&#123;print $3&#125;&#39; | xargs ifconfig | grep inet | grep -v inet6 | awk &#39;&#123;print $2&#125;&#39;&#96;         ;;        *)         myip&#x3D;&#96;ip route get 1 | awk &#39;&#123;print $NF;exit&#125;&#39;&#96;         ;;  esac  echo $myip&#125;CONFIG&#x3D;$&#123;@:1&#125;#VOLUMNS&#x3D;&quot;-v $DATA:&#x2F;home&#x2F;admin&#x2F;canal-admin&#x2F;logs&quot;PORTLIST&#x3D;&quot;8089&quot;PORTS&#x3D;&quot;&quot;for PORT in $PORTLIST ; do    #exist&#x3D;&#96;check_port $PORT&#96;    exist&#x3D;&quot;0&quot;    if [ &quot;$exist&quot; &#x3D;&#x3D; &quot;0&quot; ]; then        PORTS&#x3D;&quot;$PORTS -p $PORT:$PORT&quot;    else        echo &quot;port $PORT is used , pls check&quot;        exit 1    fidoneNET_MODE&#x3D;&quot;&quot;case &quot;&#96;uname&#96;&quot; in    Darwin)        bin_abs_path&#x3D;&#96;cd $(dirname $0); pwd&#96;        ;;    Linux)        bin_abs_path&#x3D;$(readlink -f $(dirname $0))        NET_MODE&#x3D;&quot;--net&#x3D;host&quot;        PORTS&#x3D;&quot;&quot;        ;;    *)        NET_MODE&#x3D;&quot;--net&#x3D;host&quot;        PORTS&#x3D;&quot;&quot;        bin_abs_path&#x3D;&#96;cd $(dirname $0); pwd&#96;        ;;esacBASE&#x3D;$&#123;bin_abs_path&#125;DATA&#x3D;&quot;$BASE&#x2F;data&quot;mkdir -p $DATAif [ $# -eq 0 ]; then    usageelif [ &quot;$1&quot; &#x3D;&#x3D; &quot;-h&quot; ] ; then    usageelif [ &quot;$1&quot; &#x3D;&#x3D; &quot;help&quot; ] ; then    usagefiMEMORY&#x3D;&quot;-m 1024m&quot;LOCALHOST&#x3D;&#96;getMyIp&#96;cmd&#x3D;&quot;docker run -d -it -h $LOCALHOST $CONFIG --name&#x3D;canal-admin $VOLUMNS $NET_MODE $PORTS $MEMORY canal&#x2F;canal-admin&quot;echo $cmdeval $cmd</code></pre></li><li><p><strong>run.sh</strong></p>  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">#!&#x2F;bin&#x2F;bashfunction usage() &#123;    echo &quot;Usage:&quot;    echo &quot;  run.sh [CONFIG]&quot;    echo &quot;example 1 :&quot;    echo &quot;  run.sh -e canal.instance.master.address&#x3D;127.0.0.1:3306 \\&quot;    echo &quot;         -e canal.instance.dbUsername&#x3D;canal \\&quot;    echo &quot;         -e canal.instance.dbPassword&#x3D;canal \\&quot;    echo &quot;         -e canal.instance.connectionCharset&#x3D;UTF-8 \\&quot;    echo &quot;         -e canal.instance.tsdb.enable&#x3D;true \\&quot;    echo &quot;         -e canal.instance.gtidon&#x3D;false \\&quot;    echo &quot;         -e canal.instance.filter.regex&#x3D;.*\\\\\\..* &quot;    echo &quot;example 2 :&quot;    echo &quot;  run.sh -e canal.admin.manager&#x3D;127.0.0.1:8089 \\&quot;    echo &quot;         -e canal.admin.port&#x3D;11110 \\&quot;    echo &quot;         -e canal.admin.user&#x3D;admin \\&quot;    echo &quot;         -e canal.admin.passwd&#x3D;4ACFE3202A5FF5CF467898FC58AAB1D615029441&quot;    exit&#125;function check_port() &#123;    local port&#x3D;$1    local TL&#x3D;$(which telnet)    if [ -f $TL ]; then        data&#x3D;&#96;echo quit | telnet 127.0.0.1 $port| grep -ic connected&#96;        echo $data        return    fi    local NC&#x3D;$(which nc)    if [ -f $NC ]; then        data&#x3D;&#96;nc -z -w 1 127.0.0.1 $port | grep -ic succeeded&#96;        echo $data        return    fi    echo &quot;0&quot;    return&#125;function getMyIp() &#123;    case &quot;&#96;uname&#96;&quot; in        Darwin)         myip&#x3D;&#96;echo &quot;show State:&#x2F;Network&#x2F;Global&#x2F;IPv4&quot; | scutil | grep PrimaryInterface | awk &#39;&#123;print $3&#125;&#39; | xargs ifconfig | grep inet | grep -v inet6 | awk &#39;&#123;print $2&#125;&#39;&#96;         ;;        *)         myip&#x3D;&#96;ip route get 1 | awk &#39;&#123;print $NF;exit&#125;&#39;&#96;         ;;  esac  echo $myip&#125;CONFIG&#x3D;$&#123;@:1&#125;#VOLUMNS&#x3D;&quot;-v $DATA:&#x2F;home&#x2F;admin&#x2F;canal-server&#x2F;logs&quot;PORTLIST&#x3D;&quot;11110 11111 11112 9100&quot;PORTS&#x3D;&quot;&quot;for PORT in $PORTLIST ; do    #exist&#x3D;&#96;check_port $PORT&#96;    exist&#x3D;&quot;0&quot;    if [ &quot;$exist&quot; &#x3D;&#x3D; &quot;0&quot; ]; then        PORTS&#x3D;&quot;$PORTS -p $PORT:$PORT&quot;    else        echo &quot;port $PORT is used , pls check&quot;        exit 1    fidoneNET_MODE&#x3D;&quot;&quot;case &quot;&#96;uname&#96;&quot; in    Darwin)        bin_abs_path&#x3D;&#96;cd $(dirname $0); pwd&#96;        ;;    Linux)        bin_abs_path&#x3D;$(readlink -f $(dirname $0))        NET_MODE&#x3D;&quot;--net&#x3D;host&quot;        PORTS&#x3D;&quot;&quot;        ;;    *)        bin_abs_path&#x3D;&#96;cd $(dirname $0); pwd&#96;        NET_MODE&#x3D;&quot;--net&#x3D;host&quot;        PORTS&#x3D;&quot;&quot;        ;;esacBASE&#x3D;$&#123;bin_abs_path&#125;DATA&#x3D;&quot;$BASE&#x2F;data&quot;mkdir -p $DATAif [ $# -eq 0 ]; then    usageelif [ &quot;$1&quot; &#x3D;&#x3D; &quot;-h&quot; ] ; then    usageelif [ &quot;$1&quot; &#x3D;&#x3D; &quot;help&quot; ] ; then    usagefiMEMORY&#x3D;&quot;-m 4096m&quot;LOCALHOST&#x3D;&#96;getMyIp&#96;cmd&#x3D;&quot;docker run -d -it -h $LOCALHOST $CONFIG --name&#x3D;canal-server $VOLUMNS $NET_MODE $PORTS $MEMORY canal&#x2F;canal-server&quot;echo $cmdeval $cmd</code></pre></li><li><p><strong>serveré…ç½®æ–‡ä»¶æ¨¡æ¿(canal.properties)</strong></p>  <pre class="line-numbers language-properties" data-language="properties"><code class="language-properties">########################################################## common argument############################################################### tcp bind ipcanal.ip &#x3D;# register ip to zookeepercanal.register.ip &#x3D;canal.port &#x3D; 11111canal.metrics.pull.port &#x3D; 11112# canal instance user&#x2F;passwd# canal.user &#x3D; canal# canal.passwd &#x3D; E3619321C1A937C46A0D8BD1DAC39F93B27D4458# canal admin config#canal.admin.manager &#x3D; 127.0.0.1:8089canal.admin.port &#x3D; 11110canal.admin.user &#x3D; admincanal.admin.passwd &#x3D; 4ACFE3202A5FF5CF467898FC58AAB1D615029441canal.zkServers &#x3D;# flush data to zkcanal.zookeeper.flush.period &#x3D; 1000canal.withoutNetty &#x3D; false# tcp, kafka, rocketMQ, rabbitMQcanal.serverMode &#x3D; tcp# flush meta cursor&#x2F;parse position to filecanal.file.data.dir &#x3D; $&#123;canal.conf.dir&#125;canal.file.flush.period &#x3D; 1000## memory store RingBuffer size, should be Math.pow(2,n)canal.instance.memory.buffer.size &#x3D; 16384## memory store RingBuffer used memory unit size , default 1kbcanal.instance.memory.buffer.memunit &#x3D; 1024 ## meory store gets mode used MEMSIZE or ITEMSIZEcanal.instance.memory.batch.mode &#x3D; MEMSIZEcanal.instance.memory.rawEntry &#x3D; true## detecing configcanal.instance.detecting.enable &#x3D; false#canal.instance.detecting.sql &#x3D; insert into retl.xdual values(1,now()) on duplicate key update x&#x3D;now()canal.instance.detecting.sql &#x3D; select 1canal.instance.detecting.interval.time &#x3D; 3canal.instance.detecting.retry.threshold &#x3D; 3canal.instance.detecting.heartbeatHaEnable &#x3D; false# support maximum transaction size, more than the size of the transaction will be cut into multiple transactions deliverycanal.instance.transaction.size &#x3D;  1024# mysql fallback connected to new master should fallback timescanal.instance.fallbackIntervalInSeconds &#x3D; 60# network configcanal.instance.network.receiveBufferSize &#x3D; 16384canal.instance.network.sendBufferSize &#x3D; 16384canal.instance.network.soTimeout &#x3D; 30# binlog filter configcanal.instance.filter.druid.ddl &#x3D; truecanal.instance.filter.query.dcl &#x3D; falsecanal.instance.filter.query.dml &#x3D; falsecanal.instance.filter.query.ddl &#x3D; falsecanal.instance.filter.table.error &#x3D; falsecanal.instance.filter.rows &#x3D; falsecanal.instance.filter.transaction.entry &#x3D; false# binlog format&#x2F;image checkcanal.instance.binlog.format &#x3D; ROW,STATEMENT,MIXED canal.instance.binlog.image &#x3D; FULL,MINIMAL,NOBLOB# binlog ddl isolationcanal.instance.get.ddl.isolation &#x3D; false# parallel parser configcanal.instance.parser.parallel &#x3D; true## concurrent thread number, default 60% available processors, suggest not to exceed Runtime.getRuntime().availableProcessors()#canal.instance.parser.parallelThreadSize &#x3D; 16## disruptor ringbuffer size, must be power of 2canal.instance.parser.parallelBufferSize &#x3D; 256# table meta tsdb infocanal.instance.tsdb.enable &#x3D; truecanal.instance.tsdb.dir &#x3D; $&#123;canal.file.data.dir:..&#x2F;conf&#125;&#x2F;$&#123;canal.instance.destination:&#125;canal.instance.tsdb.url &#x3D; jdbc:h2:$&#123;canal.instance.tsdb.dir&#125;&#x2F;h2;CACHE_SIZE&#x3D;1000;MODE&#x3D;MYSQL;canal.instance.tsdb.dbUsername &#x3D; canalcanal.instance.tsdb.dbPassword &#x3D; canal# dump snapshot interval, default 24 hourcanal.instance.tsdb.snapshot.interval &#x3D; 24# purge snapshot expire , default 360 hour(15 days)canal.instance.tsdb.snapshot.expire &#x3D; 360########################################################## destinations##############################################################canal.destinations &#x3D; # conf root dircanal.conf.dir &#x3D; ..&#x2F;conf# auto scan instance dir add&#x2F;remove and start&#x2F;stop instancecanal.auto.scan &#x3D; truecanal.auto.scan.interval &#x3D; 5canal.instance.tsdb.spring.xml &#x3D; classpath:spring&#x2F;tsdb&#x2F;h2-tsdb.xml#canal.instance.tsdb.spring.xml &#x3D; classpath:spring&#x2F;tsdb&#x2F;mysql-tsdb.xmlcanal.instance.global.mode &#x3D; managercanal.instance.global.lazy &#x3D; falsecanal.instance.global.manager.address &#x3D; $&#123;canal.admin.manager&#125;#canal.instance.global.spring.xml &#x3D; classpath:spring&#x2F;memory-instance.xmlcanal.instance.global.spring.xml &#x3D; classpath:spring&#x2F;file-instance.xml#canal.instance.global.spring.xml &#x3D; classpath:spring&#x2F;default-instance.xml###########################################################       MQ Properties      ################################################################ aliyun ak&#x2F;sk , support rds&#x2F;mqcanal.aliyun.accessKey &#x3D;canal.aliyun.secretKey &#x3D;canal.aliyun.uid&#x3D;canal.mq.flatMessage &#x3D; truecanal.mq.canalBatchSize &#x3D; 50canal.mq.canalGetTimeout &#x3D; 100# Set this value to &quot;cloud&quot;, if you want open message trace feature in aliyun.canal.mq.accessChannel &#x3D; localcanal.mq.database.hash &#x3D; truecanal.mq.send.thread.size &#x3D; 30canal.mq.build.thread.size &#x3D; 8###########################################################      Kafka      ###############################################################kafka.bootstrap.servers &#x3D; 127.0.0.1:6667kafka.acks &#x3D; allkafka.compression.type &#x3D; nonekafka.batch.size &#x3D; 16384kafka.linger.ms &#x3D; 1kafka.max.request.size &#x3D; 1048576kafka.buffer.memory &#x3D; 33554432kafka.max.in.flight.requests.per.connection &#x3D; 1kafka.retries &#x3D; 0kafka.kerberos.enable &#x3D; falsekafka.kerberos.krb5.file &#x3D; &quot;..&#x2F;conf&#x2F;kerberos&#x2F;krb5.conf&quot;kafka.kerberos.jaas.file &#x3D; &quot;..&#x2F;conf&#x2F;kerberos&#x2F;jaas.conf&quot;###########################################################     RocketMQ     ###############################################################rocketmq.producer.group &#x3D; testrocketmq.enable.message.trace &#x3D; falserocketmq.customized.trace.topic &#x3D;rocketmq.namespace &#x3D;rocketmq.namesrv.addr &#x3D; 127.0.0.1:9876rocketmq.retry.times.when.send.failed &#x3D; 0rocketmq.vip.channel.enabled &#x3D; false###########################################################     RabbitMQ     ###############################################################rabbitmq.host &#x3D;rabbitmq.virtual.host &#x3D;rabbitmq.exchange &#x3D;rabbitmq.username &#x3D;rabbitmq.password &#x3D;</code></pre></li><li><p><strong>instanceæ¨¡æ¿é…ç½®(instance.propertios)</strong></p>  <pre class="line-numbers language-properties" data-language="properties"><code class="language-properties">################################################### mysql serverId , v1.0.26+ will autoGen# canal.instance.mysql.slaveId&#x3D;0# enable gtid use true&#x2F;falsecanal.instance.gtidon&#x3D;false# position infocanal.instance.master.address&#x3D;127.0.0.1:3306canal.instance.master.journal.name&#x3D;canal.instance.master.position&#x3D;canal.instance.master.timestamp&#x3D;canal.instance.master.gtid&#x3D;# rds oss binlogcanal.instance.rds.accesskey&#x3D;canal.instance.rds.secretkey&#x3D;canal.instance.rds.instanceId&#x3D;# table meta tsdb infocanal.instance.tsdb.enable&#x3D;true#canal.instance.tsdb.url&#x3D;jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;canal_tsdb#canal.instance.tsdb.dbUsername&#x3D;canal#canal.instance.tsdb.dbPassword&#x3D;canal#canal.instance.standby.address &#x3D;#canal.instance.standby.journal.name &#x3D;#canal.instance.standby.position &#x3D;#canal.instance.standby.timestamp &#x3D;#canal.instance.standby.gtid&#x3D;# username&#x2F;passwordcanal.instance.dbUsername&#x3D;canalcanal.instance.dbPassword&#x3D;canalcanal.instance.connectionCharset &#x3D; UTF-8# enable druid Decrypt database passwordcanal.instance.enableDruid&#x3D;false#canal.instance.pwdPublicKey&#x3D;MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBALK4BUxdDltRRE5&#x2F;zXpVEVPUgunvscYFtEip3pmLlhrWpacX7y7GCMo2&#x2F;JM6LeHmiiNdH1FWgGCpUfircSwlWKUCAwEAAQ&#x3D;&#x3D;# table regexcanal.instance.filter.regex&#x3D;.*\\..*# table black regexcanal.instance.filter.black.regex&#x3D;# table field filter(format: schema1.tableName1:field1&#x2F;field2,schema2.tableName2:field1&#x2F;field2)#canal.instance.filter.field&#x3D;test1.t_product:id&#x2F;subject&#x2F;keywords,test2.t_company:id&#x2F;name&#x2F;contact&#x2F;ch# table field black filter(format: schema1.tableName1:field1&#x2F;field2,schema2.tableName2:field1&#x2F;field2)#canal.instance.filter.black.field&#x3D;test1.t_product:subject&#x2F;product_image,test2.t_company:id&#x2F;name&#x2F;contact&#x2F;ch# mq configcanal.mq.topic&#x3D;example# dynamic topic route by schema or table regex#canal.mq.dynamicTopic&#x3D;mytest1.user,mytest2\\..*,.*\\..*canal.mq.partition&#x3D;0# hash partition config#canal.mq.partitionsNum&#x3D;3#canal.mq.partitionHash&#x3D;test.table:id^name,.*\\..*#################################################</code></pre></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>åç«¯å¼€å‘</tag>
      
      <tag>MySQL</tag>
      
      <tag>canal</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jaråŒ…æ‰§è¡Œæ—¶è®¿é—®èµ„æºæ–‡ä»¶é€ æˆçš„FileSystemNotFoundExceptioné—®é¢˜</title>
    <link href="/2021/01/07/jar%E5%8C%85%E6%89%A7%E8%A1%8C%E6%97%B6%E8%AE%BF%E9%97%AE%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E9%80%A0%E6%88%90%E7%9A%84FileSystemNotFoundException%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/"/>
    <url>/2021/01/07/jar%E5%8C%85%E6%89%A7%E8%A1%8C%E6%97%B6%E8%AE%BF%E9%97%AE%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E9%80%A0%E6%88%90%E7%9A%84FileSystemNotFoundException%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/</url>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>åœ¨Javaé¡¹ç›®ä¸­ï¼Œè‹¥éœ€è¦è®¿é—®èµ„æºæ–‡ä»¶ï¼Œé€šå¸¸ä½¿ç”¨<code>getClass().getResource(&quot;/xxx&quot;)</code>å’Œ<code>getClass().getResourceAsStream(&quot;/&quot;)</code>æ¥è·å–èµ„æºæ–‡ä»¶ï¼Œåä¸€ç§æ–¹å¼è·å–åˆ°çš„æ˜¯InputStreamï¼Œä¸€èˆ¬ä¸ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯é€šè¿‡ç¬¬ä¸€ç§è·å–èµ„æºURLçš„æ–¹å¼ï¼Œåœ¨IDEAä¸­æ‰§è¡Œæ—¶æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯åœ¨æœåŠ¡å™¨ç¯å¢ƒæ‰§è¡Œæ—¶ï¼Œä¼šå‡ºç°<code>java.nio.file.FileSystemNotFoundException</code>ï¼Œä¹‹å‰é‡åˆ°è¿™ä¸ªé—®é¢˜æˆ‘æ²¡æœ‰åœ¨æ„ï¼Œåªæ˜¯æ¢æˆ<code>getResourceAsStream</code>åå°±è§£å†³äº†ï¼Œä½†æ˜¯åæ¥é‡åˆ°ä¸€ä¸ªéœ€è¦é€’å½’è®¿é—®èµ„æºæ–‡ä»¶ç›®å½•ï¼Œæˆ‘ä½¿ç”¨çš„<code>Files.walkFileTree</code>æ–¹æ³•ï¼Œç›´æ¥è·å–è¾“å…¥æµçš„æ–¹æ¡ˆä¸é€‚åˆæˆ‘ï¼Œéšåå‘ç°å…¶å®åªè¦æ˜¯æ‰“æˆjaråŒ…æ‰§è¡Œçš„æ—¶å€™ï¼Œé€šè¿‡<code>Files</code>å’Œ<code>Path</code>å»è®¿é—®èµ„æºæ–‡ä»¶ï¼Œ<code>getResource</code>å°±ä¼šæŠ›å‡º<code>FileSystemNotFoundException</code>ï¼Œå¹¶éæœåŠ¡å™¨ç¯å¢ƒçš„é—®é¢˜ï¼Œå› ä¸ºjaråŒ…æ‰§è¡Œæ—¶ï¼Œæ–‡ä»¶ç³»ç»Ÿä¸IDEä¸­ç›´æ¥æ‰§è¡Œæ—¶ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ã€‚<br>åŸå§‹çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">Path configDir &#x3D; Paths.get(                    LocalConfigDataFlowManager.class.getResource(                            &quot;&#x2F;&quot;                    ).toURI().getPath(), &quot;flow-config&quot;            );List&lt;Map&lt;String, Object&gt;&gt; config &#x3D; new ArrayList&lt;&gt;();Files.walkFileTree(        configDir,        new HashSet&lt;&gt;(),        1,        new FileVisitor&lt;Path&gt;() &#123;        ......</code></pre><p>æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-log" data-language="log"><code class="language-log">java.nio.file.FileSystemNotFoundException        at jdk.zipfs&#x2F;jdk.nio.zipfs.ZipFileSystemProvider.getFileSystem(ZipFileSystemProvider.java:169)        at jdk.zipfs&#x2F;jdk.nio.zipfs.ZipFileSystemProvider.getPath(ZipFileSystemProvider.java:155)        at java.base&#x2F;java.nio.file.Path.of(Path.java:208)        at java.base&#x2F;java.nio.file.Paths.get(Paths.java:97)        at ink.andromeda.dataflow.core.flow.ConfigurableDataFlowManager.&lt;init&gt;(ConfigurableDataFlowManager.java:305)        at ink.andromeda.dataflow.demo.LocalConfigDataFlowManager.&lt;init&gt;(LocalConfigDataFlowManager.java:25)        at ink.andromeda.dataflow.demo.DataFlowDemoApplication.dataFlowManager(DataFlowDemoApplication.java:51)        at ink.andromeda.dataflow.demo.DataFlowDemoApplication$$EnhancerBySpringCGLIB$$73b01d37.CGLIB$dataFlowManager$0(&lt;generated&gt;)        ............2021-01-07.22:34:39.649 ERROR TraceId[] [main] i.a.d.d.LocalConfigDataFlowManager.visitFileFailed:60 null&#x2F;flow-configjava.nio.file.NoSuchFileException: null&#x2F;flow-config        at java.base&#x2F;sun.nio.fs.UnixException.translateToIOException(UnixException.java:92)        at java.base&#x2F;sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:111)        at java.base&#x2F;sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:116)        at java.base&#x2F;sun.nio.fs.UnixFileAttributeViews$Basic.readAttributes(UnixFileAttributeViews.java:55)        at java.base&#x2F;sun.nio.fs.UnixFileSystemProvider.readAttributes(UnixFileSystemProvider.java:149)        at java.base&#x2F;java.nio.file.Files.readAttributes(Files.java:1763)        at java.base&#x2F;java.nio.file.FileTreeWalker.getAttributes(FileTreeWalker.java:219)        at java.base&#x2F;java.nio.file.FileTreeWalker.visit(FileTreeWalker.java:276)        at java.base&#x2F;java.nio.file.FileTreeWalker.walk(FileTreeWalker.java:322)        at java.base&#x2F;java.nio.file.Files.walkFileTree(Files.java:2716)        at ink.andromeda.dataflow.demo.LocalConfigDataFlowManager.getFlowConfig(LocalConfigDataFlowManager.java:39)        at ink.andromeda.dataflow.core.flow.ConfigurableDataFlowManager.reload(ConfigurableDataFlowManager.java:92)        at ink.andromeda.dataflow.core.flow.ConfigurableDataFlowManager.init(ConfigurableDataFlowManager.java:56)        at java.base&#x2F;jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)        at java.base&#x2F;jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)        at java.base&#x2F;jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)        at java.base&#x2F;java.lang.reflect.Method.invoke(Method.java:566)        ......</code></pre><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>åˆšå¼€å§‹è¯•äº†å¦‚ä¸‹æ–¹æ¡ˆï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">Path configDir &#x3D; FileSystems.getDefault().getPath(new UrlResource(this.getClass().getResource(&quot;&#x2F;flow-config&quot;).toURI()).toString());</code></pre><p>ä½†æ˜¯ä»ç„¶æœ‰é—®é¢˜ï¼š</p><pre class="line-numbers language-log" data-language="log"><code class="language-log">2021-01-07.23:06:42.037 ERROR TraceId[] [main] i.a.d.d.LocalConfigDataFlowManager.visitFileFailed:63 URL [jar:file:&#x2F;Users&#x2F;windlively&#x2F;IdeaProjects&#x2F;data-flow&#x2F;data-flow-demo&#x2F;target&#x2F;data-flow-demo-1.0-SNAPSHOT.jar!&#x2F;BOOT-INF&#x2F;classes!&#x2F;flow-config]java.nio.file.NoSuchFileException: URL [jar:file:&#x2F;Users&#x2F;windlively&#x2F;IdeaProjects&#x2F;data-flow&#x2F;data-flow-demo&#x2F;target&#x2F;data-flow-demo-1.0-SNAPSHOT.jar!&#x2F;BOOT-INF&#x2F;classes!&#x2F;flow-config]        at java.base&#x2F;sun.nio.fs.UnixException.translateToIOException(UnixException.java:92)        at java.base&#x2F;sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:111)        at java.base&#x2F;sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:116)        at java.base&#x2F;sun.nio.fs.UnixFileAttributeViews$Basic.readAttributes(UnixFileAttributeViews.java:55)        at java.base&#x2F;sun.nio.fs.UnixFileSystemProvider.readAttributes(UnixFileSystemProvider.java:149)        at java.base&#x2F;java.nio.file.Files.readAttributes(Files.java:1763)        at java.base&#x2F;java.nio.file.FileTreeWalker.getAttributes(FileTreeWalker.java:219)        at java.base&#x2F;java.nio.file.FileTreeWalker.visit(FileTreeWalker.java:276)        at java.base&#x2F;java.nio.file.FileTreeWalker.walk(FileTreeWalker.java:322)        at java.base&#x2F;java.nio.file.Files.walkFileTree(Files.java:2716)        at ink.andromeda.dataflow.demo.LocalConfigDataFlowManager.getFlowConfig(LocalConfigDataFlowManager.java:42)        at ink.andromeda.dataflow.core.flow.ConfigurableDataFlowManager.reload(ConfigurableDataFlowManager.java:92)        at ink.andromeda.dataflow.core.flow.ConfigurableDataFlowManager.init(ConfigurableDataFlowManager.java:56)</code></pre><p>äºæ˜¯ç»§ç»­æŸ¥è¯¢èµ„æ–™ï¼Œåœ¨stackoverflowä¸Šçœ‹åˆ°äº†ä¸€ä¸ªåˆ©ç”¨Springçš„<code>@Value()</code>æ³¨è§£å’ŒSpring Resourceæ¥è®¿é—®èµ„æºæ–‡ä»¶çš„æ›¿ä»£æ–¹æ¡ˆï¼Œè€Œä¸”æä¾›äº†éå†èµ„æºæ–‡ä»¶å¤¹çš„æ–¹æ³•ã€‚<br>é¦–å…ˆåœ¨Beanä¸­åŠ å…¥ä¸€ä¸ªå­—æ®µå¹¶ç”¨Valueæ³¨è§£æ³¨å…¥èµ„æºæ–‡ä»¶çš„ä½ç½®ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">@Value(&quot;classpath:&#x2F;flow-config&#x2F;**&quot;)private Resource[] flowConfigResources;</code></pre><p>Springä¼šè‡ªåŠ¨å°†classesæ ¹ç›®å½•<code>flow-config</code>æ–‡ä»¶å¤¹ä¸‹çš„èµ„æºæ–‡ä»¶å…¨éƒ¨æ³¨å…¥åˆ°<code>flowConfigResources</code>å­—æ®µä¸­å»ã€‚<br>ç„¶åä¿®æ”¹åŸå…ˆçš„ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">protected List&lt;Map&lt;String, Object&gt;&gt; getFlowConfig() &#123;    return Stream.of(flowConfigResources)            .filter(s -&gt; Objects.nonNull(s.getFilename()))            .filter(s -&gt; s.getFilename().matches(&quot;^sync-config-[\\w-]+?.json$&quot;))            .map(flowConfigResource -&gt; &#123;                try (InputStream is &#x3D; flowConfigResource.getInputStream()) &#123;                    ByteArrayOutputStream os &#x3D; new ByteArrayOutputStream();                    int data;                    while ((data &#x3D; is.read()) !&#x3D; -1) os.write(data);                    &#x2F;&#x2F;noinspection unchecked                    return (Map&lt;String, Object&gt;) GSON().fromJson(os.toString(StandardCharsets.UTF_8.name()),                            new TypeToken&lt;Map&lt;String, Object&gt;&gt;() &#123;                            &#125;.getType());                &#125; catch (IOException ex) &#123;                    throw new IllegalStateException(ex);                &#125;            &#125;)            .filter(Objects::nonNull)            .collect(Collectors.toList());&#125;</code></pre><p>è¿‡æ»¤å’Œéå†Springæ³¨å…¥çš„Resourceåˆ—è¡¨ï¼Œå³å¯è¯»å–åˆ°æ­¤æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰éœ€è¦çš„èµ„æºæ–‡ä»¶ï¼Œæ‰“æˆjaråŒ…ä¹‹åä¹Ÿå¯æ­£å¸¸è¿è¡Œã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>åç«¯å¼€å‘</tag>
      
      <tag>Java</tag>
      
      <tag>è¸©å‘è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‰ç«¯å‘å±•ç®€å²</title>
    <link href="/2020/12/23/%E5%89%8D%E7%AB%AF%E5%8F%91%E5%B1%95%E7%AE%80%E5%8F%B2/"/>
    <url>/2020/12/23/%E5%89%8D%E7%AB%AF%E5%8F%91%E5%B1%95%E7%AE%80%E5%8F%B2/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰ç«¯æŠ€æœ¯å‘å±•å†ç¨‹"><a href="#å‰ç«¯æŠ€æœ¯å‘å±•å†ç¨‹" class="headerlink" title="å‰ç«¯æŠ€æœ¯å‘å±•å†ç¨‹"></a>å‰ç«¯æŠ€æœ¯å‘å±•å†ç¨‹</h2><h3 id="è¿œå¤æ—¶ä»£ï¼š"><a href="#è¿œå¤æ—¶ä»£ï¼š" class="headerlink" title="è¿œå¤æ—¶ä»£ï¼š"></a>è¿œå¤æ—¶ä»£ï¼š</h3><p>è¿˜æ²¡æœ‰å‰ç«¯è¿™ä¸ªæ¦‚å¿µï¼Œç½‘é¡µæ˜¯çº¯é™æ€é¡µé¢ï¼ŒHTMLä¼´éšç€HTTPåè®®è¯ç”Ÿï¼Œåšä¸€äº›çº¯æ–‡å­—ä¿¡æ¯çš„å±•ç¤ºã€‚</p><h3 id="CSSå’ŒJavaScriptåŠ å…¥"><a href="#CSSå’ŒJavaScriptåŠ å…¥" class="headerlink" title="CSSå’ŒJavaScriptåŠ å…¥"></a>CSSå’ŒJavaScriptåŠ å…¥</h3><p>æ—©æœŸçš„é¡µé¢æ ·å¼æ˜¯ç”±<code>&lt;font&gt;&lt;b&gt;&lt;sub&gt;&lt;center&gt;</code>ç­‰ä¸€ç³»åˆ—æ ‡ç­¾å»æ§åˆ¶çš„ï¼Œä½†æ˜¯ä¸åˆ©äºç»´æŠ¤å’Œæ‰©å±•ï¼Œæ‰€ä»¥å‡ºç°äº†CSSï¼Œå°†æ ·å¼æ§åˆ¶ç‹¬ç«‹äº†å‡ºæ¥ï¼Œåˆ©äºæ ·å¼çš„å¤ç”¨ã€‚é‚£æ—¶å€™ç½‘é€Ÿä¹Ÿå¾ˆæ…¢ï¼Œä¸ºäº†ä¼˜åŒ–äº¤äº’ä½“éªŒï¼Œè¯ç”Ÿäº†JavaScriptï¼Œæ­¤æ—¶çš„JavaScriptå°±æ˜¯åšä¸€äº›ç®€å•çš„é¡µé¢é€»è¾‘äº¤äº’ï¼Œè€Œä¸”åŸåå«LiveScriptï¼Œä¸ºäº†è¹­Javaçƒ­åº¦æ”¹ä¸ºäº†JavaScriptâ€¦â€¦</p><h3 id="JavaScriptå’ŒECMAScriptï¼Ÿ"><a href="#JavaScriptå’ŒECMAScriptï¼Ÿ" class="headerlink" title="JavaScriptå’ŒECMAScriptï¼Ÿ"></a>JavaScriptå’ŒECMAScriptï¼Ÿ</h3><p>JavaScriptçš„å¼€å‘å…¬å¸æ˜¯Netscapeï¼ŒNetscapeä¸ºäº†æŠµæŠ—å¾®è½¯çš„JScriptï¼Œå°†JavaScriptæäº¤ç»™ECMAå›½é™…æ ‡å‡†åŒ–ç»„ç»‡ï¼Œå¸Œæœ›JavaScriptæˆä¸ºå›½é™…æ ‡å‡†ï¼Œåæ¥ECMAç»„ç»‡é¢å¸ƒäº†æµè§ˆå™¨è„šæœ¬è¯­è¨€æ ‡å‡†ï¼Œç§°ä¹‹ä¸ºECMAScriptï¼Œå› æ­¤ECMAScriptæ˜¯ä¸€å¥—è§„èŒƒæ ‡å‡†ï¼Œè€ŒJavaScriptã€å¾®è½¯çš„JScriptåˆ™æ˜¯è¿™å¥—æ ‡å‡†çš„å®ç°ï¼Œå¤§å¤šæ•°åœºåˆä¸‹ECMAScriptå’ŒJavaScriptçš„ç§°å‘¼å¯ä»¥é€šç”¨ã€‚</p><h3 id="Dreamweaverã€Fireworkã€Flashã€FrontPageç­‰æ‹–æ‹½å¼è®¾è®¡ç½‘é¡µçš„è½¯ä»¶"><a href="#Dreamweaverã€Fireworkã€Flashã€FrontPageç­‰æ‹–æ‹½å¼è®¾è®¡ç½‘é¡µçš„è½¯ä»¶" class="headerlink" title="Dreamweaverã€Fireworkã€Flashã€FrontPageç­‰æ‹–æ‹½å¼è®¾è®¡ç½‘é¡µçš„è½¯ä»¶"></a>Dreamweaverã€Fireworkã€Flashã€FrontPageç­‰æ‹–æ‹½å¼è®¾è®¡ç½‘é¡µçš„è½¯ä»¶</h3><ul><li><p>Dreamweaver</p><p>å¤§åé¼é¼çš„è®¾è®¡è½¯ä»¶å…¬å¸Adobeå‡ºå“çš„äº§å“ï¼Œå°†ç½‘é¡µå¼€å‘å˜æˆäº†æ‰€è§å³æ‰€å¾—ï¼Œå¯ä»¥ä½¿å¾—ä¸æ‡‚ä»£ç çš„äººç»è¿‡ç®€å•çš„æ‹–æ‹½æ“ä½œå³å¯å¿«é€Ÿç”Ÿæˆä¸€å¥—é™æ€ç½‘é¡µã€‚Dreamweaverè‡³ä»Šä»ç„¶åœ¨æ›´æ–°ï¼Œæ”¯æŒçš„åŠŸèƒ½ä¹Ÿè¶Šæ¥è¶Šé«˜çº§äº†ã€‚</p></li></ul><ul><li><p>FrontPage</p><p>å¾®è½¯çš„ç½‘é¡µåˆ¶ä½œè½¯ä»¶ï¼Œå±äºOfficeç»„ä»¶ä¸­çš„ä¸€ä¸ªäº§å“ï¼ŒåŠŸèƒ½ä¹Ÿååˆ†å¼ºå¤§ï¼Œè¿˜æ”¯æŒæ•°æ®åº“ç›¸å…³æ“ä½œï¼Œäº2006å¹´åœæ­¢æ›´æ–°ï¼Œåç”±SharePoint Designerå’ŒExpression Webä»£æ›¿</p></li></ul><h3 id="åŠ¨æ€ç½‘é¡µæŠ€æœ¯CGIã€PHPã€JSPç­‰çš„äº§ç”Ÿ"><a href="#åŠ¨æ€ç½‘é¡µæŠ€æœ¯CGIã€PHPã€JSPç­‰çš„äº§ç”Ÿ" class="headerlink" title="åŠ¨æ€ç½‘é¡µæŠ€æœ¯CGIã€PHPã€JSPç­‰çš„äº§ç”Ÿ"></a>åŠ¨æ€ç½‘é¡µæŠ€æœ¯CGIã€PHPã€JSPç­‰çš„äº§ç”Ÿ</h3><ul><li><p>CGI</p><p>CGI(é€šç”¨ç½‘å…³æ¥å£)æ˜¯æœ€è€çš„ä¸€ç§æŠ€æœ¯ï¼Œå…¶å®å°±æ˜¯ä¸€ç»„æ¥å£è§„èŒƒï¼Œå¯ä»¥ç”¨è®¸å¤šè¯­è¨€( C ã€C++ ã€VBå’ŒPerlç­‰)ç¼–å†™ï¼Œåªè¦å®ç°å…¶æ¥å£å³å¯ï¼Œå½“æµè§ˆå™¨å‘èµ·è¯·æ±‚ï¼Œç»WebæœåŠ¡å™¨è·¯ç”±åä¼šå¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œè°ƒç”¨å¯¹åº”çš„çš„CGIç¨‹åºï¼Œç¨‹åºæ‰§è¡Œå®Œæ¯•åè¿”å›HTMLæ–‡æœ¬è‡³æµè§ˆå™¨ï¼Œå±•ç¤ºç»™ç”¨æˆ·ã€‚ç”±äºCGIæ€§èƒ½ä½ä¸‹ï¼Œåæ¥è¡ç”Ÿå‡ºFastCGIï¼Œè‡³ä»Šä»æ˜¯ä¸€ç§å¹¿æ³›åº”ç”¨çš„æŠ€æœ¯ï¼Œä¸»æµwebæœåŠ¡å™¨(Apacheã€Nginxã€Microsoft IISç­‰)å‡æ”¯æŒè¯¥æŠ€æœ¯ã€‚</p></li><li><p>PHP</p><p>æ˜¯ä¸€ç§åœ¨HTMLæ–‡æœ¬ä¸­åµŒå…¥æœåŠ¡ç«¯ä»£ç çš„è„šæœ¬è¯­è¨€ï¼Œå¯ä»¥è·¨å¹³å°è¿è¡Œã€‚ç”±äºå…¶ç®€å•æ˜“ä¸Šæ‰‹ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œåˆæ˜¯å¼€æºæŠ€æœ¯ï¼Œæ›¾åœ¨Webå¼€å‘é¢†åŸŸé£é¡ä¸€æ—¶ï¼Œå’ŒMySQLæ˜¯å¥½åŸºå‹ã€‚ï¼ˆPHPæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€ yeah~ï¼‰</p></li><li><p>JSP</p><p>åŸºäºJavaçš„åŠ¨æ€ç½‘é¡µæŠ€æœ¯ï¼Œä¸PHPæœ‰äº›è®¸ç±»ä¼¼ï¼Œä¹Ÿæ˜¯åœ¨HTMLä»£ç ä¸­åµŒå…¥Javaä»£ç ï¼Œç”±æœåŠ¡ç«¯ç¼–è¯‘æ‰§è¡Œã€‚Javaæ˜¯Webå¼€å‘é¢†åŸŸæœ€ä¸»æµçš„æŠ€æœ¯ä¹‹ä¸€ï¼Œè¯ç”Ÿè¿‡è®¸å¤šä¼˜ç§€çš„Webæ¡†æ¶æŠ€æœ¯ï¼Œä»SSH(Structã€Springã€Hibernate)åˆ°SSM(Springã€Spring MVCã€MyBatis)ï¼Œéƒ½æ·±å—å¼€å‘è€…å–œçˆ±ã€‚å¦‚ä»Šå·²ç»æ˜¯Springä¸€å®¶ç‹¬å¤§ï¼Œå‡ ä¹å›Šæ‹¬äº†åç«¯å¼€å‘çš„æ–¹æ–¹é¢é¢ã€‚ç›¸æ¯”äºPHPæŠ€æœ¯è¦æ±‚æ›´é«˜ä¸€ç‚¹ã€‚</p></li></ul><ul><li><p>ASP</p><p>å¾®è½¯å®¶çš„åŠ¨æ€ç½‘é¡µæŠ€æœ¯ï¼ŒåŒæ—¶æ”¯æŒVBScriptå’ŒJScriptï¼Œä¸€èˆ¬ç»“åˆ.NETæ¡†æ¶ä½¿ç”¨ï¼ŒæŠ€æœ¯ä»¥åŠåŠŸèƒ½ä¸Šæ¥è¯´éƒ½æŒºå¥½ï¼Œå°±æ˜¯æ”¶è´¹ï¼Œè´¢å¤§æ°”ç²—çš„å…¬å¸å¤šæ•°å¯èƒ½ä¼šé€‰æ‹©å®ƒã€‚ã€‚ã€‚</p></li></ul><ul><li><p>FreeMarkerã€Thymeleafç­‰åç«¯æ¨¡æ¿å¼•æ“</p><p>ç›¸å¯¹äºJSPè¿›è¡Œä¼˜åŒ–çš„é¡µé¢æ¸²æŸ“æ¡†æ¶ï¼Œè¿™ä¸¤ç§æ¨¡æ¿å¼•æ“Spring Bootæ¡†æ¶éƒ½ç»™äºˆäº†è‰¯å¥½çš„æ”¯æŒã€‚</p></li></ul><h3 id="AjaxæŠ€æœ¯å…´èµ·ä»¥åŠJQueryæ—¶ä»£é™ä¸´"><a href="#AjaxæŠ€æœ¯å…´èµ·ä»¥åŠJQueryæ—¶ä»£é™ä¸´" class="headerlink" title="AjaxæŠ€æœ¯å…´èµ·ä»¥åŠJQueryæ—¶ä»£é™ä¸´"></a>AjaxæŠ€æœ¯å…´èµ·ä»¥åŠJQueryæ—¶ä»£é™ä¸´</h3><ul><li><p>Ajax</p><p>å¼‚æ­¥çš„JavaScriptå’ŒXML(Asynchronous JavaScript and XML)æŠ€æœ¯ï¼Œåœ¨ä¹‹å‰çš„æ¶æ„ä¸­ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¤„ç†ç»“æŸåè¿”å›ä¸€ä¸ªæ–°çš„HTMLæ–‡æœ¬ï¼Œè¿™æ ·æ¯ä¸€æ¬¡è¯·æ±‚éƒ½ä¼šäº¤äº’å¤§é‡æ•°æ®ï¼Œè€Œä¸”è¿˜è¦å ç”¨æœåŠ¡ç«¯èµ„æºæ¸²æŸ“HTMLæ–‡æ¡£ï¼Œå› æ­¤äº§ç”Ÿäº†AjaxæŠ€æœ¯ï¼šé€šè¿‡JavaScriptä»£ç ä¸»åŠ¨è¯·æ±‚æœåŠ¡å™¨ï¼Œè€ŒæœåŠ¡å™¨åªè¿”å›å®¢æˆ·ç«¯éœ€è¦çš„æ•°æ®ï¼Œä¸å†å°†æ•°æ®æ¸²æŸ“ä¸ºHTMLè¿”å›ï¼Œå®¢æˆ·ç«¯æ‹¿åˆ°æ•°æ®ä¹‹åï¼Œé€šè¿‡DOMæ“ä½œå¼‚æ­¥çš„æ›´æ–°ç•Œé¢ï¼ŒAjaxçš„ä¼˜ç‚¹éå¸¸æ˜æ˜¾ï¼š</p><ul><li>æå¤§çš„å‡å°‘äº†ç½‘ç»œé€šä¿¡çš„æ•°æ®é‡ï¼Œæ¯”å¦‚æœ‰æ—¶å€™é¡µé¢ä»…éœ€å˜æ›´ä¸€ä¸ªæ•°å­—ï¼ŒåŸå…ˆçš„æœåŠ¡ç«¯æ¸²æŸ“æ–¹å¼å°±éœ€è¦å°†æ•´ä¸ªé¡µé¢å…¨éƒ¨é‡æ–°è¿”å›ï¼Œè€Œajaxæ–¹å¼åªéœ€è¦è¿”å›è¿™ä¸ªæ›´æ–°åçš„æ•°å­—ã€‚</li><li>å‡è½»æœåŠ¡å™¨å‹åŠ›ï¼Œåœ¨å¤§é‡è¯·æ±‚æ—¶ï¼Œä»…æ¸²æŸ“HTMLæ–‡æ¡£æ‰€å ç”¨çš„èµ„æºå°±å·²ç»å¾ˆå¤§äº†ï¼Œè€Œå®¢æˆ·ç«¯JavaScriptä»£ç æ›´æ–°é¡µé¢åˆ™ä¸ä¼šå­˜åœ¨æ­¤é—®é¢˜ã€‚</li><li>é¡µé¢æ˜¯å±€éƒ¨åˆ·æ–°çš„ï¼Œè€Œä¸æ˜¯è·Ÿä»¥å‰ä¸€æ ·å…¨éƒ¨åˆ·æ–°ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½ã€‚</li></ul><p>ä½†æ˜¯ä¹Ÿæœ‰ä¸€éƒ¨åˆ†ç¼ºç‚¹ï¼š</p><ul><li>ç”¨æˆ·ä½¿ç”¨æµè§ˆå™¨å‰è¿›åé€€æ—¶çš„ä½“éªŒä¸å¥½ï¼Œå¼‚æ­¥åˆ·æ–°çš„å±€éƒ¨æ›´æ–°æ–¹å¼æµè§ˆå™¨æ— æ³•è·å–å†å²é¡µé¢ï¼Œå³ä¸¢å¤±äº†é¡µé¢çš„å˜æ›´å†å²ï¼Œä½†æ˜¯è¿™ä¸€ç‚¹ä¹‹åä¹Ÿæœ‰å¼€å‘è€…æƒ³å‡ºåŠæ³•è§£å†³ã€‚<br>æœç´¢å¼•æ“æ— æ³•SEOã€‚æœç´¢å¼•æ“å…¬å¸çš„çˆ¬è™«è„šæœ¬è·å–ä¸åˆ°ç½‘ç«™æ•°æ®ï¼Œåªèƒ½å¾—åˆ°ä¸€æ®µå‘é€HTTPè¯·æ±‚çš„JSä»£ç ï¼Œå¯¹ç½‘ç«™çš„SEOæ˜¯ä¸€ä¸ªè´Ÿé¢å½±å“ï¼Œä¸è¿‡Googleå¯¹æ­¤å·²ç»æœ‰äº†è§£å†³æ–¹æ¡ˆï¼Œgoogleçš„æœç´¢å¼•æ“å·²ç»å¯ä»¥é€šè¿‡æ‰§è¡Œç½‘é¡µä¸­çš„JSä»£ç æ¥çˆ¬å–æ•°æ®äº†ï¼ˆé»‘ç§‘æŠ€å•Šï¼~ï¼‰</li><li>æ—©æœŸå…¼å®¹æ€§ä¸å¥½ï¼Œä½†æ˜¯ç°åœ¨å·²ç»ä¸æ˜¯é—®é¢˜äº†ã€‚</li></ul><p>Ajaxåœ¨JavaScriptä¸­æ˜¯é€šè¿‡XmlHttpRequestå¯¹è±¡æ¥æ”¯æŒçš„ï¼ŒåŸç”Ÿçš„XHR APIç”¨èµ·æ¥æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œäºæ˜¯ä¾¿æœ‰äººå¯¹å…¶è¿›è¡Œäº†å°è£…ï¼Œé¡ºä¾¿å¤„ç†äº†å…¼å®¹æ€§ï¼Œç”¨èµ·æ¥ååˆ†æ–¹ä¾¿ï¼Œæ¯”å¦‚JQueryã€‚<br>éšç€Ajaxçš„å…´èµ·ï¼ŒJSONè¿™ç§æ•°æ®æ ¼å¼ä¹Ÿéšä¹‹æ…¢æ…¢è¢«å¤§å®¶æ‰€é‡‡ç”¨çš„ï¼Œå‡­å€Ÿæ¯”XMLçš„ç®€æ´ä¸æ–¹ä¾¿ï¼Œç°åœ¨å·²æˆä¸ºä¸»æµçš„æ•°æ®äº¤äº’æ ¼å¼ä¹‹ä¸€ã€‚</p></li><li><p>JQuery</p><p>JQueryæ˜¯ä¹‹å‰éå¸¸æµè¡Œçš„ä¸€æ¬¾å‰ç«¯JSæ¡†æ¶ï¼Œç®€æ´ä¸”åŠŸèƒ½å¼ºå¤§ï¼Œè¿˜å¸®åŠ©å¼€å‘è€…å¤„ç†äº†å¾ˆå¤šå…¼å®¹æ€§é—®é¢˜ï¼Œä¼˜åŒ–äº†DOMæ“ä½œï¼Œå°è£…äº†è®¸å¤šéå¸¸å¥½ç”¨çš„APIï¼Œæ˜¯å½“æ—¶å‰ç«¯å¿…å¤‡çš„åˆ©å™¨ï¼Œæˆ‘å½“æ—¶å¯¹å…¶ä¹Ÿçˆ±ä¸é‡Šæ‰‹ï¼Œè‡³ä»Šä»ç„¶è¿˜æœ‰ä¸å°‘äººåœ¨ç”¨ã€‚åœ¨æ­¤æ®µæ—¶æœŸï¼Œå‰åç«¯å¼€å‘ä¹Ÿæ¸æ¸å‡ºç°äº†åˆ†ç¦»çš„è¿¹è±¡ã€‚</p></li></ul><h3 id="æ¶åœ¨Chrome-V8ä¸Šçš„Node"><a href="#æ¶åœ¨Chrome-V8ä¸Šçš„Node" class="headerlink" title="æ¶åœ¨Chrome V8ä¸Šçš„Node"></a>æ¶åœ¨Chrome V8ä¸Šçš„Node</h3><ul><li><p>V8 JavaScriptå¼•æ“</p><p>V8æ˜¯ç”±Googleç ”å‘çš„ä¸€æ¬¾JavaScriptæ‰§è¡Œå¼•æ“ï¼Œå¹¶ä¸”è°·æ­Œå°†å…¶å¼€æºï¼ŒV8çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯ï¼šå¿«ï¼ï¼Œéå¸¸å¿«ï¼Œå„ç§ä¼˜åŒ–çš„å¥‡æ·«æŠ€å·§ï¼Œè¯ç”Ÿäº†è¿™ä¸ªæ°ä½œã€‚æ‰€ä»¥å½“å¹´äº§ç”Ÿäº†ä¸å°‘è°ƒä¾ƒChromeå’ŒIEçš„æ®µå­ï¼Œè€Œç”±äºV8çš„å‡ºç°ï¼Œåœ¨æœåŠ¡å™¨ä¸Šè¿è¡ŒJavaScriptä»£ç æˆä¸ºäº†å¯èƒ½ã€‚</p></li><li><p>Node.js</p><p>Nodeå‡­å€Ÿç€V8å¼•æ“çš„åŸºç¡€ï¼Œå°†JavaScriptæ¬åˆ°äº†åå°ï¼ŒV8ä½œä¸ºNodeçš„è¿è¡Œæ—¶ï¼Œå¹¶æ·»åŠ äº†ä¸€äº›ä¸æ“ä½œç³»ç»Ÿäº¤äº’çš„APIï¼Œä½¿å…¶å¯ä»¥è„±ç¦»æµè§ˆå™¨è¿è¡Œï¼Œè¯•å›¾å°†JavaScriptåº”ç”¨äºåç«¯å¼€å‘ï¼Œåˆ†ä¸€æ¯æœåŠ¡å™¨å¼€å‘çš„ç¾¹ï¼Œå¹¶ä¸”ç¡®å®ç«äº†ä¸€æŠŠï¼Œè™½ç„¶æœ€ç»ˆæœªèƒ½æ’¼åŠ¨Javaçš„åœ°ä½ï¼Œä½†æ˜¯ä»–çš„åŒ…ç®¡ç†å·¥å…·NPMä»¥åŠä¾èµ–ç®¡ç†åç»­è¢«å¤§å®¶å¹¿æ³›ä½¿ç”¨ï¼Œä¸ºåæ¥å‰ç«¯é¡¹ç›®çš„å·¥ç¨‹åŒ–å¥ å®šäº†åŸºç¡€ï¼Œä½¿å¾—å‰ç«¯å¼€å‘è€…ä»¬æœ‰äº†åª²ç¾åç«¯çš„ä¸€ç³»åˆ—é¡¹ç›®å·¥å…·ï¼ˆä¾èµ–ç®¡ç†ã€ç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…ã€éƒ¨ç½²ã€è¿è¡Œï¼‰ã€‚</p></li></ul><h3 id="JavaScriptç¼–è¯‘å™¨ä»¥åŠTypeScriptç­‰è®¸å¤šæ–°æŠ€æœ¯"><a href="#JavaScriptç¼–è¯‘å™¨ä»¥åŠTypeScriptç­‰è®¸å¤šæ–°æŠ€æœ¯" class="headerlink" title="JavaScriptç¼–è¯‘å™¨ä»¥åŠTypeScriptç­‰è®¸å¤šæ–°æŠ€æœ¯"></a>JavaScriptç¼–è¯‘å™¨ä»¥åŠTypeScriptç­‰è®¸å¤šæ–°æŠ€æœ¯</h3><ul><li><p>Babel.js</p><p>babelæ˜¯ä¸€ä¸ªå¼€æºçš„JavaScriptç¼–è¯‘(è½¬è¯‘)å™¨ï¼Œç”¨äºå°†å…¶ä»–çš„ç¼–ç¨‹é£æ ¼è½¬æ¢ä¸ºJavaScriptä»£ç ã€‚Babelçš„å‡ºç°ä¸»è¦æ˜¯å› ä¸ºåœ¨ES 5ã€ES 6æ ‡å‡†é—®ä¸–ä¹‹åï¼Œå„æµè§ˆå™¨å‚å•†å´æœªèƒ½åŠæ—¶æ”¯æŒï¼Œæ‰€ä»¥å‡ºç°äº†æ­¤ç±»è½¬è¯‘å·¥å…·ï¼Œå¯ä»¥å°†ES 5 + çš„è¯­æ³•ç¼–è¯‘æˆå‘åå…¼å®¹çš„JavaScriptè¯­æ³•ï¼Œä¹Ÿå¯è‡ªå®šä¹‰è¯­æ³•ï¼Œæå‡å¼€å‘æ•ˆç‡ï¼ŒReactæ¡†æ¶çš„è¯­æ³•ç¿»è¯‘å°±ä¾èµ–æ­¤åº“ã€‚</p></li><li><p>TypeScript</p><p>TypeScriptæ˜¯JavaScriptçš„è¶…é›†ï¼Œç”±å¾®è½¯æ¨å‡ºå¹¶å¼€æºï¼Œå®ƒåœ¨JavaScriptåŸºç¡€ä¹‹ä¸Šå¢æ·»äº†è®¸å¤šå¼ºå¤§çš„åŠŸèƒ½æ”¯æŒï¼Œæœ€é‡è¦çš„ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯åŠ å…¥äº†é™æ€ç±»å‹ç³»ç»Ÿçš„æ”¯æŒï¼Œä½¿å…¶æ›´é€‚åˆäºå¤§å‹å·¥ç¨‹é¡¹ç›®ï¼Œå¹¶ä¸”å¯¹äºç±»å‹çš„æ”¯æŒæ¯”Javaä¹‹ç±»çš„è¯­è¨€æ›´åŠ ä¼˜é›…ã€‚TypeScriptä»£ç é€šè¿‡TypeScriptç¼–è¯‘æœŸæˆ–Babelç¼–è¯‘ä¸ºJavaScriptä»£ç æ‰§è¡Œã€‚</p></li><li><p>æœåŠ¡ç«¯æ¨é€æŠ€æœ¯</p><ul><li><p>SSE</p><p>SSE(Server-Sent Events)æ˜¯æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®çš„ä¸€ç§æŠ€æœ¯ï¼ŒåŸå…ˆçš„webæ¨¡å‹åªèƒ½æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡ç«¯è¢«åŠ¨å“åº”ï¼Œè€ŒæœåŠ¡å™¨æ— æ³•ä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œæ‰€ä»¥å‡ºç°äº†SSEæ–¹æ¡ˆï¼Œå…¶å®SSEä»ç„¶æ˜¯åŸºäºHTTPé•¿è¿æ¥çš„ä¸€ç§æŠ€æœ¯ï¼Œæœ¬è´¨ä»ç„¶æ˜¯HTTPåè®®ï¼Œå…¶Content-Typeä¸ºtext/event-streamç±»å‹ï¼ŒJavaScriptä»£ç ä½¿ç”¨EventSourceå¯¹è±¡è¿›è¡Œå¤„ç†ï¼Œå‘é€çš„æ–‡æœ¬æœ‰å›ºå®šæ ¼å¼ï¼Œä½¿ç”¨è¾ƒä¸ºç®€å•æ–¹ä¾¿ï¼Œä½†æ˜¯åªèƒ½æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å•å‘å‘é€æ•°æ®ã€‚Spring MVCæ¡†æ¶å¯¹SSEæœ‰ä¸é”™çš„æ”¯æŒã€‚</p></li><li><p>WebSocket</p><p>å»ºç«‹åœ¨TCPä¹‹ä¸Šçš„å¦å¤–ä¸€ç§ç½‘ç»œé€šä¿¡åè®®ï¼Œæ”¯æŒå…¨åŒå·¥é€šä¿¡ï¼Œä¸”æ•ˆç‡æ›´é«˜ï¼Œä½¿ç”¨èµ·æ¥æ¯”SSEå¤æ‚ä¸€äº›ï¼Œé€‚åˆéœ€è¦ä¸æœåŠ¡ç«¯è¿›è¡Œé¢‘ç¹äº¤äº’çš„åœºæ™¯ã€‚</p></li></ul></li></ul><ul><li><p>HTML5æ–°ç‰¹æ€§</p><p>HTML5æ ‡å‡†å…¶å®è¯ç”Ÿæ—¶é—´æ¯”è¾ƒæ—©ï¼Œç”±W3Cäº2014å¹´10æœˆå®Œæˆæ ‡å‡†åˆ¶å®šï¼Œä½†æ˜¯å„ä¸ªæµè§ˆå™¨æ”¯æŒè¿›åº¦ä¸ä¸€ï¼Œç›´è‡³Chrome 67ã€IE8ç­‰ç°ä»£æµè§ˆå™¨é—®ä¸–ä¹‹åï¼ŒHTML5æ ‡å‡†æ‰è¢«è¾ƒå¥½çš„æ”¯æŒã€‚</p><ul><li><p>canvasç”»å¸ƒ</p><p>æ”¯æŒä½¿ç”¨JavaScriptä»£ç åœ¨é¡µé¢ä¸Šç»˜åˆ¶å¤æ‚å›¾å½¢ä»¥åŠåŠ¨ç”»ã€‚</p></li><li><p>å¤šåª’ä½“æ ‡ç­¾</p><p><code>&lt;audio&gt;&lt;video&gt;</code>ç­‰æ ‡ç­¾çš„åŠ å…¥ï¼Œä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥æ›´å®¹æ˜“çš„åœ¨ç½‘é¡µä¸­å¤„ç†å¤šåª’ä½“å†…å®¹ï¼Œæ­¤å‰è¿™ç±»å¤æ‚å†…å®¹ä¸»è¦é€šè¿‡Flashã€ActiveXç­‰æ§ä»¶å¤„ç†ï¼Œè€Œç°åœ¨HTMLåŸç”Ÿæ”¯æŒå¤šåª’ä½“å¤„ç†ï¼ŒFlashç­‰æŠ€æœ¯ç”±äºå®‰å…¨æ€§ç›¸å…³é—®é¢˜å·²ç»æ…¢æ…¢è¢«é—å¼ƒï¼ŒChromeæµè§ˆå™¨æ—©å·²é»˜è®¤ç¦ç”¨flashã€‚</p></li><li><p>å…¶ä»–æ–°ç‰¹æ€§</p><p>æœ¬åœ°å­˜å‚¨ã€WEB SQLã€<code>&lt;article&gt;&lt;footer&gt;&lt;header&gt;&lt;nav&gt;&lt;section&gt;</code>ç­‰æ–°æ ‡ç­¾ï¼Œetcâ€¦</p></li></ul></li><li><p>CSSæ–°ç‰¹æ€§</p><p>CSSé™†ç»­åŠ å…¥äº†è®¸å¤šå¼ºå¤§å’Œæœ‰è¶£çš„åŠŸèƒ½ï¼Œä½¿å¾—UIå¯ä»¥è¶Šæ¥è¶Šæ¼‚äº®ï¼Œè¿™ä¹Ÿå¾—ç›Šäºå®¢æˆ·ç«¯æµè§ˆå™¨æ€§èƒ½è¶Šæ¥è¶Šå¼ºæ‚ï¼š</p><ul><li>é€‚åˆç§»åŠ¨è®¾å¤‡çš„flexå¸ƒå±€</li><li>MediaQueryåŠ å…¥ï¼Œæ”¯æŒå“åº”å¼å¸ƒå±€</li><li>Gridå¸ƒå±€</li><li>CSSæ»¤é•œ</li><li>CSSèƒŒæ™¯è™šåŒ–</li><li>CSSåŠ¨ç”»</li><li>â€¦â€¦</li></ul></li></ul><h3 id="React-jsã€Angularã€Vue-jsç­‰æ¡†æ¶é™†ç»­ç™»åœº"><a href="#React-jsã€Angularã€Vue-jsç­‰æ¡†æ¶é™†ç»­ç™»åœº" class="headerlink" title="React.jsã€Angularã€Vue.jsç­‰æ¡†æ¶é™†ç»­ç™»åœº"></a>React.jsã€Angularã€Vue.jsç­‰æ¡†æ¶é™†ç»­ç™»åœº</h3><p>éšç€å‰åç«¯åˆ†ç¦»çš„webå¼€å‘æ–¹æ¡ˆä»¥åŠSPA(å•é¡µé¢åº”ç”¨)çš„æ¦‚å¿µè¶Šæ¥è¶Šæµè¡Œï¼Œå‰ç«¯æ¡†æ¶ä¹Ÿå¼€å§‹å±‚å‡ºä¸ç©·ï¼Œå°†åŸå…ˆå±äºåç«¯çš„MVCæ¨¡å‹åˆ©ç”¨JSæ¬åˆ°äº†å‰ç«¯ï¼Œåˆå½¢æˆäº†MVVMã€MVPç­‰æ¨¡å‹æ¦‚å¿µï¼Œå…¶ä¸­ä»¥Reactã€Angularã€Vueæœ€ä¸ºå‡ºåå’Œæµè¡Œï¼Œå½»åº•å°†å‰ç«¯å¼€å‘ä»åç«¯å¼€å‘ä¸­å‰¥ç¦»å‡ºæ¥ï¼Œä½¿å¾—å‰ç«¯å¼€å‘æ›´ä¸ºçº¯ç²¹ï¼Œä¸“æ³¨äºé¡µé¢è§†å›¾å¼€å‘ï¼Œæ›¾é£å…‰æ— é™çš„JQueryä¸€ç±»çš„jsåº“å¼€å§‹æ…¢æ…¢æ·¡å‡ºå†å²èˆå°ï¼Œå¾—ç›Šäºæ¡†æ¶æä¾›çš„å¼ºå¤§åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦æ‰‹åŠ¨æ“çºµDOMæ–‡æ¡£ã€‚æ¡†æ¶æŠ€æœ¯åœ¨æ­¤æ—¶çš„å‘å±•ååˆ†è¿…é€Ÿï¼Œç”šè‡³å¼€å§‹å‘åŸç”ŸAPPå¼€å‘é¢†åŸŸæŒºè¿›ï¼Œè€ŒåŸºäºè¿™äº›æ¡†æ¶æŠ€æœ¯å¼€å‘çš„ç½‘ç«™ï¼Œåˆå¯è¢«ç§°ä¹‹ä¸ºWeb Appï¼Œç½‘ç«™å·²ç»ä»åŸå…ˆçš„ä¿¡æ¯å±•ç¤ºå˜æˆäº†ä¸€äº›åŠŸèƒ½æ€§åº”ç”¨ã€‚Androidã€Windowséƒ½æœ‰å°†JSå¼€å‘çš„åº”ç”¨è½¬æ¢ä¸ºå¯¹åº”å¹³å°APPçš„æŠ€æœ¯ï¼Œè‡³æ­¤ï¼ŒJavaScriptå·²ç»åšåˆ°äº†â€Any application that can be written in JavaScript, will eventually be written in JavaScriptâ€ï¼</p><h3 id="å¤§å‰ç«¯æ—¶ä»£ï¼Œç™¾èŠ±é½æ”¾çš„WebAppæ¡†æ¶"><a href="#å¤§å‰ç«¯æ—¶ä»£ï¼Œç™¾èŠ±é½æ”¾çš„WebAppæ¡†æ¶" class="headerlink" title="å¤§å‰ç«¯æ—¶ä»£ï¼Œç™¾èŠ±é½æ”¾çš„WebAppæ¡†æ¶"></a>å¤§å‰ç«¯æ—¶ä»£ï¼Œç™¾èŠ±é½æ”¾çš„WebAppæ¡†æ¶</h3><p>æ­¤æ—¶çš„å‰ç«¯åˆè¢«è®¸å¤šäººç§°ä¹‹ä¸ºâ€å¤§å‰ç«¯â€ï¼ŒJavaScriptæ—©å·²ä¸å†å±€é™äºä¼ ç»Ÿç½‘ç«™çš„å¼€å‘ï¼ŒElectronã€React Nativeã€å¾®ä¿¡å°ç¨‹åºã€æ”¯ä»˜å®å°ç¨‹åºç­‰ç­‰ï¼Œéƒ½åœ¨å°è¯•åŸºäºæµè§ˆå™¨çš„è·¨å¹³å°APPæŠ€æœ¯ï¼Œä¹Ÿéƒ½å–å¾—äº†ä¸é”™çš„æ•ˆæœï¼ŒJavaScriptä»æ—©æœŸä¸€ä¸ªæ— æ•°äººåæ§½çš„è„šæœ¬è¯­è¨€è¿›åŒ–åˆ°ç°åœ¨æˆä¸ºäº†å‰ç«¯å¼€å‘çš„æ ¸å¿ƒã€‚<br>åˆ°ä»Šå¤©ï¼Œäººä»¬è¿˜ä¸æ»¡è¶³äºæ­¤ï¼Œå‰ç«¯æŠ€æœ¯ä»åœ¨é«˜é€Ÿå‘å±•ï¼Œä»¥Googleä¸ºä»£è¡¨çš„ä¼—å¤šè¡Œä¸šé¢†å¤´ç¾Šç»§ç»­åœ¨æ¢ç´¢æœªæ¥çš„å‰ç«¯æ–¹å‘ï¼Œä¾‹å¦‚æµè§ˆå™¨å·²ç»å¼€å§‹æ”¯æŒçš„WebAssemblyæŠ€æœ¯å’ŒGoogleçš„Flutterè·¨å¹³å°åŸç”ŸAPPå¼€å‘æ¡†æ¶ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>å‰ç«¯å¼€å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerå®‰è£…mongo</title>
    <link href="/2020/12/15/docker%E5%AE%89%E8%A3%85mongo/"/>
    <url>/2020/12/15/docker%E5%AE%89%E8%A3%85mongo/</url>
    
    <content type="html"><![CDATA[<ul><li><p>æ‹‰å–é•œåƒ<br><code>docker pull mongo</code></p></li><li><p>é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æ–‡ä»¶å¤¹, åˆ›å»ºmongoç›®å½•å¹¶è¿›å…¥<br><code>mkdir mongo &amp;&amp; cd mongo</code></p></li><li><p>åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•<br><code>mkdir conf</code></p></li><li><p>åˆ›å»ºå¹¶ç¼–è¾‘é…ç½®æ–‡ä»¶<br><code>vim conf/mongod.conf</code><br>mongod.configä¸ºmongoé…ç½®æ–‡ä»¶, ç¤ºä¾‹:</p><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml">storage:journal:  enabled: trueengine: wiredTiger#å¦‚ä¸‹é…ç½®ä»…å¯¹ wiredTiger å¼•æ“ç”Ÿæ•ˆï¼ˆ3.0 ä»¥ä¸Šç‰ˆæœ¬ï¼‰ wiredTiger:  engineConfig:  # wiredTigerç¼“å­˜å·¥ä½œé›†ï¼ˆworking setï¼‰æ•°æ®çš„å†…å­˜å¤§å°ï¼Œå•ä½ï¼šGB   # æ­¤å€¼å†³å®šäº†wiredTigerä¸mmapv1çš„å†…å­˜æ¨¡å‹ä¸åŒï¼Œå®ƒå¯ä»¥é™åˆ¶mongodå¯¹å†…å­˜çš„ä½¿ç”¨é‡ï¼Œè€Œmmapv1åˆ™ä¸èƒ½ï¼ˆä¾èµ–äºç³»ç»Ÿçº§çš„mmapï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒcacheSizeGB çš„å€¼ä¸ºå‡å®šå½“å‰èŠ‚ç‚¹åªéƒ¨ç½²ä¸€ä¸ªmongodå®ä¾‹ï¼Œæ­¤å€¼çš„å¤§å°ä¸ºç‰©ç†å†…å­˜çš„ä¸€åŠï¼›å¦‚æœå½“å‰èŠ‚ç‚¹éƒ¨ç½²äº†å¤šä¸ªmongodè¿›ç¨‹ï¼Œé‚£ä¹ˆéœ€è¦åˆç†é…ç½®æ­¤å€¼ã€‚å¦‚æœmongodéƒ¨ç½²åœ¨è™šæ‹Ÿå®¹å™¨ä¸­ï¼ˆæ¯”å¦‚ï¼Œlxcï¼Œcgroupsï¼ŒDockerï¼‰ç­‰ï¼Œå®ƒå°†ä¸èƒ½ä½¿ç”¨æ•´ä¸ªç³»ç»Ÿçš„ç‰©ç†å†…å­˜ï¼Œåˆ™éœ€è¦é€‚å½“è°ƒæ•´æ­¤å€¼ã€‚é»˜è®¤å€¼ä¸ºç‰©ç†å†…å­˜çš„ä¸€åŠã€‚     cacheSizeGB: 1.5systemLog:  logAppend: truenet:  bindIp: 0.0.0.0# æ˜¯å¦å¼€å¯æˆæƒsecurity:  authorization: enabled</code></pre></li><li><p>åˆ›å»ºå¹¶è¿è¡Œmongo dockerå®¹å™¨ï¼Œè·¯å¾„æ˜ å°„éœ€è¦æ ¹æ®æœºå™¨æ›´æ”¹  </p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker run --name mongo \   --privileged \   -p 27017:27017 \   -v ~&#x2F;docker-app&#x2F;mongo&#x2F;data:&#x2F;data&#x2F;db \   -v ~&#x2F;docker-app&#x2F;mongo&#x2F;conf:&#x2F;data&#x2F;configdb \   -v ~&#x2F;docker-app&#x2F;mongo&#x2F;logs:&#x2F;data&#x2F;log&#x2F; \   -d  \   mongo  \   -f &#x2F;data&#x2F;configdb&#x2F;mongod.conf</code></pre><p>è§£é‡Š:</p><blockquote><p>â€“name mongo  #å®¹å™¨å<br>â€“privileged  #ç»™äºˆæƒé™<br>-p 27017:27017   #ç«¯å£æ˜ å°„<br>-v ~/docker-app/mongo/data:/data/db   #æ•°æ®æ–‡ä»¶å¤¹æ˜ å°„ï¼ˆä¸»æœº:å®¹å™¨ï¼‰<br>-v ~/docker-app/mongo/conf:/data/configdb   #é…ç½®æ–‡ä»¶è·¯å¾„æ˜ å°„<br>-v ~/docker-app/mongo/logs:/data/log/    #æ—¥å¿—æ–‡ä»¶å¤¹è·¯å¾„æ˜ å°„<br>-d   #åå°è¿è¡Œ<br>mongo   # æ‰€ä½¿ç”¨çš„é•œåƒ<br>-f /data/configdb/mongod.conf  #ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨(è·¯å¾„å¯¹åº”çš„å®¹å™¨è·¯å¾„ï¼Œéä¸»æœºè·¯å¾„)  </p></blockquote></li><li><p>é™„ä¸€ä¸ªbashè„šæœ¬(åœ¨mongoæ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œ)</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># åˆ›å»ºä¸€ä¸ªmongo dockerå®¹å™¨mkdir conftouch conf&#x2F;mongod.confconf_file&#x3D;&#39;conf&#x2F;mongod.conf&#39;cat&gt;$conf_file&lt;&lt;EOFstorage:  journal:    enabled: true  engine: wiredTiger  wiredTiger:  engineConfig:    cacheSizeGB: 1.5systemLog:  logAppend: truenet:  bindIp: 0.0.0.0security:  authorization: enabledEOFdocker pull mongobase_dir&#x3D;$PWDdocker run --name mongo \  --privileged \  -p 27017:27017 \  -v $base_dir&#x2F;data:&#x2F;data&#x2F;db \  -v $base_dir&#x2F;conf:&#x2F;data&#x2F;configdb \  -v $base_dir&#x2F;logs:&#x2F;data&#x2F;log&#x2F; \  -d  \  mongo  \  -f &#x2F;data&#x2F;configdb&#x2F;mongod.conf</code></pre></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>åç«¯å¼€å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³äºä¸€æ¬¡Kafkaé‡å¤æ¶ˆè´¹é—®é¢˜æ’æŸ¥è®°å½•çš„é—²è°ˆ</title>
    <link href="/2020/12/15/%E5%85%B3%E4%BA%8E%E4%B8%80%E6%AC%A1Kafka%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E8%AE%B0%E5%BD%95%E7%9A%84%E9%97%B2%E8%B0%88/"/>
    <url>/2020/12/15/%E5%85%B3%E4%BA%8E%E4%B8%80%E6%AC%A1Kafka%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E8%AE%B0%E5%BD%95%E7%9A%84%E9%97%B2%E8%B0%88/</url>
    
    <content type="html"><![CDATA[<p>&emsp;&emsp;å‰æ®µæ—¶é—´ä¸Šçº¿ä¸€ä¸ªæ–°æœåŠ¡ï¼Œæˆ‘ä»¬çš„è¿è¥åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œå¯¼å…¥äº†ä¸€æ‰¹æ•°æ®ï¼Œç»“æœç›®æ ‡è¡¨é‡Œçš„æ•°æ®æ˜¯é¢„æœŸæ•°é‡çš„2å€ï¼Œæœ‰å¤§é‡çš„é‡å¤æ•°æ®ï¼Œä¸€å¼€å§‹æˆ‘è®¤ä¸ºå¯èƒ½æ˜¯æˆ‘æ²¡æœ‰è¿‡æ»¤æ•°æ®ç±»å‹å¯¼è‡´çš„ï¼Œæˆ‘æ‰€æ¶ˆè´¹çš„æ•°æ®æ˜¯é€šè¿‡ç›‘å¬æ•°æ®åº“çš„binlogè§£æåæ¨é€åˆ°Kafkaçš„æ•°æ®ï¼Œæˆ‘æ”¶åˆ°kafkaæ¶ˆæ¯ç»è¿‡ååºåˆ—åŒ–å¾—åˆ°å¤šæ¡æ•°æ®åº“è¡¨çš„å˜åŠ¨è®°å½•ï¼Œæ¯ä¸€æ¡è®°å½•éƒ½æœ‰ä¸€ä¸ªç±»å‹ï¼š<code>INSERT</code>ï¼Œ<code>UPDATE</code>ï¼Œ<code>DELETE</code>ï¼Œå…¶å®ä¹Ÿå°±æ˜¯å¯¹åº”SQLçš„ç±»å‹ï¼Œæˆ‘ä¸€å¼€å§‹å¹¶æ²¡æœ‰åˆ¤æ–­è¿™ä¸ªç±»å‹ï¼Œè€Œæ˜¯æ”¶åˆ°çš„æ‰€æœ‰æ•°æ®éƒ½è¿›è¡Œåç»­çš„å¤„ç†ï¼Œè¿è¥ä¹Ÿè¯´å¯èƒ½æ˜¯æœ‰<code>UPDATE</code>æ“ä½œçš„ï¼Œäºæ˜¯æˆ‘åŠ äº†è¿‡æ»¤ï¼Œåªå¤„ç†<code>INSERT</code>ç±»å‹æ•°æ®ï¼Œæ”¹å¥½ä¹‹åæƒ³ç€è‚¯å®šæ²¡é—®é¢˜äº†ï¼Œäºæ˜¯è®©è¿è¥å†åˆ æ‰åŸæœ‰æ•°æ®é‡æ–°å¯¼å…¥ä¸€éï¼Œç¬¬äºŒå¤©å†çœ‹ç»“æœã€‚   </p><p>&emsp;&emsp;ç„¶è€Œç¬¬äºŒå¤©ï¼Œé—®é¢˜ä¾æ—§â€¦â€¦è¿™ä¸‹å¯éš¾åˆ°æˆ‘äº†ï¼Œæƒ³äº†ä¸€ä¼šçŒœæµ‹ä¼šä¸ä¼šæ˜¯å‰é¢çš„ç¯èŠ‚æ¨é€çš„æ•°æ®å°±æ˜¯é‡å¤çš„å‘¢ï¼Ÿä½†æ˜¯ä¹Ÿä¸èƒ½ççŒœï¼Œäºæ˜¯æˆ‘åœ¨å¤„ç†ä¸€æ¡æ•°æ®ä¹‹å‰æ‰“å°ä¸Šoffsetï¼Œå‘ç‰ˆåå¼€å§‹è§‚å¯Ÿæ—¥å¿—ï¼Œä¸ä¸€ä¼šå„¿åº“é‡Œå‡ºç°äº†é‡å¤æ•°æ®äº†ï¼Œæˆ‘æ‹¿åˆ°é‡å¤çš„è®¢å•å·ä¹‹åå»æ—¥å¿—ä¸­æœç´¢ï¼Œç»“æœï¼Œä¸¤æ¡æ•°æ®çš„offsetæ˜¯ä¸€æ ·çš„ï¼Ÿ</p><p><img src="https://oscimg.oschina.net/oscnet/up-a4d97566c877c3ad14dc1ae79d947b9c48e.png" alt="img"></p><p>&emsp;&emsp;çœ‹æ¥è¿™çœŸæ˜¯æˆ‘æ¶ˆè´¹çš„é—®é¢˜äº†ï¼Œä½†æ˜¯ä¹‹å‰ç±»ä¼¼çš„é¡¹ç›®ä¹Ÿæ˜¯åŒæ ·çš„æ¶ˆè´¹æ–¹å¼ï¼Œä»æ¥æ²¡å‡ºç°è¿‡é‡å¤æ¶ˆè´¹å‘€ï¼Œè¿™å°±è®©æˆ‘éå¸¸çº³é—·ï¼Œäºæ˜¯æ‰¾äº†å‡ æ¡é‡å¤æ•°æ®ï¼Œè§‚å¯Ÿäº†ä¸€ä¸‹æ’å…¥æ—¶é—´ï¼Œå‘ç°æ—¶é—´é—´éš”è¿˜æŒºæœ‰è§„å¾‹ï¼ŒåŸºæœ¬éƒ½æ˜¯äº”åˆ†é’Ÿå·¦å³é‡å¤æ’å…¥ä¸€æ¬¡ï¼Œåœ¨æ—¥å¿—ä¸Šå‘ç°é‡å¤æ¶ˆè´¹æ˜¯ä¸¤å°æœºå™¨äº¤æ›¿è¿›è¡Œçš„ï¼Œæˆ‘æ‰€æ¶ˆè´¹çš„Topicæ˜¯åªæœ‰ä¸€ä¸ªåˆ†åŒºçš„ï¼Œæ‰€ä»¥åªä¼šæœ‰ä¸€å°æœºå™¨æ¶ˆè´¹ï¼Œä»æ—¥å¿—ä¸Šçœ‹å‡ºæ¥ä¸¤å°æœºå™¨åœ¨äº¤æ›¿æ¶ˆè´¹ï¼Œå› è€Œäº§ç”Ÿäº†é‡å¤æ¶ˆè´¹ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Œäºæ˜¯å†æœäº†ä¸‹<em>Exception</em>å…³é”®è¯ï¼Œå‘ç°äº†ä¸€ä¸ª<code>CommitFailedException</code>ï¼š</p><p><img src="https://oscimg.oschina.net/oscnet/up-4a5809d58553eb75c4d899315e717ef0e9c.png" alt="img"></p><p>&emsp;&emsp;å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ˜¯å½“å‰æ¶ˆè´¹ç«¯è¢«è¸¢å‡ºäº†æ¶ˆè´¹ç»„ï¼Œéšåoffsetæäº¤å¤±è´¥ï¼Œç„¶åæ¢äº†ä¸€å°æœºå™¨é‡æ–°æ¶ˆè´¹è¿™ä¸ªoffsetï¼Œå¯¼è‡´äº†é‡å¤æ¶ˆè´¹ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¢«è¢«å‰”é™¤å‡ºæ¶ˆè´¹ç»„æˆ‘ä»ç„¶æ— æ³•è§£é‡Šï¼Œå› ä¸ºæ—¥å¿—ä¸Šå†ä¹Ÿæ²¡å…¶ä»–é”™è¯¯ä¿¡æ¯äº†ï¼Œå¥½åœ¨åæ¥åˆè®©æˆ‘å‘ç°äº†ç‚¹è››ä¸é©¬è¿¹ï¼Œé‚£ä¼šåˆšå¥½ä½¿ç”¨äº†<code>tail -f</code>å‘½ä»¤ï¼Œä¸ç»æ„é—´å‘ç°è¿‡äº†å¥½ä¹…ï¼Œæ¥æ”¶åˆ°çš„æ•°æ®offsetéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸€æ¡kafkaæ¶ˆæ¯è§£å‹åæœ‰è¿™ä¹ˆå¤šï¼Ÿ(åæ¥åœ¨æœ¬åœ°è¯•äº†ä¸‹ï¼Œæœç„¶ä¸€æ¡Kafkaæ¶ˆæ¯ï¼Œååºåˆ—åŒ–åéƒ½æœ‰3000åˆ°9000æ¡ä¸ç­‰ï¼Œè¿™ä¹Ÿå¤ªå¤šäº†å§ã€‚ã€‚)ç»è¿‡ä¸€ç•ªGoogleä¹‹åæ³¨æ„åˆ°äº†Kafkaçš„ä¸¤ä¸ªé…ç½®é¡¹ï¼š<code>max.poll.interval.ms</code>å’Œ<code>max.poll.records</code>åˆ†åˆ«ä»£è¡¨æ‹‰å–æ¶ˆæ¯çš„é—´éš”æ—¶é—´å’Œæ‹‰å–çš„æœ€å¤§æ¡æ•°ï¼Œæˆ‘çš„é…ç½®æ˜¯ï¼š</p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties">max.poll.interval.ms &#x3D; 600000 # é»˜è®¤5åˆ†é’Ÿmax.poll.records &#x3D; 20         # è¿™ä¸ªæ˜¯æˆ‘æœ€å¼€å§‹å†™çš„20æ¡</code></pre><p>&emsp;&emsp;ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€å¿«è¦5åˆ†é’Ÿå†…å¤„ç†å®Œ20ä¸ªoffsetï¼Œå¦åˆ™å°†è®¤ä¸ºå®¢æˆ·ç«¯ä¸åœ¨æ¶ˆè´¹äº†ï¼Œä¹Ÿå°±äº§ç”Ÿäº†ä¸Šé¢çš„å¼‚å¸¸ï¼Œè¢«è¸¢å‡ºæ¶ˆè´¹ç»„ï¼Œè€Œååˆcommitå¤±è´¥ã€‚ä»æ‰“å°çš„æ—¥å¿—æ¥çœ‹ï¼Œè¿™ä¸ªæ—¶é—´æ˜æ˜¾ä¸å¤Ÿï¼Œå¤„ç†ä¸€ä¸ªoffsetçš„æ¶ˆæ¯éƒ½è¦å¾ˆä¹…ï¼Œæ›´åˆ«è¯´æœ€å¤§20ä¸ªäº†ã€‚çŸ¥é“åŸå› åï¼Œæˆ‘æ”¹äº†å‚æ•°:</p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties">max.poll.interval.ms &#x3D; 1200000max.poll.records &#x3D; 1</code></pre><p>&emsp;&emsp;ä¹Ÿå°±æ˜¯ä¸€æ¡ååˆ†é’Ÿçš„ä¸€ä¸ªçš„ä¸‹é™é€Ÿåº¦ï¼Œä½†æ˜¯åæ¥è¯æ˜ï¼Œè¿™ä¸ªæ—¶é—´ä¾æ—§è¿œè¿œä¸å¤Ÿ(æœ€åè¿™ä¸ªæ—¶é—´å·²ç»æ”¹ä¸ºäº†1ä¸ªå°æ—¶â€¦)ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´çš„è§‚å¯Ÿï¼Œä¸€æ¡Kafkaæ¶ˆæ¯ååºåˆ—åŒ–æœ€å¤šä¼šæœ‰10000æ¡æ•°æ®ï¼Œå¤„ç†æ—¶é—´æœ€é•¿å¤§çº¦40å¤šåˆ†é’Ÿï¼Œæˆ‘æœ€å¼€å§‹ç¡®å®æ²¡æœ‰æƒ³åˆ°è¿™ä¸ªTopicä¸­çš„ä¸€æ¡æ¶ˆæ¯åŒ…å«çš„æ•°æ®ä¼šè¿™ä¹ˆå¤šï¼Œå¯¼è‡´äº†è¿™ä¸€ç³»åˆ—çš„é—®é¢˜ï¼Œæ—¶é—´æ”¹ä¸º1å°æ—¶åè¿ç»­ä¸¤å¤©å†æ²¡å‡ºç°è¿‡é‡å¤æ¶ˆè´¹offsetçš„é—®é¢˜ã€‚</p><p>&emsp;&emsp;ä½†æ˜¯ä½†æ˜¯ï¼Œè¿™ä¸ªç¨‹åºçš„å¤„ç†é€Ÿåº¦æ…¢ï¼Œä¹Ÿæ˜¯å¯¼è‡´æ­¤é—®é¢˜çš„ä¸€ä¸ªåŸå› ï¼Œå½“ç„¶åæ¥å‘ç°ä»£ç ä¸­ï¼Œå¤„ç†ä¸€æ¡æ•°æ®ï¼Œå¹³å‡æŸ¥è¯¢ä¸æ’å…¥æ•°æ®åº“çš„æ¬¡æ•°æœ‰äº”å…­åæ¬¡ï¼è¿™å½“ç„¶å¿«ä¸èµ·æ¥å•Šï¼Œäºæ˜¯æˆ‘åœ¨å¤§éƒ¨åˆ†çš„SQLæŸ¥è¯¢éƒ¨åˆ†ä½¿ç”¨<code>WeakHashMap</code>è¿›è¡Œäº†æ•°æ®ç¼“å­˜ï¼Œå› ä¸ºè¿™éƒ¨åˆ†æŸ¥è¯¢çš„æ•°æ®åŸºæœ¬æ˜¯ä¸ä¼šæœ‰å˜åŠ¨çš„ï¼Œæå¤§çš„å‡å°‘äº†æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°ï¼Œå¤„ç†é€Ÿåº¦æå‡äº†å°†è¿‘10å€ï¼å†åæ¥ï¼Œç”±äºè¿™ä¸ªTopicåªæœ‰ä¸€ä¸ªpartitionï¼Œå®Œå…¨æ²¡åŠæ³•ç”¨åˆ°å¤šå°æœºå™¨çš„æ€§èƒ½ï¼Œè€Œä¸”æ®è¿ç»´åé¦ˆï¼Œè¿™ä¸ªTiDB binlogç›‘å¬çš„ä¸­é—´ä»¶åªæ”¯æŒä¸€ä¸ªåˆ†åŒºå‘é€ï¼Œ äºæ˜¯æˆ‘è‡ªå·±åœ¨ç¨‹åºä¸­å¢åŠ äº†ä¸€é“è½¬å‘ï¼Œå³æ¶ˆè´¹åˆ°Kafkaæ¶ˆæ¯ååºåˆ—åŒ–ä¹‹åï¼Œå°†ååºåˆ—åŒ–ä¹‹åçš„æ•°æ®å…ˆä¸åšå¤„ç†ï¼Œç›´æ¥ä¸€æ¡ä¸€æ¡è½¬å‘è‡³RocketMQï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯éå¸¸å¿«çš„ï¼ŒrocketMQå†å‘é€è‡³å„ä¸ªæœºå™¨ä¸Š(ä¹Ÿå¯æ–°å»ºä¸€ä¸ªå¤špartitionçš„Kafka Topicç”¨äºè½¬å‘)ï¼Œè¿™æ ·å°±èƒ½å……åˆ†åˆ©ç”¨é›†ç¾¤çš„ä¼˜åŠ¿ï¼Œè¿›ä¸€æ­¥æå¤§åœ°æé«˜å¤„ç†é€Ÿåº¦ï¼Œè¿™ä¸€å—è¯´è¿™ä¹ˆå¤šå…¶å®åé¢˜äº†ï¼Œå±äºåç»­çš„ä¸€ä¸ªä¼˜åŒ–ã€‚</p><p>&emsp;&emsp;åæ¥å‘ç°ï¼Œå…¶å®æ¯ä¸€æ¬¡åœ¨æ¶ˆè´¹ç«¯å³å°†ç¦»å¼€ä¹‹å‰ï¼Œéƒ½ä¼šæœ‰ä¸€æ¡æ—¥å¿—ï¼š</p><p><img src="https://oscimg.oschina.net/oscnet/up-9bd6fbd5b2048752b177b7de8a7211c6c6d.png" alt="img"></p><p>&emsp;&emsp;æç¤ºå‘æœåŠ¡ç«¯å‘é€äº†ç¦»å¼€æ¶ˆè´¹ç»„çš„è¯·æ±‚ï¼Œå› ä¸ºå®¢æˆ·ç«¯pollæ“ä½œå·²è¶…æ—¶ï¼Œå¹¶å»ºè®®å¢å¤§æœ€å¤§æ‹‰å–é—´éš”æ—¶é—´æˆ–è€…å‡å°æœ€å¤§æ‹‰å–æ•°é‡(è¿™ä¸ªä¸è¡Œï¼Œæˆ‘éƒ½æ”¹åˆ°1äº† T_T )ã€‚  </p><p>&emsp;&emsp;ç„¶ååœ¨å¤„ç†å®Œä¸€ä¸ªoffsetæäº¤çš„æ—¶å€™ä¼šæç¤ºè¯·æ±‚å¤±è´¥ï¼Œå½“å‰æ¶ˆè´¹è€…ä¸å†æ˜¯æ­¤æ¶ˆè´¹ç»„çš„ä¸€éƒ¨åˆ†ã€‚</p><p><img src="https://oscimg.oschina.net/oscnet/up-ded106931e5c1de8ecefc6f11fca2dbf796.png" alt="img"></p><p>&emsp;&emsp;ä½†æ˜¯æ—¥å¿—çº§åˆ«æ˜¯INFOï¼Œç¡®å®ä¸å¤ªå®¹æ˜“å‘ç°ï¼Œè‡³æ­¤é—®é¢˜å·²å®Œå…¨è§£å†³ï¼ŒåŸå› ä¹Ÿå®Œå…¨æ¸…æ¥šäº†ã€‚</p><p>&emsp;&emsp;æ€»çš„æ¥è¯´æ­¤æ¬¡é‡åˆ°çš„Kafkaé‡å¤æ¶ˆè´¹çš„åŸå› ï¼Œç¬¬ä¸€æ˜¯Kafkaçš„æ¶ˆæ¯å¤ªå¤§ï¼ˆåæ¥è§£æåˆ°æœ€å¤§æœ‰åŒ…å«25ä¸‡æ¡æ•°æ®çš„ä¸€æ¡æ¶ˆæ¯ã€‚ã€‚ã€‚è¿™éƒ½æ˜¯ä½¿ç”¨protobufåºåˆ—åŒ–çš„æ¶ˆæ¯ï¼‰ï¼Œä½†æ˜¯è¿™éƒ¨åˆ†æˆ‘ä»¬æ— æ³•å˜åŠ¨ï¼Œç¬¬äºŒæ˜¯ä¸€å¼€å§‹å¤„ç†é€Ÿåº¦ä¹Ÿæ¯”è¾ƒæ…¢ï¼Œé»˜è®¤é—´éš”æ—¶é—´å®Œå…¨ä¸å¤Ÿï¼Œç»¼åˆå¯¼è‡´é¢‘ç¹é‡æ–°æ¶ˆè´¹ã€‚</p><p>&emsp;&emsp;ç»è¿‡æ­¤æ¬¡é—®é¢˜å¯¹Kafkaå‚æ•°æœ‰äº†æ›´æ·±çš„ä¸€äº›è®¤è¯†ï¼Œé™¤ä¸Šé¢ä¸¤ä¸ªç”¨åˆ°çš„åŒæ—¶ä¹Ÿæ˜¯æ¯”è¾ƒé‡è¦å‚æ•°ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ã€ä¼šè¯è¶…æ—¶æ—¶é—´ã€å¿ƒè·³æ£€æµ‹äº‹ä»¶ã€æ‹‰å–æ¶ˆæ¯çš„è¶…æ—¶æ—¶é—´ç­‰ï¼Œåœ¨æœ¬åœ°DebugæœŸé—´è¿˜é‡åˆ°è¿‡ä¸€ä¸ªæ€»æ˜¯æ‹‰å–ä¸åˆ°æ¶ˆæ¯ç„¶åæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸çš„é—®é¢˜ï¼Œç„¶åæŸ¥åˆ°åŸå› æ˜¯æ‹‰å–Kafkaæ¶ˆæ¯è¶…æ—¶äº†ï¼Œä¸€æ¡æ¶ˆæ¯å¯èƒ½æœ‰åå‡ å…†ï¼Œé‚£ä¼šåˆšå¥½æˆ‘ç”µè„‘çš„ç½‘é€Ÿéå¸¸æ…¢ï¼Œå°±è¶…æ—¶äº†ï¼Œåæ¥åŠ å¤§äº†<code>fetch.max.wait.ms</code>å’Œ<code>request.timeout.ms</code>å°±æ²¡é—®é¢˜äº†ã€‚å¾ˆæœ‰æ„ä¹‰çš„ä¸€æ¬¡Kafkaé—®é¢˜æ’æŸ¥ç»å†</p><h3 id="é™„ä¸€ä¸ªï¼šKafka-Consumeré…ç½®å®˜æ–¹æ–‡æ¡£"><a href="#é™„ä¸€ä¸ªï¼šKafka-Consumeré…ç½®å®˜æ–¹æ–‡æ¡£" class="headerlink" title="é™„ä¸€ä¸ªï¼šKafka Consumeré…ç½®å®˜æ–¹æ–‡æ¡£"></a>é™„ä¸€ä¸ªï¼š<a href="http://kafka.apache.org/090/documentation.html#consumerconfigs">Kafka Consumeré…ç½®å®˜æ–¹æ–‡æ¡£</a></h3>]]></content>
    
    
    
    <tags>
      
      <tag>kafka</tag>
      
      <tag>åç«¯å¼€å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŠ¨æ€åˆ›å»ºä¸ä¿®æ”¹å®šæ—¶ä»»åŠ¡</title>
    <link href="/2020/12/15/%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BA%E4%B8%8E%E4%BF%AE%E6%94%B9%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"/>
    <url>/2020/12/15/%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BA%E4%B8%8E%E4%BF%AE%E6%94%B9%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<h3 id="emsp-emsp-æœ€è¿‘é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦èƒ½å¤ŸæŒ‰ç…§ç‰¹å®šçš„é…ç½®æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼Œè€Œä¸”å®šæ—¶ä»»åŠ¡éœ€è¦åœ¨åº”ç”¨ä¸é‡å¯çš„æƒ…å†µä¸‹åŠ¨æ€å¢åˆ æ”¹ï¼ŒSpringæä¾›çš„-Scheduledæ³¨è§£æ˜¯ç¡¬ç¼–ç å½¢å¼ï¼Œåªèƒ½å®ç°å›ºå®šçš„å®šæ—¶ä»»åŠ¡ï¼Œéšåç»è¿‡ä¸€ç•ªæ¢ç©¶ï¼Œä¾æ‰˜æ³¨æ˜çš„quartzæ¡†æ¶ç»ˆäºå®ç°äº†è¯¥åŠŸèƒ½ï¼Œä¸‹é¢æ¥åˆ†äº«ä¸€ä¸‹æˆ‘çš„æ–¹æ¡ˆã€‚"><a href="#emsp-emsp-æœ€è¿‘é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦èƒ½å¤ŸæŒ‰ç…§ç‰¹å®šçš„é…ç½®æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼Œè€Œä¸”å®šæ—¶ä»»åŠ¡éœ€è¦åœ¨åº”ç”¨ä¸é‡å¯çš„æƒ…å†µä¸‹åŠ¨æ€å¢åˆ æ”¹ï¼ŒSpringæä¾›çš„-Scheduledæ³¨è§£æ˜¯ç¡¬ç¼–ç å½¢å¼ï¼Œåªèƒ½å®ç°å›ºå®šçš„å®šæ—¶ä»»åŠ¡ï¼Œéšåç»è¿‡ä¸€ç•ªæ¢ç©¶ï¼Œä¾æ‰˜æ³¨æ˜çš„quartzæ¡†æ¶ç»ˆäºå®ç°äº†è¯¥åŠŸèƒ½ï¼Œä¸‹é¢æ¥åˆ†äº«ä¸€ä¸‹æˆ‘çš„æ–¹æ¡ˆã€‚" class="headerlink" title="&emsp;&emsp;æœ€è¿‘é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦èƒ½å¤ŸæŒ‰ç…§ç‰¹å®šçš„é…ç½®æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼Œè€Œä¸”å®šæ—¶ä»»åŠ¡éœ€è¦åœ¨åº”ç”¨ä¸é‡å¯çš„æƒ…å†µä¸‹åŠ¨æ€å¢åˆ æ”¹ï¼ŒSpringæä¾›çš„@Scheduledæ³¨è§£æ˜¯ç¡¬ç¼–ç å½¢å¼ï¼Œåªèƒ½å®ç°å›ºå®šçš„å®šæ—¶ä»»åŠ¡ï¼Œéšåç»è¿‡ä¸€ç•ªæ¢ç©¶ï¼Œä¾æ‰˜æ³¨æ˜çš„quartzæ¡†æ¶ç»ˆäºå®ç°äº†è¯¥åŠŸèƒ½ï¼Œä¸‹é¢æ¥åˆ†äº«ä¸€ä¸‹æˆ‘çš„æ–¹æ¡ˆã€‚"></a>&emsp;&emsp;æœ€è¿‘é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦èƒ½å¤ŸæŒ‰ç…§ç‰¹å®šçš„é…ç½®æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼Œè€Œä¸”å®šæ—¶ä»»åŠ¡éœ€è¦åœ¨åº”ç”¨ä¸é‡å¯çš„æƒ…å†µä¸‹åŠ¨æ€å¢åˆ æ”¹ï¼ŒSpringæä¾›çš„<code>@Scheduled</code>æ³¨è§£æ˜¯ç¡¬ç¼–ç å½¢å¼ï¼Œåªèƒ½å®ç°å›ºå®šçš„å®šæ—¶ä»»åŠ¡ï¼Œéšåç»è¿‡ä¸€ç•ªæ¢ç©¶ï¼Œä¾æ‰˜æ³¨æ˜çš„quartzæ¡†æ¶ç»ˆäºå®ç°äº†è¯¥åŠŸèƒ½ï¼Œä¸‹é¢æ¥åˆ†äº«ä¸€ä¸‹æˆ‘çš„æ–¹æ¡ˆã€‚</h3><ul><li><p>é¦–å…ˆå¼•å…¥quartz mavenä¾èµ–ï¼š</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">&lt;dependency&gt;    &lt;groupId&gt;org.quartz-scheduler&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;quartz&lt;&#x2F;artifactId&gt;    &lt;!-- ç”±äºæˆ‘çš„é¡¹ç›®ç»§æ‰¿äº†spring-boot-starter-parentï¼Œå› æ­¤è¿™é‡Œå¯ä»¥ä¸ç”¨å†™ç‰ˆæœ¬å·ï¼Œä¼šç›´æ¥ä½¿ç”¨çˆ¶pomæ–‡æ¡£ä¸­dependencyManagementçš„quartzç‰ˆæœ¬å· --&gt;    &lt;!-- &lt;version&gt;2.3.2&lt;&#x2F;version&gt; --&gt;&lt;&#x2F;dependency&gt;</code></pre></li><li><p>æˆ‘çš„å®šæ—¶ä»»åŠ¡é…ç½®æ˜¯å­˜å‚¨åœ¨MySQLæ•°æ®åº“å½“ä¸­çš„ï¼Œå½“ç¨‹åºå¯åŠ¨æ—¶ï¼Œåˆå§‹åŒ–è¿‡ç¨‹ä¼šçš„<code>init()</code>æ–¹æ³•ä¼šè¯»å–ä¸€éæ‰€æœ‰æœ‰æ•ˆçš„å®šæ—¶ä»»åŠ¡é…ç½®ï¼Œç„¶åå°†å…¶å®ä¾‹åŒ–ä¸ºä¸€ä¸ªä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªå¯¹è±¡ä¾¿ä»£è¡¨äº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæˆ‘å®šä¹‰çš„ç±»ä¸º <code>public class ScheduledClauseTriggerEngine implements ClauseTriggerEngine&lt;Void&gt;, Job, AutoCloseable</code>ï¼Œå…¶ä¸­<code>ClauseTriggerEngine</code>ä¸ºæˆ‘è‡ªå®šä¹‰çš„æ¥å£ï¼Œå› ä¸ºåœ¨é¡¹ç›®ä¸­é™¤å®šæ—¶è§¦å‘å¤–è¿˜æœ‰å…¶ä»–çš„ä»»åŠ¡è§¦å‘æ–¹å¼ï¼Œä¸å†è¿‡å¤šèµ˜è¿°ï¼Œ<code>Job</code>(<code>org.quartz.Job</code>)æ˜¯quartzæ¡†æ¶çš„ä¸€ä¸ªæ¥å£ï¼Œä»£è¡¨ä¸€ä¸ªä»»åŠ¡ï¼Œåœ¨ä»»åŠ¡è°ƒåº¦æ—¶ï¼Œ<code>Job</code>çš„<code>execute(JobExecutionContext context)</code>æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œç”¨ä»¥æ‰§è¡Œä»»åŠ¡å†…å®¹ã€‚æ‰€æœ‰å®ä¾‹åŒ–åçš„<code>ScheduledClauseTriggerEngine</code>å¯¹è±¡ä¼šè¢«å­˜åœ¨ä¸€ä¸ª<code>Map&lt;Integer, ScheduledClauseTriggerEngine&gt;</code>å®¹å™¨ä¸­å»ï¼ŒKeyä¸ºå®šæ—¶ä»»åŠ¡çš„idï¼Œåç»­åœ¨å®šæ—¶ä»»åŠ¡å¢åˆ æ”¹çš„æ—¶å€™ï¼Œä¹Ÿä¼šåŒæ­¥ä¿®æ”¹è¿™ä¸ªMapçš„å†…å®¹ã€‚</p></li><li><p>åˆ›å»º<code>SchedulerFactoryBean</code>(<code>org.springframework.scheduling.quartz.SchedulerFactoryBean</code>)ï¼Œå¹¶è®¾ç½®JobFactoryï¼Œç”±äºæˆ‘è¿™é‡Œåªä½¿ç”¨åˆ°SchedulerFactoryBeanä¸€æ¬¡ï¼Œå› æ­¤è¿™ä¸€å°æ®µä»£ç å†™åœ¨æ„é€ æ–¹æ³•ä¸­çš„ï¼Œè‹¥æ˜¯å…¨å±€ä½¿ç”¨ï¼Œéœ€è¦åœ¨Springçš„Configurationç±»ä¸­ä¸“é—¨å®šä¹‰ä¸€ä¸ªSchedulerFactoryBeanç±»å‹çš„Bean(æ¯”è¾ƒè§„èŒƒçš„ç”¨æ³•)ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">SchedulerFactoryBean schedulerFactoryBean &#x3D; new SchedulerFactoryBean();        schedulerFactoryBean.setJobFactory((bundle, scheduler) -&gt;                triggers.get(Integer.parseInt(bundle.getJobDetail().getKey().getName())));        schedulerFactoryBean.afterPropertiesSet();        this.scheduler &#x3D; schedulerFactoryBean.getScheduler();        this.scheduler.start();</code></pre><p><code>setJobFactory</code>è¿™ä¸€æ­¥æ¯”è¾ƒé‡è¦ï¼Œé»˜è®¤çš„è°ƒåº¦æ–¹æ¡ˆæ˜¯é€šè¿‡åå°„å®ç°çš„ï¼Œå³ä¼ å…¥ä¸€ä¸ªJobç±»å‹çš„classï¼Œç„¶ååå°„å®ä¾‹åŒ–ä¸€ä¸ªæ­¤ç±»çš„å¯¹è±¡ï¼Œå†å»è°ƒç”¨executeæ–¹æ³•ï¼Œé€šè¿‡<code>JobExecutionContext</code>ä¼ å‚ï¼Œè€Œæˆ‘çš„æ–¹æ¡ˆæ˜¯æ‰€æœ‰ä»»åŠ¡ç±»éƒ½å·²å®ä¾‹åŒ–å®Œæˆï¼Œæˆ‘å¸Œæœ›åœ¨è§¦å‘æ—¶ç›´æ¥è¿”å›å¯¹åº”çš„å¯¹è±¡å®ä¾‹å»æ‰§è¡Œå³å¯ï¼Œå› æ­¤éœ€è¦å»ä¿®æ”¹JobFactoryï¼Œ<code>triggers</code>æ˜¯ä¸Šä¸€æ­¥ä¸­æ‰€è¯´çš„å­˜å‚¨å®šæ—¶ä»»åŠ¡çš„Mapï¼Œè€Œ<code>bundle.getJobDetail().getKey().getName()</code>å…¶å®å°±æ˜¯è·å–åˆ°äº†ä»»åŠ¡çš„keyï¼Œåœ¨æˆ‘è¿™é‡Œå…¶å®ä¹Ÿå°±æ˜¯å®šæ—¶ä»»åŠ¡idï¼Œè¿™ä¸ªä¸åé¢æ­¥éª¤çš„ä»£ç ç›¸å¯¹åº”ï¼Œä¹Ÿå°±æ˜¯æ­¤æ—¶å®šæ—¶ä»»åŠ¡è§¦å‘æ—¶ï¼Œä¼šæ‹¿åˆ°æˆ‘æå‰å‡†å¤‡å¥½çš„Mapä¸­çš„å¯¹åº”ä»»åŠ¡å®ä¾‹å»æ‰§è¡Œï¼Œè¦†ç›–é»˜è®¤è¡Œä¸ºã€‚</p></li><li><p>å®ä¾‹åŒ–ScheduledClauseTriggerEngineå¹¶åˆ›å»ºå®šæ—¶ä»»åŠ¡ï¼Œä¸‹é¢ä¸ºæ¯”è¾ƒé‡è¦çš„å‡ è¡Œä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">&#x2F;&#x2F; æ­¤éƒ¨åˆ†ä»£ç ä¸ºå®ä¾‹åŒ–å¹¶åˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡çš„ä»£ç ï¼Œæˆ‘å°†å…¶å°è£…ä¸ºäº†ä¸€ä¸ªæ–¹æ³•ï¼Œæ–¹ä¾¿è°ƒç”¨ï¼Œåœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­æŸ¥è¯¢æ‰€æœ‰å®šæ—¶ä»»åŠ¡å¾ªç¯è°ƒç”¨å³å¯&#x2F;&#x2F; ... å¿½ç•¥æ•°æ®åº“æŸ¥è¯¢åŠå‚æ•°æ ¡éªŒçš„è¿‡ç¨‹&#x2F;&#x2F; åˆ›å»ºJobDetailJobDetail jobDetail &#x3D; new JobDetailImpl()              .getJobBuilder()              &#x2F;&#x2F; ä»»åŠ¡çš„idä»¥åŠgroupï¼Œidä¸ºæ•°æ®åº“ä¸­çš„idï¼Œåœ¨ä¸Šä¸€æ­¥è®¾ç½®çš„JobFactoryï¼Œå½“æ”¹ä»»åŠ¡è¢«è°ƒåº¦æ—¶ï¼Œä¼šæ ¹æ®æ­¤idå»è·å–åˆ°è¦æ‰§è¡Œçš„ä»»åŠ¡              .withIdentity(clauseTriggerId.toString(), SCHEDULE_JOB_GROUP_NAME)              &#x2F;&#x2F; ä»»åŠ¡æè¿°ï¼Œå¯é€‰              .withDescription(clauseTrigger.getName())              &#x2F;&#x2F; è¿™é‡Œç›´æ¥ä¼ å…¥ScheduledClauseTriggerEngine.classå³å¯              .ofType(ScheduledClauseTriggerEngine.class)              .build();&#x2F;&#x2F; æ·»åŠ è§¦å‘å™¨å¹¶å¼€å§‹è°ƒåº¦ä»»åŠ¡scheduler.scheduleJob(jobDetail, TriggerBuilder.newTrigger()        &#x2F;&#x2F; è¦è°ƒåº¦çš„ä»»åŠ¡çš„key        .withIdentity(clauseTriggerId.toString())        &#x2F;&#x2F; è§¦å‘å‘¨æœŸï¼ŒtriggerConfigToCronExpressionæ˜¯å°†æ•°æ®åº“ä¸­çš„æ—¶é—´é…ç½®è½¬æ¢ä¸ºcornè¡¨è¾¾å¼çš„æ–¹æ³•        .withSchedule(CronScheduleBuilder.cronSchedule(triggerConfigToCronExpression(clauseTrigger.getTriggerConfig())))        .build());&#x2F;&#x2F; æ­¤æ—¶å…¶å®å®šæ—¶ä»»åŠ¡å·²ç»å¼€å§‹ç”Ÿæ•ˆ&#x2F;&#x2F; åç»­æ“ä½œ...triggerEngine.setTemplateList(scheduledTemplates);log.info(&quot;add one scheduled clause trigger: &#123;&#125;&quot;, clauseTrigger.getName());return triggerEngine;</code></pre></li><li><p>å®šæ—¶ä»»åŠ¡çš„å¢åˆ æ”¹ï¼š</p><ul><li><p>æ ¹æ®idæ–°å¢ä¸€ä¸ªä»»åŠ¡ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">public void addTrigger(int triggerId) &#123;  &#x2F;&#x2F; æ ¹æ®triggerIdå®ä¾‹åŒ–å’Œå¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå¹¶æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡çš„Mapä¸­å»ï¼ŒinstanceOneScheduledClauseTriggerEngineå°±æ˜¯ä¸Šä¸€æ­¥æ‰€å°è£…çš„æ–¹æ³•  ScheduledClauseTriggerEngine triggerEngine &#x3D; triggers.computeIfAbsent(triggerId, k -&gt; instanceOneScheduledClauseTriggerEngine(triggerId));&#125;</code></pre></li><li><p>æ ¹æ®idåˆ é™¤ä¸€ä¸ªä»»åŠ¡ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">public void removeTrigger(int clauseTriggerId) &#123;      try &#123;          &#x2F;&#x2F; ç”Ÿæˆè¦åˆ é™¤çš„jobKeyï¼Œæ³¨æ„æ­¤å¤„å¿…é¡»ä¼ å…¥åˆšæ‰æ‰€ä½¿ç”¨çš„çš„group nameï¼Œå¦åˆ™ä¼šä½¿ç”¨é»˜è®¤çš„ç»„åï¼Œä¾¿æ— æ³•æŸ¥è¯¢åˆ°æˆ‘ä»¬æƒ³è¦åˆ é™¤çš„ä»»åŠ¡          JobKey jobKey &#x3D; JobKey.jobKey(String.valueOf(clauseTriggerId), SCHEDULE_JOB_GROUP_NAME);          &#x2F;&#x2F; ç§»é™¤å®šæ—¶ä»»åŠ¡          scheduler.deleteJob(jobKey);          &#x2F;&#x2F; ä»Mapä¸­ç§»é™¤å¯¹åº”çš„å¯¹è±¡          triggers.remove(clauseTriggerId);          log.info(&quot;remove schedule trigger: &#123;&#125;&quot;, jobKey);      &#125; catch (SchedulerException e) &#123;          log.error(e.getMessage(), e);      &#125;&#125;</code></pre></li><li><p>æ ¹æ®idæ›´æ–°ä¸€ä¸ªä»»åŠ¡ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">public void updateTrigger(int triggerId) &#123;    &#x2F;&#x2F; ç”±äºæˆ‘é¡¹ç›®ä¸­çš„å®šæ—¶ä»»åŠ¡å¯èƒ½ä»»åŠ¡æ‰§è¡Œå†…å®¹ä¼šå˜ï¼Œå› æ­¤æˆ‘æ˜¯å°†å®šæ—¶ä»»åŠ¡åˆ é™¤å†é‡æ–°æ·»åŠ ï¼Œè‹¥å®šæ—¶ä»»åŠ¡åªä¼šæœ‰è§¦å‘æ—¶é—´çš„å˜åŒ–ï¼Œä¹Ÿå¯ä½¿ç”¨rescheduleJobæ–¹æ³•åªæ›´æ–°è§¦å‘æ—¶é—´    removeTrigger(triggerId);    addTrigger(triggerId);&#125;</code></pre></li></ul></li><li><p>é›†ç¾¤ç¯å¢ƒä¸‹éœ€è¦æ³¨æ„çš„åœ°æ–¹</p><ul><li><p>å¤šå°æœºå™¨æ—¶ï¼Œæˆ‘éœ€è¦åªæœ‰ä¸€å°æœºå™¨æ‰§è¡Œä»»åŠ¡ï¼Œè€Œå…¶ä»–æœºå™¨ä¸æ‰§è¡Œï¼Œåœ¨æ­¤å¤„æˆ‘ä½¿ç”¨äº†Redisä½œä¸ºé”ï¼Œè¿½æ±‚ç®€ä¾¿ï¼Œå½“ç„¶ä¹Ÿå¯ä½¿ç”¨zookeeperã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">@Overridepublic void execute(JobExecutionContext context) &#123;    String jobKey &#x3D; context.getJobDetail().getKey().toString();    String redisKey &#x3D; JOB_REDIS_PREFIX + jobKey;    &#x2F;&#x2F; åˆ¤æ–­æ˜¯å¦è·å–åˆ°é”    &#x2F;&#x2F;noinspection ConstantConditions    if(redisTemplate.opsForValue().increment(redisKey) !&#x3D; 1L)&#123;        log.info(&quot;job &#123;&#125; has in running&quot;, jobKey);        return;    &#125;    &#x2F;&#x2F; æ³¨æ„ä¸Šé¢çš„åˆ¤æ–­å¿…é¡»æ”¾åœ¨try-finallyå—ä¹‹å¤–ï¼Œå¦åˆ™ä¼šå¯¼è‡´ä¸€ä¸ªéšç§˜çš„BUG(æ— è®ºå½“å‰æœºå™¨æ˜¯å¦è·å–åˆ°é”ï¼Œéƒ½ä¼šæ‰§è¡Œfinallyä¸­çš„æ–¹æ³•ï¼Œé‡Šæ”¾æ‰é”ï¼Œäº§ç”Ÿé”™è¯¯)    &#x2F;&#x2F; ä¸ºé”åŠ ä¸Šé»˜è®¤è¿‡æœŸæ—¶é—´    redisTemplate.expire(redisKey, 3600, TimeUnit.SECONDS);    try &#123;        MDC.put(&quot;traceId&quot;, randomId());        log.info(&quot;execute schedule job: &#123;&#125;&quot;, jobKey);        long l &#x3D; System.currentTimeMillis();        trigger();        log.info(&quot;finish job: &#123;&#125;, used time: &#123;&#125;ms&quot;, jobKey, System.currentTimeMillis()-l);    &#125; catch (Exception ex)&#123;        log.error(ex.getMessage(), ex);    &#125;finally &#123;        MDC.clear();        &#x2F;&#x2F; é‡Šæ”¾é”        redisTemplate.delete(redisKey);    &#125;&#125;</code></pre><p>å…¶å®åœ¨ä¹‹å‰ï¼Œæˆ‘å†™äº†ä¸€ä¸ªæ³¨è§£ï¼š<code>@RedisLock</code>ï¼Œå¯ä»¥é€šè¿‡æ³¨è§£æ–¹å¼ç›´æ¥ä¸ºæŸä¸ªæ–¹æ³•åŠ åˆ†å¸ƒå¼é”ï¼Œä½†æ˜¯æ³¨è§£ä¸èƒ½ä¼ å…¥å˜é‡ï¼Œåªèƒ½ä¼ å…¥å¸¸é‡ï¼Œåœ¨è¿™ä¸ªé¡¹ç›®ï¼Œé”çš„keyæ˜¯åŠ¨æ€çš„ï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨ï¼Œä¾¿å…ˆé‡‡ç”¨ç›´æ¥å†™ä»£ç çš„å½¢å¼ï¼ŒåæœŸå¯ä»¥æ·»åŠ ä¸Šæ­¤åŠŸèƒ½ï¼Œé€šè¿‡æ³¨è§£ä¼ å…¥SpringELè¡¨è¾¾å¼è§£ææ–¹æ³•å…¥å‚ï¼Œå°±å¯ä»¥å®ç°åŠ¨æ€keyå€¼äº†ã€‚</p></li><li><p>å¤šå°æœºå™¨å®šæ—¶ä»»åŠ¡æ›´æ–°é—®é¢˜ï¼Œå½“å®šæ—¶ä»»åŠ¡é…ç½®æ›´æ”¹æ—¶ï¼Œæˆ‘éœ€è¦å“åº”çš„ä¿®æ”¹å®šæ—¶ä»»åŠ¡ï¼Œä½†æ˜¯å¤šå°æœºå™¨ï¼Œæˆ‘ä¸èƒ½ä¸€å°ä¸€å°æœºå™¨çš„æ‰‹åŠ¨å»è°ƒç”¨å¯¹åº”çš„æ–¹æ³•ï¼Œå› æ­¤æˆ‘æƒ³åˆ°äº†ä½¿ç”¨redisçš„å‘å¸ƒè®¢é˜…å»å®Œæˆï¼Œå› ä¸ºRedisçš„é»˜è®¤æ¶ˆæ¯æ¨¡å¼æ˜¯ç¾¤å‘æ¨¡å¼ï¼Œåˆšå¥½ç¬¦åˆæˆ‘çš„éœ€æ±‚ï¼Œè‹¥é¡¹ç›®ä¸­æœ‰MQï¼Œä¹Ÿå¯é…ç½®ä¸€ä¸ªç¾¤å‘çš„MQ Topicå»å®ç°ï¼Œç•¥å¾®å¤æ‚ä¸€äº›ã€‚<br>é™„æˆ‘æ‰€ä½¿ç”¨çš„ä»£ç ï¼Œä¾›å‚è€ƒï¼ŒåŸºäºspring-redisï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">@Bean  RedisMessageListenerContainer redisMessageListenerContainer(RedisConnectionFactory connectionFactory,                                                              ScheduledTriggerService scheduledTriggerService,                                                              DwdDataTriggerService dwdDataTriggerService,                                                              ClauseExecuteService clauseExecuteService) &#123;      RedisMessageListenerContainer container &#x3D; new RedisMessageListenerContainer();      container.setConnectionFactory(connectionFactory);      &#x2F;&#x2F;triggerå‘å¸ƒè®¢é˜…      container.addMessageListener((message, bytes) -&gt; &#123;          String body &#x3D; new String(message.getBody(), StandardCharsets.UTF_8);          if (body.startsWith(&quot;scheduled-trigger-change&quot;)) &#123;            Assert.isTrue(body.matches(&quot;^scheduled-trigger-change:((add)|(remove)|(update)):\\d+$&quot;),&quot;invalid scheduled-trigger-change message: &quot; + body);              String[] split &#x3D; body.split(&quot;:&quot;);              String type &#x3D; split[1];              int triggerId &#x3D; Integer.parseInt(split[2]);              switch (type) &#123;                  case &quot;add&quot;:                      scheduledTriggerService.addTrigger(triggerId);                      break;                  case &quot;remove&quot;:                      scheduledTriggerService.removeTrigger(triggerId);                      break;                  case &quot;update&quot;:                      scheduledTriggerService.updateTrigger(triggerId);                      break;                  default:                      scheduledTriggerService.refreshAllTriggerEngine();                      break;              &#125;          &#125; else &#123;              log.info(&quot;receive redis message, topic: &#123;&#125;, body, &#123;&#125;&quot;, new String(message.getChannel()), body);              dwdDataTriggerService.refreshClauseTrigger();          &#125;      &#125;, new ChannelTopic(&quot;trigger-config-change&quot;));      return container;  &#125;</code></pre><p>å‘é€æ¶ˆæ¯ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">redisTemplate.convertAndSend(&quot;trigger-config-change&quot;, &quot;scheduled-trigger-change:update:0&quot;);</code></pre><p>å½“å®šæ—¶é…ç½®å˜æ›´æ—¶ï¼Œå‘é€redisæ¶ˆæ¯å³å¯ã€‚</p><h3 id="æ€»ç»“-æœ¬ç¯‡æ–‡ç« åŸºäºæˆ‘çš„å®é™…é¡¹ç›®ï¼Œè®²è§£äº†å€ŸåŠ©äºquartzæ¡†æ¶çš„å®šæ—¶ä»»åŠ¡åŠ¨æ€å¢åˆ æ”¹çš„æ–¹æ¡ˆï¼Œä½†æ˜¯å› é¡¹ç›®è€Œå¼‚ï¼Œæˆ‘ä¹Ÿåšäº†è®¸å¤šå®šåˆ¶åŒ–çš„æ“ä½œï¼Œæˆ‘çš„æ€è·¯å°±æ˜¯ä¸€é¡¹å®šæ—¶ä»»åŠ¡é…ç½®å¯¹åº”ä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œä»»åŠ¡è§¦å‘æ—¶ç›´æ¥æ‹¿åˆ°å¯¹åº”çš„å¯¹è±¡å®ä¾‹è¿›è¡Œè°ƒç”¨ï¼Œä½†æ˜¯quartzæ¡†æ¶çš„é»˜è®¤è°ƒåº¦æ–¹æ¡ˆä¸æ˜¯è¿™æ ·çš„ï¼Œæ‰€ä»¥åšäº†ä¸€ä¸‹è°ƒæ•´ï¼Œæ­¤å¤–è¿˜å¢åŠ äº†é›†ç¾¤ç¯å¢ƒçš„æ”¯æŒã€‚æœ¬ç¯‡æ–‡ç« æä¾›ä¸€ç§æ–¹æ¡ˆæˆ–è€…è¯´æ€è·¯ï¼Œå®é™…ä½¿ç”¨æ—¶è¿˜éœ€è¦å¤§å®¶ç»“åˆè‡ªå·±çš„éœ€æ±‚è¿›è¡Œåˆç†æ›´æ”¹æˆ–ä¼˜åŒ–ï¼Œä¾‹å¦‚å½“å®šæ—¶ä»»åŠ¡æ¯”è¾ƒè½»é‡çš„æ—¶å€™ï¼Œæˆ‘è®¤ä¸ºå¯ä¸å€ŸåŠ©äºæ¡†æ¶ï¼Œä½¿ç”¨è½®è¯¢ä¹Ÿæœªå°ä¸æ˜¯ä¸€ç§ç®€å•æœ‰æ•ˆçš„æ–¹æ¡ˆã€‚"><a href="#æ€»ç»“-æœ¬ç¯‡æ–‡ç« åŸºäºæˆ‘çš„å®é™…é¡¹ç›®ï¼Œè®²è§£äº†å€ŸåŠ©äºquartzæ¡†æ¶çš„å®šæ—¶ä»»åŠ¡åŠ¨æ€å¢åˆ æ”¹çš„æ–¹æ¡ˆï¼Œä½†æ˜¯å› é¡¹ç›®è€Œå¼‚ï¼Œæˆ‘ä¹Ÿåšäº†è®¸å¤šå®šåˆ¶åŒ–çš„æ“ä½œï¼Œæˆ‘çš„æ€è·¯å°±æ˜¯ä¸€é¡¹å®šæ—¶ä»»åŠ¡é…ç½®å¯¹åº”ä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œä»»åŠ¡è§¦å‘æ—¶ç›´æ¥æ‹¿åˆ°å¯¹åº”çš„å¯¹è±¡å®ä¾‹è¿›è¡Œè°ƒç”¨ï¼Œä½†æ˜¯quartzæ¡†æ¶çš„é»˜è®¤è°ƒåº¦æ–¹æ¡ˆä¸æ˜¯è¿™æ ·çš„ï¼Œæ‰€ä»¥åšäº†ä¸€ä¸‹è°ƒæ•´ï¼Œæ­¤å¤–è¿˜å¢åŠ äº†é›†ç¾¤ç¯å¢ƒçš„æ”¯æŒã€‚æœ¬ç¯‡æ–‡ç« æä¾›ä¸€ç§æ–¹æ¡ˆæˆ–è€…è¯´æ€è·¯ï¼Œå®é™…ä½¿ç”¨æ—¶è¿˜éœ€è¦å¤§å®¶ç»“åˆè‡ªå·±çš„éœ€æ±‚è¿›è¡Œåˆç†æ›´æ”¹æˆ–ä¼˜åŒ–ï¼Œä¾‹å¦‚å½“å®šæ—¶ä»»åŠ¡æ¯”è¾ƒè½»é‡çš„æ—¶å€™ï¼Œæˆ‘è®¤ä¸ºå¯ä¸å€ŸåŠ©äºæ¡†æ¶ï¼Œä½¿ç”¨è½®è¯¢ä¹Ÿæœªå°ä¸æ˜¯ä¸€ç§ç®€å•æœ‰æ•ˆçš„æ–¹æ¡ˆã€‚" class="headerlink" title="æ€»ç»“: æœ¬ç¯‡æ–‡ç« åŸºäºæˆ‘çš„å®é™…é¡¹ç›®ï¼Œè®²è§£äº†å€ŸåŠ©äºquartzæ¡†æ¶çš„å®šæ—¶ä»»åŠ¡åŠ¨æ€å¢åˆ æ”¹çš„æ–¹æ¡ˆï¼Œä½†æ˜¯å› é¡¹ç›®è€Œå¼‚ï¼Œæˆ‘ä¹Ÿåšäº†è®¸å¤šå®šåˆ¶åŒ–çš„æ“ä½œï¼Œæˆ‘çš„æ€è·¯å°±æ˜¯ä¸€é¡¹å®šæ—¶ä»»åŠ¡é…ç½®å¯¹åº”ä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œä»»åŠ¡è§¦å‘æ—¶ç›´æ¥æ‹¿åˆ°å¯¹åº”çš„å¯¹è±¡å®ä¾‹è¿›è¡Œè°ƒç”¨ï¼Œä½†æ˜¯quartzæ¡†æ¶çš„é»˜è®¤è°ƒåº¦æ–¹æ¡ˆä¸æ˜¯è¿™æ ·çš„ï¼Œæ‰€ä»¥åšäº†ä¸€ä¸‹è°ƒæ•´ï¼Œæ­¤å¤–è¿˜å¢åŠ äº†é›†ç¾¤ç¯å¢ƒçš„æ”¯æŒã€‚æœ¬ç¯‡æ–‡ç« æä¾›ä¸€ç§æ–¹æ¡ˆæˆ–è€…è¯´æ€è·¯ï¼Œå®é™…ä½¿ç”¨æ—¶è¿˜éœ€è¦å¤§å®¶ç»“åˆè‡ªå·±çš„éœ€æ±‚è¿›è¡Œåˆç†æ›´æ”¹æˆ–ä¼˜åŒ–ï¼Œä¾‹å¦‚å½“å®šæ—¶ä»»åŠ¡æ¯”è¾ƒè½»é‡çš„æ—¶å€™ï¼Œæˆ‘è®¤ä¸ºå¯ä¸å€ŸåŠ©äºæ¡†æ¶ï¼Œä½¿ç”¨è½®è¯¢ä¹Ÿæœªå°ä¸æ˜¯ä¸€ç§ç®€å•æœ‰æ•ˆçš„æ–¹æ¡ˆã€‚"></a><strong>æ€»ç»“:</strong> æœ¬ç¯‡æ–‡ç« åŸºäºæˆ‘çš„å®é™…é¡¹ç›®ï¼Œè®²è§£äº†å€ŸåŠ©äºquartzæ¡†æ¶çš„å®šæ—¶ä»»åŠ¡åŠ¨æ€å¢åˆ æ”¹çš„æ–¹æ¡ˆï¼Œä½†æ˜¯å› é¡¹ç›®è€Œå¼‚ï¼Œæˆ‘ä¹Ÿåšäº†è®¸å¤šå®šåˆ¶åŒ–çš„æ“ä½œï¼Œæˆ‘çš„æ€è·¯å°±æ˜¯ä¸€é¡¹å®šæ—¶ä»»åŠ¡é…ç½®å¯¹åº”ä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œä»»åŠ¡è§¦å‘æ—¶ç›´æ¥æ‹¿åˆ°å¯¹åº”çš„å¯¹è±¡å®ä¾‹è¿›è¡Œè°ƒç”¨ï¼Œä½†æ˜¯quartzæ¡†æ¶çš„é»˜è®¤è°ƒåº¦æ–¹æ¡ˆä¸æ˜¯è¿™æ ·çš„ï¼Œæ‰€ä»¥åšäº†ä¸€ä¸‹è°ƒæ•´ï¼Œæ­¤å¤–è¿˜å¢åŠ äº†é›†ç¾¤ç¯å¢ƒçš„æ”¯æŒã€‚æœ¬ç¯‡æ–‡ç« æä¾›ä¸€ç§æ–¹æ¡ˆæˆ–è€…è¯´æ€è·¯ï¼Œå®é™…ä½¿ç”¨æ—¶è¿˜éœ€è¦å¤§å®¶ç»“åˆè‡ªå·±çš„éœ€æ±‚è¿›è¡Œåˆç†æ›´æ”¹æˆ–ä¼˜åŒ–ï¼Œä¾‹å¦‚å½“å®šæ—¶ä»»åŠ¡æ¯”è¾ƒè½»é‡çš„æ—¶å€™ï¼Œæˆ‘è®¤ä¸ºå¯ä¸å€ŸåŠ©äºæ¡†æ¶ï¼Œä½¿ç”¨è½®è¯¢ä¹Ÿæœªå°ä¸æ˜¯ä¸€ç§ç®€å•æœ‰æ•ˆçš„æ–¹æ¡ˆã€‚</h3></li></ul></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>åç«¯å¼€å‘</tag>
      
      <tag>Java</tag>
      
      <tag>quartz</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Angularä½¿ç”¨Httpæ‹¦æˆªå™¨</title>
    <link href="/2020/12/15/Angular%E4%BD%BF%E7%94%A8Http%E6%8B%A6%E6%88%AA%E5%99%A8/"/>
    <url>/2020/12/15/Angular%E4%BD%BF%E7%94%A8Http%E6%8B%A6%E6%88%AA%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<p>&emsp;&emsp;åœ¨å‰ç«¯å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œä¸€èˆ¬é€šè¿‡HTTPæ¥å£ä¸åç«¯è¿›è¡Œæ•°æ®äº¤äº’ï¼Œè€Œåç«¯ä¸€èˆ¬ä¼šå›ºå®šä¸€ä¸ªè¿”å›æ ¼å¼ï¼Œä¾‹å¦‚ï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">&#123;    &quot;code&quot;: 0,    &quot;success&quot;: true,    &quot;message&quot;: &quot;&quot;,    &quot;result&quot;:&#123;        &quot;id&quot;:9,        &quot;title&quot;:&quot;&quot;,        &quot;content&quot;:&quot;&quot;,        &quot;createTime&quot;:&quot;2020-11-25 19:22:31&quot;,        &quot;updateTime&quot;:&quot;2020-11-25 19:47:22&quot;,        &quot;available&quot;:true    &#125;&#125;</code></pre><p>&emsp;&emsp;å‰ç«¯åœ¨æ‹¿åˆ°æ•°æ®åï¼Œé¦–å…ˆåˆ¤æ–­æ˜¯å¦æˆåŠŸï¼Œç„¶åå–å‡ºæ•°æ®ä½“æ˜¾ç¤ºåˆ°é¡µé¢ä¸Šï¼Œä½†æ˜¯æ¯ä¸€æ¬¡éƒ½è¿™ä¹ˆå»åšï¼Œå‡ ä¹éƒ½æ˜¯é‡å¤çš„æ“ä½œï¼Œåœ¨åç«¯å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰è¯¸å¦‚è¿‡æ»¤å™¨ã€Springæä¾›çš„æ‹¦æˆªå™¨ç­‰å·¥å…·å®ç°å¯¹HTTPè¯·æ±‚çš„ç»Ÿä¸€å¤„ç†ï¼Œåœ¨å‰ç«¯å…¶å®ä¹Ÿæœ‰ç±»ä¼¼çš„ä¸œè¥¿ï¼ŒAngularæ¡†æ¶å°±æä¾›äº†æ‹¦æˆªå™¨æ¥å£:</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">interface HttpInterceptor &#123;  intercept(req: HttpRequest&lt;any&gt;, next: HttpHandler): Observable&lt;HttpEvent&lt;any&gt;&gt;&#125;</code></pre><p>&emsp;&emsp;å¯ä»¥å®ç°ç»Ÿä¸€çš„HTTPè¯·æ±‚å¤„ç†ï¼Œå¸®åŠ©æˆ‘ä»¬ç®€åŒ–ä»£ç ï¼Œå¹¶ä¸”æ–¹ä¾¿ä»£ç çš„ç»´æŠ¤ï¼Œç›´æ¥æ”¾ä¸Šä¸€ä¸ªæˆ‘å®é™…ä½¿ç”¨è¿‡çš„ç¤ºä¾‹ä»£ç ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">import &#123;  HttpErrorResponse,  HttpEvent,  HttpHandler,  HttpInterceptor,  HttpRequest,  HttpResponse,  HttpResponseBase&#125; from &#39;@angular&#x2F;common&#x2F;http&#39;;import &#123;Observable, of, throwError&#125; from &#39;rxjs&#39;;import &#123;Injectable&#125; from &#39;@angular&#x2F;core&#39;;import &#123;catchError, debounceTime, finalize, mergeMap, retry&#125; from &#39;rxjs&#x2F;operators&#39;;import &#123;AppService&#125; from &#39;..&#x2F;service&#x2F;app.service&#39;;&#x2F;** * å…¨å±€HTTPè¯·æ±‚æ‹¦æˆªå™¨ *&#x2F;@Injectable()export class AppHttpInterceptor implements HttpInterceptor &#123;  &#x2F;&#x2F; å½“å‰æ­£åœ¨é€šä¿¡ä¸­çš„HTTPè¯·æ±‚æ•°é‡ï¼Œæ­¤å€¼æ˜¯ä¸ºäº†åœ¨httpè¯·æ±‚çš„è¿‡ç¨‹ä¸­æ·»åŠ åŠ è½½åŠ¨ç”»  public processingHttpCount &#x3D; 0;  &#x2F;&#x2F; ä¾èµ–æ³¨å…¥  constructor(public appService: AppService) &#123;  &#125;  intercept(req: HttpRequest&lt;any&gt;, next: HttpHandler): Observable&lt;HttpEvent&lt;any&gt;&gt; &#123;    &#x2F;&#x2F; &#x2F;monitorå‰ç¼€çš„ä¸åšå¤„ç†    if (req.url.includes(&#39;&#x2F;monitor&#39;)) &#123;      return next.handle(req);    &#125;    &#x2F;&#x2F;; setTimeout(() &#x3D;&gt; this.appService.showLoadingBar &#x3D; true);    &#x2F;&#x2F;     this.processingHttpCount ++;    return next.handle(req.clone(&#123;      &#x2F;&#x2F; ä¸ºæ‰€æœ‰æ‹¦æˆªçš„è¯·æ±‚æ·»åŠ ä¸€ä¸ª&#39;&#x2F;starry&#39;å‰ç¼€      url: &#39;&#x2F;starry&#39; + (req.url.startsWith(&#39;&#x2F;&#39;) ? req.url : &#39;&#x2F;&#39; + req.url)    &#125;))      .pipe(        debounceTime(1000),        &#x2F;&#x2F; å¤±è´¥æ—¶é‡è¯•2æ¬¡        retry(2),        mergeMap((event: any) &#x3D;&gt; &#123;          &#x2F;&#x2F; å¤„ç†åç«¯HTTPæ¥å£è¿”å›ç»“æœ          if (event instanceof HttpResponseBase) &#123;            &#x2F;&#x2F; HTTPè¿”å›ä»£ç æ­£å¸¸            if (event.status &gt;&#x3D; 200 &amp;&amp; event.status &lt; 400) &#123;              &#x2F;&#x2F; å¤„ç†HTTP Response              if (event instanceof HttpResponse) &#123;                const body &#x3D; event.body;                &#x2F;&#x2F; åˆ¤æ–­åç«¯çš„æˆåŠŸæ ‡å¿—å­—æ®µæ˜¯å¦ä¸ºtrue                if (body &amp;&amp; body.success) &#123;                  &#x2F;&#x2F; å–å‡ºå“åº”ä½“æ•°æ®çš„dataéƒ¨åˆ†å¹¶ç»§ç»­åç»­æ“ä½œ(å°†åŸæœ‰çš„bodyæ›¿æ¢ä¸ºäº†body[&#39;result&#39;])                  return of(new HttpResponse(Object.assign(event, &#123;body: body.result&#125;)));                &#125; else &#123;                  &#x2F;&#x2F; æŠ›å‡ºå¼‚å¸¸                  throw Error(body.message);                &#125;              &#125;            &#125;          &#125;          &#x2F;&#x2F; å…¶ä½™äº‹ä»¶ç±»å‹ä¸ä½œæ‹¦æˆªå¤„ç†          return of(event);        &#125;), catchError((err: HttpErrorResponse) &#x3D;&gt; &#123;          &#x2F;&#x2F; å¦‚æœå‘ç”Ÿ5xxå¼‚å¸¸ï¼Œæ˜¾ç¤ºä¸€ä¸ªé”™è¯¯ä¿¡æ¯æç¤º          this.appService.showSnackBar(err.message, 4000);          console.error(err.message)          return throwError(err);        &#125;), finalize(() &#x3D;&gt; &#123;          &#x2F;&#x2F; æœ€ç»ˆprocessingHttpCountå‡ä¸€ï¼Œå¹¶ä¸”åœ¨å‡è‡³0çš„æ—¶å€™ç§»é™¤æ‰åŠ è½½åŠ¨ç”»          setTimeout(() &#x3D;&gt; --this.processingHttpCount &#x3D;&#x3D;&#x3D; 0 ?            this.appService.showLoadingBar &#x3D; false : this.appService.showLoadingBar &#x3D; true, 500);        &#125;));  &#125;&#125;</code></pre><p>&emsp;&emsp;å¹¶å°†æ­¤æ‹¦æˆªå™¨æ³¨å†Œåœ¨Angularæ¨¡å—çš„providerä¸­å»ï¼Œåœ¨providersä¸­æ·»åŠ ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">&#123;    provide: HTTP_INTERCEPTORS, useClass: AppHttpInterceptor, multi: true&#125;</code></pre><p>&emsp;&emsp;è¿™æ ·åœ¨è°ƒç”¨åç«¯æ¥å£çš„æ—¶å€™æˆ‘ä»¬ä¸ç”¨æ¯æ¬¡å†å¤„ç†åç«¯çš„è¿”å›æ•°æ®ï¼Œå¯ç›´æ¥åœ¨è¿”å›å€¼ä¸­æ‹¿åˆ°æ•°æ®ä½“éƒ¨åˆ†å»åšé¡µé¢å±•ç¤ºï¼Œå…¶ä½™çš„äº‹æƒ…å°±äº¤ç»™æ‹¦æˆªå™¨å»å¤„ç†ï¼Œä¾‹å¦‚ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">this.httpClient.get(&#39;&#x2F;config&#x2F;template&#x2F;&#39; + template).subscribe(data &#x3D;&gt; this.configTemplates.push(&#123;template, data&#125;));</code></pre><p>&emsp;&emsp;è‡³æ­¤ï¼Œå°±é…ç½®å¥½äº†ä¸€ä¸ªHTTPæ‹¦æˆªå™¨ï¼Œè¿˜å¯ä»¥ç»Ÿä¸€å¤„ç†è¯·æ±‚çš„URLä»¥åŠå¼‚å¸¸å¤„ç†ç­‰ç­‰ï¼Œååˆ†æ–¹ä¾¿ã€‚å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://angular.io/api/common/http/HttpInterceptor">https://angular.io/api/common/http/HttpInterceptor</a> (ä¸­æ–‡æ–‡æ¡£å°† <strong>.io</strong> æ”¹ä¸º <strong>.cn</strong> å³å¯)<br>&emsp;&emsp;é™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äºé¡µé¢è·¯ç”±ï¼ŒAngularå…¶å®ä¹Ÿæä¾›äº†ç±»ä¼¼çš„å·¥å…·ï¼Œå¯ä»¥å¯¹è·¯ç”±ä»¥åŠé¡µé¢ç»„ä»¶è¿›è¡Œæ‹¦æˆªæ§åˆ¶ï¼Œæœ‰æœºä¼šå†ä½œä»‹ç»ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>å‰ç«¯å¼€å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerå®‰è£…zookeeperé›†ç¾¤(é™„bashè„šæœ¬)</title>
    <link href="/2020/12/14/docker%E5%AE%89%E8%A3%85zookeeper%E9%9B%86%E7%BE%A4-%E9%99%84bash%E8%84%9A%E6%9C%AC/"/>
    <url>/2020/12/14/docker%E5%AE%89%E8%A3%85zookeeper%E9%9B%86%E7%BE%A4-%E9%99%84bash%E8%84%9A%E6%9C%AC/</url>
    
    <content type="html"><![CDATA[<ul><li><p>å‡†å¤‡ä¸€ä¸ªæ–‡ä»¶å¤¹å¹¶è¿›å…¥æ­¤æ–‡ä»¶å¤¹ï¼Œ ä¾‹å¦‚</p><p><code>mkdir -p ~/docker-app/zookeeper &amp;&amp; cd ~/docker-app/zookeeper</code></p></li><li><p>å‡†å¤‡ä¸‰ä¸ªæ–‡ä»¶å¤¹å¹¶å†™å…¥zookeeperçš„myid</p><p><code>mkdir -p zoo1/data &amp;&amp; echo 1 &gt; zoo1/data/myid</code><br><code>mkdir -p zoo2/data &amp;&amp; echo 2 &gt; zoo2/data/myid</code><br><code>mkdir -p zoo3/data &amp;&amp; echo 3 &gt; zoo3/data/myid</code>  </p></li><li><p>åˆ›å»ºä¸€ä¸ªdocker-compose.ymlæ–‡ä»¶å¹¶ç¼–è¾‘  </p><p><code>vim docker-compose.yml</code></p><p>æ–‡ä»¶å†…å®¹å¦‚ä¸‹:  </p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">version: &#39;3.7&#39;networks:  zk_cluster:    name: zk_cluster #ä¸ºé›†ç¾¤åˆ›å»ºä¸€ä¸ªç½‘ç»œ    driver: bridge#é›†ç¾¤ä¸­çš„æœåŠ¡(3ä¸ªèŠ‚ç‚¹)services:  zoo1:    image: zookeeper #æ‰€ä½¿ç”¨çš„é•œåƒ    restart: always #å®¹å™¨å¼‚å¸¸æ—¶æ˜¯å¦é‡å¯    container_name: zoo1 #å®¹å™¨åç§°    ports: #ä¸å®¿ä¸»æœºçš„ç«¯å£æ˜ å°„      - 2181:2181      - 8001:8080    # zookeeperçš„é…ç½®    environment:      ZOO_MY_ID: 1      ZOO_SERVERS: server.1&#x3D;0.0.0.0:2888:3888;2181 server.2&#x3D;zoo2:2888:3888;2181 server.3&#x3D;zoo3:2888:3888;2181    #å®¹å™¨ç›®å½•æ˜ å°„ï¼Œæ­¤å¤„ä½¿ç”¨äº†ç›¸å¯¹è·¯å¾„    volumes:      - .&#x2F;zoo1&#x2F;data:&#x2F;data      - .&#x2F;zoo1&#x2F;datalog:&#x2F;datalog    #æ‰€ä½¿ç”¨çš„ç½‘ç»œ    networks:      - zk_cluster  zoo2:    image: zookeeper    restart: always    container_name: zoo2    ports:      - 2182:2181      - 8002:8080    environment:      ZOO_MY_ID: 2      ZOO_SERVERS: server.1&#x3D;zoo1:2888:3888;2181 server.2&#x3D;0.0.0.0:2888:3888;2181 server.3&#x3D;zoo3:2888:3888;2181    volumes:      - .&#x2F;zoo2&#x2F;data:&#x2F;data      - .&#x2F;zoo2&#x2F;datalog:&#x2F;datalog    networks:      - zk_cluster  zoo3:    image: zookeeper    restart: always    container_name: zoo3    ports:      - 2183:2181      - 8003:8080    environment:      ZOO_MY_ID: 3      ZOO_SERVERS: server.1&#x3D;zoo1:2888:3888;2181 server.2&#x3D;zoo2:2888:3888;2181 server.3&#x3D;0.0.0.0:2888:3888;2181    volumes:      - .&#x2F;zoo3&#x2F;data:&#x2F;data      - .&#x2F;zoo3&#x2F;datalog:&#x2F;datalog    networks:      - zk_cluster</code></pre></li><li><p>ä½¿ç”¨docker-composeå‘½ä»¤è¿è¡Œ  </p><p><code>docker-compose --project-directory $PWD up -d</code></p></li><li><p>é™„ï¼šä¸€é”®åˆ›å»ºdocker zookeeperé›†ç¾¤å¹¶æ‰§è¡Œçš„è„šæœ¬ï¼ˆè¯¥æ–¹æ¡ˆä»…ä¾›å‚è€ƒå’Œå­¦ä¹ ï¼Œç”Ÿäº§ç¯å¢ƒéœ€ä»”ç»†æ–Ÿé…Œï¼Œåˆç†ä¿®æ”¹é…ç½®å‚æ•°ï¼‰</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">#! &#x2F;bin&#x2F;bashmkdir -p zookeeper &amp;&amp; cd zookeeperDIR&#x3D;$PWDecho &quot;cd $DIR&quot;echo &quot;create docker compose config file&quot;CONF_YML&#x3D;&#39;docker-compose.yml&#39;touch $CONF_YMLecho &quot;version: &#39;3.7&#39;&quot; &gt; $CONF_YMLNET&#x3D;&#39;zk_cluster&#39;echo &#39;networks:&#39; &gt;&gt; $CONF_YMLecho &quot;  $NET:&quot; &gt;&gt; $CONF_YMLecho &quot;    name: $NET&quot; &gt;&gt; $CONF_YMLecho &quot;    driver: bridge&quot; &gt;&gt; $CONF_YML#èŠ‚ç‚¹ä¸ªæ•°ï¼Œå¯ä»¥ä¿®æ”¹æ­¤å€¼åˆ›å»ºä»»æ„æ•°é‡çš„å®¹å™¨èŠ‚ç‚¹let CLUSTER_COUNT&#x3D;3 IMAGE&#x3D;zookeeperecho &quot;services:&quot; &gt;&gt; $CONF_YMLfor i in &#96;seq 1 $CLUSTER_COUNT&#96;do    echo &quot;  zoo$i:&quot; &gt;&gt; $CONF_YML    echo &quot;    image: $IMAGE&quot; &gt;&gt; $CONF_YML    echo &quot;    restart: always&quot; &gt;&gt; $CONF_YML    echo &quot;    container_name: zoo$i&quot; &gt;&gt; $CONF_YML    echo &quot;    ports:&quot; &gt;&gt; $CONF_YML    echo &quot;      - $[2180 + $i]:2181&quot; &gt;&gt; $CONF_YML    echo &quot;      - $[8000 + $i]:8080&quot; &gt;&gt; $CONF_YML    echo &quot;    environment:&quot; &gt;&gt; $CONF_YML    echo &quot;      ZOO_MY_ID: $i&quot; &gt;&gt; $CONF_YML    zk_srv_conf&#x3D;&#39;&#39;    for j in &#96;seq 1 $CLUSTER_COUNT&#96;    do        if test $i !&#x3D; $j;        then            zk_srv_conf+&#x3D;&quot;server.$j&#x3D;zoo$j:2888:3888;2181&quot;        else            zk_srv_conf+&#x3D;&quot;server.$j&#x3D;0.0.0.0:2888:3888;2181&quot;        fi        if test $j !&#x3D; $CLUSTER_COUNT;        then            zk_srv_conf+&#x3D;&#39; &#39;;        fi    done    echo &quot;      ZOO_SERVERS: $zk_srv_conf&quot; &gt;&gt; $CONF_YML    echo &quot;    volumes:&quot; &gt;&gt; $CONF_YML    echo &quot;      - .&#x2F;zoo$i&#x2F;data:&#x2F;data&quot; &gt;&gt; $CONF_YML    echo &quot;      - .&#x2F;zoo$i&#x2F;datalog:&#x2F;datalog&quot; &gt;&gt; $CONF_YML    echo &quot;    networks:&quot; &gt;&gt; $CONF_YML    echo &quot;      - $NET&quot; &gt;&gt; $CONF_YML    mkdir -p zoo$i&#x2F;data    echo $i &gt; zoo$i&#x2F;data&#x2F;myiddone# docker pull zookeeperdocker-compose --project-directory $DIR up -d</code></pre></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>åç«¯å¼€å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
